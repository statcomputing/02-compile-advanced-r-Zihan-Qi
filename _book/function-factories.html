<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Function factories | Advanced R</title>
  <meta name="description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as help you to understand why R works the way it does." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Function factories | Advanced R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://adv-r.hadley.nz/" />
  <meta property="og:image" content="https://adv-r.hadley.nz/cover.png" />
  <meta property="og:description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as help you to understand why R works the way it does." />
  <meta name="github-repo" content="hadley/adv-r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Function factories | Advanced R" />
  <meta name="twitter:site" content="@hadleywickham" />
  <meta name="twitter:description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as help you to understand why R works the way it does." />
  <meta name="twitter:image" content="https://adv-r.hadley.nz/cover.png" />

<meta name="author" content="Hadley Wickham" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="functionals.html"/>
<link rel="next" href="function-operators.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-141212623-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-141212623-1');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="adv-r.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Advanced R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-books"><i class="fa fa-check"></i>Other books</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.1</b> Why R?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#who-should-read"><i class="fa fa-check"></i><b>1.2</b> Who should read this book</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-you-will-get"><i class="fa fa-check"></i><b>1.3</b> What you will get out of this book</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-you-will-not-learn"><i class="fa fa-check"></i><b>1.4</b> What you will not learn</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#meta-techniques"><i class="fa fa-check"></i><b>1.5</b> Meta-techniques</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#recommended-reading"><i class="fa fa-check"></i><b>1.6</b> Recommended reading</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#getting-help"><i class="fa fa-check"></i><b>1.7</b> Getting help</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#intro-ack"><i class="fa fa-check"></i><b>1.8</b> Acknowledgments</a></li>
<li class="chapter" data-level="1.9" data-path="introduction.html"><a href="introduction.html#conventions"><i class="fa fa-check"></i><b>1.9</b> Conventions</a></li>
<li class="chapter" data-level="1.10" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i><b>1.10</b> Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Foundations</b></span></li>
<li class="chapter" data-level="" data-path="foundations-intro.html"><a href="foundations-intro.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="2" data-path="names-values.html"><a href="names-values.html"><i class="fa fa-check"></i><b>2</b> Names and values</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#sources"><i class="fa fa-check"></i>Sources</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="names-values.html"><a href="names-values.html#binding-basics"><i class="fa fa-check"></i><b>2.2</b> Binding basics</a><ul>
<li class="chapter" data-level="2.2.1" data-path="names-values.html"><a href="names-values.html#non-syntactic"><i class="fa fa-check"></i><b>2.2.1</b> Non-syntactic names</a></li>
<li class="chapter" data-level="2.2.2" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>2.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="names-values.html"><a href="names-values.html#copy-on-modify"><i class="fa fa-check"></i><b>2.3</b> Copy-on-modify</a><ul>
<li class="chapter" data-level="2.3.1" data-path="names-values.html"><a href="names-values.html#tracemem"><i class="fa fa-check"></i><b>2.3.1</b> <code>tracemem()</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="names-values.html"><a href="names-values.html#function-calls"><i class="fa fa-check"></i><b>2.3.2</b> Function calls</a></li>
<li class="chapter" data-level="2.3.3" data-path="names-values.html"><a href="names-values.html#list-references"><i class="fa fa-check"></i><b>2.3.3</b> Lists</a></li>
<li class="chapter" data-level="2.3.4" data-path="names-values.html"><a href="names-values.html#df-modify"><i class="fa fa-check"></i><b>2.3.4</b> Data frames</a></li>
<li class="chapter" data-level="2.3.5" data-path="names-values.html"><a href="names-values.html#character-vectors"><i class="fa fa-check"></i><b>2.3.5</b> Character vectors</a></li>
<li class="chapter" data-level="2.3.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>2.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="names-values.html"><a href="names-values.html#object-size"><i class="fa fa-check"></i><b>2.4</b> Object size</a><ul>
<li class="chapter" data-level="2.4.1" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>2.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="names-values.html"><a href="names-values.html#modify-in-place"><i class="fa fa-check"></i><b>2.5</b> Modify-in-place</a><ul>
<li class="chapter" data-level="2.5.1" data-path="names-values.html"><a href="names-values.html#single-binding"><i class="fa fa-check"></i><b>2.5.1</b> Objects with a single binding</a></li>
<li class="chapter" data-level="2.5.2" data-path="names-values.html"><a href="names-values.html#env-modify"><i class="fa fa-check"></i><b>2.5.2</b> Environments</a></li>
<li class="chapter" data-level="2.5.3" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>2.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="names-values.html"><a href="names-values.html#gc"><i class="fa fa-check"></i><b>2.6</b> Unbinding and the garbage collector</a></li>
<li class="chapter" data-level="2.7" data-path="names-values.html"><a href="names-values.html#names-values-answers"><i class="fa fa-check"></i><b>2.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vectors-chap.html"><a href="vectors-chap.html"><i class="fa fa-check"></i><b>3</b> Vectors</a><ul>
<li class="chapter" data-level="3.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-vectors"><i class="fa fa-check"></i><b>3.2</b> Atomic vectors</a><ul>
<li class="chapter" data-level="3.2.1" data-path="vectors-chap.html"><a href="vectors-chap.html#scalars"><i class="fa fa-check"></i><b>3.2.1</b> Scalars</a></li>
<li class="chapter" data-level="3.2.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-constructing"><i class="fa fa-check"></i><b>3.2.2</b> Making longer vectors with <code>c()</code></a></li>
<li class="chapter" data-level="3.2.3" data-path="vectors-chap.html"><a href="vectors-chap.html#missing-values"><i class="fa fa-check"></i><b>3.2.3</b> Missing values</a></li>
<li class="chapter" data-level="3.2.4" data-path="vectors-chap.html"><a href="vectors-chap.html#testing-and-coercion"><i class="fa fa-check"></i><b>3.2.4</b> Testing and coercion</a></li>
<li class="chapter" data-level="3.2.5" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>3.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attributes"><i class="fa fa-check"></i><b>3.3</b> Attributes</a><ul>
<li class="chapter" data-level="3.3.1" data-path="vectors-chap.html"><a href="vectors-chap.html#getting-and-setting"><i class="fa fa-check"></i><b>3.3.1</b> Getting and setting</a></li>
<li class="chapter" data-level="3.3.2" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-names"><i class="fa fa-check"></i><b>3.3.2</b> Names</a></li>
<li class="chapter" data-level="3.3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-dims"><i class="fa fa-check"></i><b>3.3.3</b> Dimensions</a></li>
<li class="chapter" data-level="3.3.4" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>3.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="vectors-chap.html"><a href="vectors-chap.html#s3-atomic-vectors"><i class="fa fa-check"></i><b>3.4</b> S3 atomic vectors</a><ul>
<li class="chapter" data-level="3.4.1" data-path="vectors-chap.html"><a href="vectors-chap.html#factors"><i class="fa fa-check"></i><b>3.4.1</b> Factors</a></li>
<li class="chapter" data-level="3.4.2" data-path="vectors-chap.html"><a href="vectors-chap.html#dates"><i class="fa fa-check"></i><b>3.4.2</b> Dates</a></li>
<li class="chapter" data-level="3.4.3" data-path="vectors-chap.html"><a href="vectors-chap.html#date-times"><i class="fa fa-check"></i><b>3.4.3</b> Date-times</a></li>
<li class="chapter" data-level="3.4.4" data-path="vectors-chap.html"><a href="vectors-chap.html#durations"><i class="fa fa-check"></i><b>3.4.4</b> Durations</a></li>
<li class="chapter" data-level="3.4.5" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>3.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="vectors-chap.html"><a href="vectors-chap.html#lists"><i class="fa fa-check"></i><b>3.5</b> Lists</a><ul>
<li class="chapter" data-level="3.5.1" data-path="vectors-chap.html"><a href="vectors-chap.html#list-creating"><i class="fa fa-check"></i><b>3.5.1</b> Creating</a></li>
<li class="chapter" data-level="3.5.2" data-path="vectors-chap.html"><a href="vectors-chap.html#list-types"><i class="fa fa-check"></i><b>3.5.2</b> Testing and coercion</a></li>
<li class="chapter" data-level="3.5.3" data-path="vectors-chap.html"><a href="vectors-chap.html#list-array"><i class="fa fa-check"></i><b>3.5.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="3.5.4" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>3.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="vectors-chap.html"><a href="vectors-chap.html#tibble"><i class="fa fa-check"></i><b>3.6</b> Data frames and tibbles</a><ul>
<li class="chapter" data-level="3.6.1" data-path="vectors-chap.html"><a href="vectors-chap.html#df-create"><i class="fa fa-check"></i><b>3.6.1</b> Creating</a></li>
<li class="chapter" data-level="3.6.2" data-path="vectors-chap.html"><a href="vectors-chap.html#rownames"><i class="fa fa-check"></i><b>3.6.2</b> Row names</a></li>
<li class="chapter" data-level="3.6.3" data-path="vectors-chap.html"><a href="vectors-chap.html#printing"><i class="fa fa-check"></i><b>3.6.3</b> Printing</a></li>
<li class="chapter" data-level="3.6.4" data-path="vectors-chap.html"><a href="vectors-chap.html#safe-subsetting"><i class="fa fa-check"></i><b>3.6.4</b> Subsetting</a></li>
<li class="chapter" data-level="3.6.5" data-path="vectors-chap.html"><a href="vectors-chap.html#df-test-coerce"><i class="fa fa-check"></i><b>3.6.5</b> Testing and coercing</a></li>
<li class="chapter" data-level="3.6.6" data-path="vectors-chap.html"><a href="vectors-chap.html#list-columns"><i class="fa fa-check"></i><b>3.6.6</b> List columns</a></li>
<li class="chapter" data-level="3.6.7" data-path="vectors-chap.html"><a href="vectors-chap.html#matrix-and-data-frame-columns"><i class="fa fa-check"></i><b>3.6.7</b> Matrix and data frame columns</a></li>
<li class="chapter" data-level="3.6.8" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>3.6.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="vectors-chap.html"><a href="vectors-chap.html#null"><i class="fa fa-check"></i><b>3.7</b> <code>NULL</code></a></li>
<li class="chapter" data-level="3.8" data-path="vectors-chap.html"><a href="vectors-chap.html#data-structure-answers"><i class="fa fa-check"></i><b>3.8</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>4</b> Subsetting</a><ul>
<li class="chapter" data-level="4.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="subsetting.html"><a href="subsetting.html#subset-multiple"><i class="fa fa-check"></i><b>4.2</b> Selecting multiple elements</a><ul>
<li class="chapter" data-level="4.2.1" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-vectors"><i class="fa fa-check"></i><b>4.2.1</b> Atomic vectors</a></li>
<li class="chapter" data-level="4.2.2" data-path="vectors-chap.html"><a href="vectors-chap.html#lists"><i class="fa fa-check"></i><b>4.2.2</b> Lists</a></li>
<li class="chapter" data-level="4.2.3" data-path="subsetting.html"><a href="subsetting.html#matrix-subsetting"><i class="fa fa-check"></i><b>4.2.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="4.2.4" data-path="subsetting.html"><a href="subsetting.html#df-subsetting"><i class="fa fa-check"></i><b>4.2.4</b> Data frames and tibbles</a></li>
<li class="chapter" data-level="4.2.5" data-path="subsetting.html"><a href="subsetting.html#simplify-preserve"><i class="fa fa-check"></i><b>4.2.5</b> Preserving dimensionality</a></li>
<li class="chapter" data-level="4.2.6" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>4.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="subsetting.html"><a href="subsetting.html#subset-single"><i class="fa fa-check"></i><b>4.3</b> Selecting a single element</a><ul>
<li class="chapter" data-level="4.3.1" data-path="subsetting.html"><a href="subsetting.html#section"><i class="fa fa-check"></i><b>4.3.1</b> <code>[[</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="subsetting.html"><a href="subsetting.html#section-1"><i class="fa fa-check"></i><b>4.3.2</b> <code>$</code></a></li>
<li class="chapter" data-level="4.3.3" data-path="subsetting.html"><a href="subsetting.html#subsetting-oob"><i class="fa fa-check"></i><b>4.3.3</b> Missing and out-of-bounds indices</a></li>
<li class="chapter" data-level="4.3.4" data-path="subsetting.html"><a href="subsetting.html#and-slot"><i class="fa fa-check"></i><b>4.3.4</b> <code>@</code> and <code>slot()</code></a></li>
<li class="chapter" data-level="4.3.5" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>4.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="subsetting.html"><a href="subsetting.html#subassignment"><i class="fa fa-check"></i><b>4.4</b> Subsetting and assignment</a></li>
<li class="chapter" data-level="4.5" data-path="subsetting.html"><a href="subsetting.html#applications"><i class="fa fa-check"></i><b>4.5</b> Applications</a><ul>
<li class="chapter" data-level="4.5.1" data-path="subsetting.html"><a href="subsetting.html#lookup-tables"><i class="fa fa-check"></i><b>4.5.1</b> Lookup tables (character subsetting)</a></li>
<li class="chapter" data-level="4.5.2" data-path="subsetting.html"><a href="subsetting.html#matching-merging"><i class="fa fa-check"></i><b>4.5.2</b> Matching and merging by hand (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.3" data-path="subsetting.html"><a href="subsetting.html#random-samples-and-bootstraps-integer-subsetting"><i class="fa fa-check"></i><b>4.5.3</b> Random samples and bootstraps (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.4" data-path="subsetting.html"><a href="subsetting.html#ordering-integer-subsetting"><i class="fa fa-check"></i><b>4.5.4</b> Ordering (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.5" data-path="subsetting.html"><a href="subsetting.html#expanding-aggregated-counts-integer-subsetting"><i class="fa fa-check"></i><b>4.5.5</b> Expanding aggregated counts (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.6" data-path="subsetting.html"><a href="subsetting.html#removing-columns-from-data-frames-character"><i class="fa fa-check"></i><b>4.5.6</b> Removing columns from data frames (character )</a></li>
<li class="chapter" data-level="4.5.7" data-path="subsetting.html"><a href="subsetting.html#selecting-rows-based-on-a-condition-logical-subsetting"><i class="fa fa-check"></i><b>4.5.7</b> Selecting rows based on a condition (logical subsetting)</a></li>
<li class="chapter" data-level="4.5.8" data-path="subsetting.html"><a href="subsetting.html#boolean-algebra-versus-sets-logical-and-integer"><i class="fa fa-check"></i><b>4.5.8</b> Boolean algebra versus sets (logical and integer )</a></li>
<li class="chapter" data-level="4.5.9" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>4.5.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="subsetting.html"><a href="subsetting.html#subsetting-answers"><i class="fa fa-check"></i><b>4.6</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="control-flow.html"><a href="control-flow.html"><i class="fa fa-check"></i><b>5</b> Control flow</a><ul>
<li class="chapter" data-level="5.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="control-flow.html"><a href="control-flow.html#choices"><i class="fa fa-check"></i><b>5.2</b> Choices</a><ul>
<li class="chapter" data-level="5.2.1" data-path="control-flow.html"><a href="control-flow.html#invalid-inputs"><i class="fa fa-check"></i><b>5.2.1</b> Invalid inputs</a></li>
<li class="chapter" data-level="5.2.2" data-path="control-flow.html"><a href="control-flow.html#vectorised-if"><i class="fa fa-check"></i><b>5.2.2</b> Vectorised if</a></li>
<li class="chapter" data-level="5.2.3" data-path="control-flow.html"><a href="control-flow.html#switch"><i class="fa fa-check"></i><b>5.2.3</b> <code>switch()</code> statement</a></li>
<li class="chapter" data-level="5.2.4" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>5.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="control-flow.html"><a href="control-flow.html#loops"><i class="fa fa-check"></i><b>5.3</b> Loops</a><ul>
<li class="chapter" data-level="5.3.1" data-path="control-flow.html"><a href="control-flow.html#common-pitfalls"><i class="fa fa-check"></i><b>5.3.1</b> Common pitfalls</a></li>
<li class="chapter" data-level="5.3.2" data-path="control-flow.html"><a href="control-flow.html#for-family"><i class="fa fa-check"></i><b>5.3.2</b> Related tools</a></li>
<li class="chapter" data-level="5.3.3" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>5.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="control-flow.html"><a href="control-flow.html#control-flow-answers"><i class="fa fa-check"></i><b>5.4</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>6</b> Functions</a><ul>
<li class="chapter" data-level="6.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="functions.html"><a href="functions.html#function-fundamentals"><i class="fa fa-check"></i><b>6.2</b> Function fundamentals</a><ul>
<li class="chapter" data-level="6.2.1" data-path="functions.html"><a href="functions.html#fun-components"><i class="fa fa-check"></i><b>6.2.1</b> Function components</a></li>
<li class="chapter" data-level="6.2.2" data-path="functions.html"><a href="functions.html#primitive-functions"><i class="fa fa-check"></i><b>6.2.2</b> Primitive functions</a></li>
<li class="chapter" data-level="6.2.3" data-path="functions.html"><a href="functions.html#first-class-functions"><i class="fa fa-check"></i><b>6.2.3</b> First-class functions</a></li>
<li class="chapter" data-level="6.2.4" data-path="functions.html"><a href="functions.html#invoking-a-function"><i class="fa fa-check"></i><b>6.2.4</b> Invoking a function</a></li>
<li class="chapter" data-level="6.2.5" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>6.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="functions.html"><a href="functions.html#function-composition"><i class="fa fa-check"></i><b>6.3</b> Function composition</a></li>
<li class="chapter" data-level="6.4" data-path="functions.html"><a href="functions.html#lexical-scoping"><i class="fa fa-check"></i><b>6.4</b> Lexical scoping</a><ul>
<li class="chapter" data-level="6.4.1" data-path="functions.html"><a href="functions.html#name-masking"><i class="fa fa-check"></i><b>6.4.1</b> Name masking</a></li>
<li class="chapter" data-level="6.4.2" data-path="functions.html"><a href="functions.html#functions-versus-variables"><i class="fa fa-check"></i><b>6.4.2</b> Functions versus variables</a></li>
<li class="chapter" data-level="6.4.3" data-path="functions.html"><a href="functions.html#fresh-start"><i class="fa fa-check"></i><b>6.4.3</b> A fresh start</a></li>
<li class="chapter" data-level="6.4.4" data-path="functions.html"><a href="functions.html#dynamic-lookup"><i class="fa fa-check"></i><b>6.4.4</b> Dynamic lookup</a></li>
<li class="chapter" data-level="6.4.5" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>6.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i><b>6.5</b> Lazy evaluation</a><ul>
<li class="chapter" data-level="6.5.1" data-path="functions.html"><a href="functions.html#promises"><i class="fa fa-check"></i><b>6.5.1</b> Promises</a></li>
<li class="chapter" data-level="6.5.2" data-path="functions.html"><a href="functions.html#default-arguments"><i class="fa fa-check"></i><b>6.5.2</b> Default arguments</a></li>
<li class="chapter" data-level="6.5.3" data-path="functions.html"><a href="functions.html#missing-arguments"><i class="fa fa-check"></i><b>6.5.3</b> Missing arguments</a></li>
<li class="chapter" data-level="6.5.4" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>6.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="functions.html"><a href="functions.html#fun-dot-dot-dot"><i class="fa fa-check"></i><b>6.6</b> <code>...</code> (dot-dot-dot)</a><ul>
<li class="chapter" data-level="6.6.1" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>6.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="functions.html"><a href="functions.html#exiting-a-function"><i class="fa fa-check"></i><b>6.7</b> Exiting a function</a><ul>
<li class="chapter" data-level="6.7.1" data-path="functions.html"><a href="functions.html#implicit-versus-explicit-returns"><i class="fa fa-check"></i><b>6.7.1</b> Implicit versus explicit returns</a></li>
<li class="chapter" data-level="6.7.2" data-path="functions.html"><a href="functions.html#invisible"><i class="fa fa-check"></i><b>6.7.2</b> Invisible values</a></li>
<li class="chapter" data-level="6.7.3" data-path="functions.html"><a href="functions.html#errors"><i class="fa fa-check"></i><b>6.7.3</b> Errors</a></li>
<li class="chapter" data-level="6.7.4" data-path="functions.html"><a href="functions.html#on-exit"><i class="fa fa-check"></i><b>6.7.4</b> Exit handlers</a></li>
<li class="chapter" data-level="6.7.5" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>6.7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="functions.html"><a href="functions.html#function-forms"><i class="fa fa-check"></i><b>6.8</b> Function forms</a><ul>
<li class="chapter" data-level="6.8.1" data-path="functions.html"><a href="functions.html#prefix-transform"><i class="fa fa-check"></i><b>6.8.1</b> Rewriting to prefix form</a></li>
<li class="chapter" data-level="6.8.2" data-path="functions.html"><a href="functions.html#prefix-form"><i class="fa fa-check"></i><b>6.8.2</b> Prefix form</a></li>
<li class="chapter" data-level="6.8.3" data-path="functions.html"><a href="functions.html#infix-functions"><i class="fa fa-check"></i><b>6.8.3</b> Infix functions</a></li>
<li class="chapter" data-level="6.8.4" data-path="functions.html"><a href="functions.html#replacement-functions"><i class="fa fa-check"></i><b>6.8.4</b> Replacement functions</a></li>
<li class="chapter" data-level="6.8.5" data-path="functions.html"><a href="functions.html#special-forms"><i class="fa fa-check"></i><b>6.8.5</b> Special forms</a></li>
<li class="chapter" data-level="6.8.6" data-path="functions.html"><a href="functions.html#exercises-5"><i class="fa fa-check"></i><b>6.8.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="functions.html"><a href="functions.html#function-answers"><i class="fa fa-check"></i><b>6.9</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>7</b> Environments</a><ul>
<li class="chapter" data-level="7.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>7.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="environments.html"><a href="environments.html#env-basics"><i class="fa fa-check"></i><b>7.2</b> Environment basics</a><ul>
<li class="chapter" data-level="7.2.1" data-path="environments.html"><a href="environments.html#basics"><i class="fa fa-check"></i><b>7.2.1</b> Basics</a></li>
<li class="chapter" data-level="7.2.2" data-path="environments.html"><a href="environments.html#important-environments"><i class="fa fa-check"></i><b>7.2.2</b> Important environments</a></li>
<li class="chapter" data-level="7.2.3" data-path="environments.html"><a href="environments.html#parents"><i class="fa fa-check"></i><b>7.2.3</b> Parents</a></li>
<li class="chapter" data-level="7.2.4" data-path="environments.html"><a href="environments.html#super-assignment--"><i class="fa fa-check"></i><b>7.2.4</b> Super assignment, <code>&lt;&lt;-</code></a></li>
<li class="chapter" data-level="7.2.5" data-path="vectors-chap.html"><a href="vectors-chap.html#getting-and-setting"><i class="fa fa-check"></i><b>7.2.5</b> Getting and setting</a></li>
<li class="chapter" data-level="7.2.6" data-path="environments.html"><a href="environments.html#advanced-bindings"><i class="fa fa-check"></i><b>7.2.6</b> Advanced bindings</a></li>
<li class="chapter" data-level="7.2.7" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>7.2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="environments.html"><a href="environments.html#env-recursion"><i class="fa fa-check"></i><b>7.3</b> Recursing over environments</a><ul>
<li class="chapter" data-level="7.3.1" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>7.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="environments.html"><a href="environments.html#special-environments"><i class="fa fa-check"></i><b>7.4</b> Special environments</a><ul>
<li class="chapter" data-level="7.4.1" data-path="environments.html"><a href="environments.html#search-path"><i class="fa fa-check"></i><b>7.4.1</b> Package environments and the search path</a></li>
<li class="chapter" data-level="7.4.2" data-path="environments.html"><a href="environments.html#function-environments"><i class="fa fa-check"></i><b>7.4.2</b> The function environment</a></li>
<li class="chapter" data-level="7.4.3" data-path="environments.html"><a href="environments.html#namespaces"><i class="fa fa-check"></i><b>7.4.3</b> Namespaces</a></li>
<li class="chapter" data-level="7.4.4" data-path="environments.html"><a href="environments.html#execution-environments"><i class="fa fa-check"></i><b>7.4.4</b> Execution environments</a></li>
<li class="chapter" data-level="7.4.5" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>7.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="environments.html"><a href="environments.html#call-stack"><i class="fa fa-check"></i><b>7.5</b> Call stacks</a><ul>
<li class="chapter" data-level="7.5.1" data-path="environments.html"><a href="environments.html#simple-stack"><i class="fa fa-check"></i><b>7.5.1</b> Simple call stacks</a></li>
<li class="chapter" data-level="7.5.2" data-path="environments.html"><a href="environments.html#lazy-call-stack"><i class="fa fa-check"></i><b>7.5.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="7.5.3" data-path="environments.html"><a href="environments.html#frames"><i class="fa fa-check"></i><b>7.5.3</b> Frames</a></li>
<li class="chapter" data-level="7.5.4" data-path="environments.html"><a href="environments.html#dynamic-scope"><i class="fa fa-check"></i><b>7.5.4</b> Dynamic scope</a></li>
<li class="chapter" data-level="7.5.5" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>7.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="environments.html"><a href="environments.html#explicit-envs"><i class="fa fa-check"></i><b>7.6</b> As data structures</a></li>
<li class="chapter" data-level="7.7" data-path="environments.html"><a href="environments.html#env-answers"><i class="fa fa-check"></i><b>7.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditions.html"><a href="conditions.html"><i class="fa fa-check"></i><b>8</b> Conditions</a><ul>
<li class="chapter" data-level="8.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>8.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="8.1.1" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i><b>8.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditions.html"><a href="conditions.html#signalling-conditions"><i class="fa fa-check"></i><b>8.2</b> Signalling conditions</a><ul>
<li class="chapter" data-level="8.2.1" data-path="functions.html"><a href="functions.html#errors"><i class="fa fa-check"></i><b>8.2.1</b> Errors</a></li>
<li class="chapter" data-level="8.2.2" data-path="conditions.html"><a href="conditions.html#warnings"><i class="fa fa-check"></i><b>8.2.2</b> Warnings</a></li>
<li class="chapter" data-level="8.2.3" data-path="conditions.html"><a href="conditions.html#messages"><i class="fa fa-check"></i><b>8.2.3</b> Messages</a></li>
<li class="chapter" data-level="8.2.4" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>8.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="conditions.html"><a href="conditions.html#ignoring-conditions"><i class="fa fa-check"></i><b>8.3</b> Ignoring conditions</a></li>
<li class="chapter" data-level="8.4" data-path="conditions.html"><a href="conditions.html#handling-conditions"><i class="fa fa-check"></i><b>8.4</b> Handling conditions</a><ul>
<li class="chapter" data-level="8.4.1" data-path="conditions.html"><a href="conditions.html#condition-objects"><i class="fa fa-check"></i><b>8.4.1</b> Condition objects</a></li>
<li class="chapter" data-level="8.4.2" data-path="conditions.html"><a href="conditions.html#exiting-handlers"><i class="fa fa-check"></i><b>8.4.2</b> Exiting handlers</a></li>
<li class="chapter" data-level="8.4.3" data-path="conditions.html"><a href="conditions.html#calling-handlers"><i class="fa fa-check"></i><b>8.4.3</b> Calling handlers</a></li>
<li class="chapter" data-level="8.4.4" data-path="conditions.html"><a href="conditions.html#call-stacks"><i class="fa fa-check"></i><b>8.4.4</b> Call stacks</a></li>
<li class="chapter" data-level="8.4.5" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>8.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="conditions.html"><a href="conditions.html#custom-conditions"><i class="fa fa-check"></i><b>8.5</b> Custom conditions</a><ul>
<li class="chapter" data-level="8.5.1" data-path="conditions.html"><a href="conditions.html#motivation"><i class="fa fa-check"></i><b>8.5.1</b> Motivation</a></li>
<li class="chapter" data-level="8.5.2" data-path="conditions.html"><a href="conditions.html#signalling"><i class="fa fa-check"></i><b>8.5.2</b> Signalling</a></li>
<li class="chapter" data-level="8.5.3" data-path="conditions.html"><a href="conditions.html#handling"><i class="fa fa-check"></i><b>8.5.3</b> Handling</a></li>
<li class="chapter" data-level="8.5.4" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>8.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="conditions.html"><a href="conditions.html#condition-applications"><i class="fa fa-check"></i><b>8.6</b> Applications</a><ul>
<li class="chapter" data-level="8.6.1" data-path="conditions.html"><a href="conditions.html#failure-value"><i class="fa fa-check"></i><b>8.6.1</b> Failure value</a></li>
<li class="chapter" data-level="8.6.2" data-path="conditions.html"><a href="conditions.html#try-success-failure"><i class="fa fa-check"></i><b>8.6.2</b> Success and failure values</a></li>
<li class="chapter" data-level="8.6.3" data-path="conditions.html"><a href="conditions.html#resignal"><i class="fa fa-check"></i><b>8.6.3</b> Resignal</a></li>
<li class="chapter" data-level="8.6.4" data-path="conditions.html"><a href="conditions.html#record"><i class="fa fa-check"></i><b>8.6.4</b> Record</a></li>
<li class="chapter" data-level="8.6.5" data-path="conditions.html"><a href="conditions.html#no-default-behaviour"><i class="fa fa-check"></i><b>8.6.5</b> No default behaviour</a></li>
<li class="chapter" data-level="8.6.6" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>8.6.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="conditions.html"><a href="conditions.html#conditions-answers"><i class="fa fa-check"></i><b>8.7</b> Quiz answers</a></li>
</ul></li>
<li class="part"><span><b>II Functional programming</b></span></li>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html#functional-programming-languages"><i class="fa fa-check"></i>Functional programming languages</a></li>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html#functional-style"><i class="fa fa-check"></i>Functional style</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>9</b> Functionals</a><ul>
<li class="chapter" data-level="9.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>9.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="functionals.html"><a href="functionals.html#map"><i class="fa fa-check"></i><b>9.2</b> My first functional: <code>map()</code></a><ul>
<li class="chapter" data-level="9.2.1" data-path="functionals.html"><a href="functionals.html#map-atomic"><i class="fa fa-check"></i><b>9.2.1</b> Producing atomic vectors</a></li>
<li class="chapter" data-level="9.2.2" data-path="functionals.html"><a href="functionals.html#purrr-shortcuts"><i class="fa fa-check"></i><b>9.2.2</b> Anonymous functions and shortcuts</a></li>
<li class="chapter" data-level="9.2.3" data-path="functionals.html"><a href="functionals.html#passing-arguments"><i class="fa fa-check"></i><b>9.2.3</b> Passing arguments with <code>...</code></a></li>
<li class="chapter" data-level="9.2.4" data-path="functionals.html"><a href="functionals.html#argument-names"><i class="fa fa-check"></i><b>9.2.4</b> Argument names</a></li>
<li class="chapter" data-level="9.2.5" data-path="functionals.html"><a href="functionals.html#change-argument"><i class="fa fa-check"></i><b>9.2.5</b> Varying another argument</a></li>
<li class="chapter" data-level="9.2.6" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>9.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="functionals.html"><a href="functionals.html#purrr-style"><i class="fa fa-check"></i><b>9.3</b> Purrr style</a></li>
<li class="chapter" data-level="9.4" data-path="functionals.html"><a href="functionals.html#map-variants"><i class="fa fa-check"></i><b>9.4</b> Map variants</a><ul>
<li class="chapter" data-level="9.4.1" data-path="functionals.html"><a href="functionals.html#modify"><i class="fa fa-check"></i><b>9.4.1</b> Same type of output as input: <code>modify()</code></a></li>
<li class="chapter" data-level="9.4.2" data-path="functionals.html"><a href="functionals.html#map2"><i class="fa fa-check"></i><b>9.4.2</b> Two inputs: <code>map2()</code> and friends</a></li>
<li class="chapter" data-level="9.4.3" data-path="functionals.html"><a href="functionals.html#no-outputs-walk-and-friends"><i class="fa fa-check"></i><b>9.4.3</b> No outputs: <code>walk()</code> and friends</a></li>
<li class="chapter" data-level="9.4.4" data-path="functionals.html"><a href="functionals.html#iterating-over-values-and-indices"><i class="fa fa-check"></i><b>9.4.4</b> Iterating over values and indices</a></li>
<li class="chapter" data-level="9.4.5" data-path="functionals.html"><a href="functionals.html#pmap"><i class="fa fa-check"></i><b>9.4.5</b> Any number of inputs: <code>pmap()</code> and friends</a></li>
<li class="chapter" data-level="9.4.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>9.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="functionals.html"><a href="functionals.html#reduce"><i class="fa fa-check"></i><b>9.5</b> Reduce family</a><ul>
<li class="chapter" data-level="9.5.1" data-path="environments.html"><a href="environments.html#basics"><i class="fa fa-check"></i><b>9.5.1</b> Basics</a></li>
<li class="chapter" data-level="9.5.2" data-path="functionals.html"><a href="functionals.html#accumulate"><i class="fa fa-check"></i><b>9.5.2</b> Accumulate</a></li>
<li class="chapter" data-level="9.5.3" data-path="functionals.html"><a href="functionals.html#output-types"><i class="fa fa-check"></i><b>9.5.3</b> Output types</a></li>
<li class="chapter" data-level="9.5.4" data-path="functionals.html"><a href="functionals.html#multiple-inputs"><i class="fa fa-check"></i><b>9.5.4</b> Multiple inputs</a></li>
<li class="chapter" data-level="9.5.5" data-path="functionals.html"><a href="functionals.html#map-reduce"><i class="fa fa-check"></i><b>9.5.5</b> Map-reduce</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="functionals.html"><a href="functionals.html#predicate-functionals"><i class="fa fa-check"></i><b>9.6</b> Predicate functionals</a><ul>
<li class="chapter" data-level="9.6.1" data-path="functionals.html"><a href="functionals.html#basics-1"><i class="fa fa-check"></i><b>9.6.1</b> Basics</a></li>
<li class="chapter" data-level="9.6.2" data-path="functionals.html"><a href="functionals.html#predicate-map"><i class="fa fa-check"></i><b>9.6.2</b> Map variants</a></li>
<li class="chapter" data-level="9.6.3" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>9.6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="functionals.html"><a href="functionals.html#base-functionals"><i class="fa fa-check"></i><b>9.7</b> Base functionals</a><ul>
<li class="chapter" data-level="9.7.1" data-path="functionals.html"><a href="functionals.html#matrices-and-arrays"><i class="fa fa-check"></i><b>9.7.1</b> Matrices and arrays</a></li>
<li class="chapter" data-level="9.7.2" data-path="functionals.html"><a href="functionals.html#mathematical-concerns"><i class="fa fa-check"></i><b>9.7.2</b> Mathematical concerns</a></li>
<li class="chapter" data-level="9.7.3" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>9.7.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="function-factories.html"><a href="function-factories.html"><i class="fa fa-check"></i><b>10</b> Function factories</a><ul>
<li class="chapter" data-level="10.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>10.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="function-factories.html"><a href="function-factories.html#factory-fundamentals"><i class="fa fa-check"></i><b>10.2</b> Factory fundamentals</a><ul>
<li class="chapter" data-level="10.2.1" data-path="environments.html"><a href="environments.html#environments"><i class="fa fa-check"></i><b>10.2.1</b> Environments</a></li>
<li class="chapter" data-level="10.2.2" data-path="function-factories.html"><a href="function-factories.html#diagram-conventions"><i class="fa fa-check"></i><b>10.2.2</b> Diagram conventions</a></li>
<li class="chapter" data-level="10.2.3" data-path="function-factories.html"><a href="function-factories.html#forcing-evaluation"><i class="fa fa-check"></i><b>10.2.3</b> Forcing evaluation</a></li>
<li class="chapter" data-level="10.2.4" data-path="function-factories.html"><a href="function-factories.html#stateful-funs"><i class="fa fa-check"></i><b>10.2.4</b> Stateful functions</a></li>
<li class="chapter" data-level="10.2.5" data-path="function-factories.html"><a href="function-factories.html#factory-pitfalls"><i class="fa fa-check"></i><b>10.2.5</b> Garbage collection</a></li>
<li class="chapter" data-level="10.2.6" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>10.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="function-factories.html"><a href="function-factories.html#graph-fact"><i class="fa fa-check"></i><b>10.3</b> Graphical factories</a><ul>
<li class="chapter" data-level="10.3.1" data-path="function-factories.html"><a href="function-factories.html#labelling"><i class="fa fa-check"></i><b>10.3.1</b> Labelling</a></li>
<li class="chapter" data-level="10.3.2" data-path="function-factories.html"><a href="function-factories.html#histogram-bins"><i class="fa fa-check"></i><b>10.3.2</b> Histogram bins</a></li>
<li class="chapter" data-level="10.3.3" data-path="function-factories.html"><a href="function-factories.html#ggsave"><i class="fa fa-check"></i><b>10.3.3</b> <code>ggsave()</code></a></li>
<li class="chapter" data-level="10.3.4" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>10.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="function-factories.html"><a href="function-factories.html#stat-fact"><i class="fa fa-check"></i><b>10.4</b> Statistical factories</a><ul>
<li class="chapter" data-level="10.4.1" data-path="function-factories.html"><a href="function-factories.html#box-cox-transformation"><i class="fa fa-check"></i><b>10.4.1</b> Box-Cox transformation</a></li>
<li class="chapter" data-level="10.4.2" data-path="function-factories.html"><a href="function-factories.html#bootstrap-generators"><i class="fa fa-check"></i><b>10.4.2</b> Bootstrap generators</a></li>
<li class="chapter" data-level="10.4.3" data-path="function-factories.html"><a href="function-factories.html#MLE"><i class="fa fa-check"></i><b>10.4.3</b> Maximum likelihood estimation</a></li>
<li class="chapter" data-level="10.4.4" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>10.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="function-factories.html"><a href="function-factories.html#functional-factories"><i class="fa fa-check"></i><b>10.5</b> Function factories + functionals</a><ul>
<li class="chapter" data-level="10.5.1" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>10.5.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="function-operators.html"><a href="function-operators.html"><i class="fa fa-check"></i><b>11</b> Function operators</a><ul>
<li class="chapter" data-level="11.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>11.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="function-operators.html"><a href="function-operators.html#existing-fos"><i class="fa fa-check"></i><b>11.2</b> Existing function operators</a><ul>
<li class="chapter" data-level="11.2.1" data-path="function-operators.html"><a href="function-operators.html#safely"><i class="fa fa-check"></i><b>11.2.1</b> Capturing errors with <code>purrr::safely()</code></a></li>
<li class="chapter" data-level="11.2.2" data-path="function-operators.html"><a href="function-operators.html#memoise"><i class="fa fa-check"></i><b>11.2.2</b> Caching computations with <code>memoise::memoise()</code></a></li>
<li class="chapter" data-level="11.2.3" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>11.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="function-operators.html"><a href="function-operators.html#fo-case-study"><i class="fa fa-check"></i><b>11.3</b> Case study: Creating your own function operators</a><ul>
<li class="chapter" data-level="11.3.1" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>11.3.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Object-oriented programming</b></span></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#oop-systems"><i class="fa fa-check"></i>OOP systems</a></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#oop-in-r"><i class="fa fa-check"></i>OOP in R</a></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#sloop"><i class="fa fa-check"></i>sloop</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="base-types.html"><a href="base-types.html"><i class="fa fa-check"></i><b>12</b> Base types</a><ul>
<li class="chapter" data-level="12.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>12.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="base-types.html"><a href="base-types.html#base-vs-oo"><i class="fa fa-check"></i><b>12.2</b> Base versus OO objects</a></li>
<li class="chapter" data-level="12.3" data-path="base-types.html"><a href="base-types.html#base-types-2"><i class="fa fa-check"></i><b>12.3</b> Base types</a><ul>
<li class="chapter" data-level="12.3.1" data-path="base-types.html"><a href="base-types.html#numeric-type"><i class="fa fa-check"></i><b>12.3.1</b> Numeric type</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="s3.html"><a href="s3.html"><i class="fa fa-check"></i><b>13</b> S3</a><ul>
<li class="chapter" data-level="13.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>13.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="s3.html"><a href="s3.html#s3-basics"><i class="fa fa-check"></i><b>13.2</b> Basics</a><ul>
<li class="chapter" data-level="13.2.1" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>13.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="s3.html"><a href="s3.html#s3-classes"><i class="fa fa-check"></i><b>13.3</b> Classes</a><ul>
<li class="chapter" data-level="13.3.1" data-path="s3.html"><a href="s3.html#s3-constructor"><i class="fa fa-check"></i><b>13.3.1</b> Constructors</a></li>
<li class="chapter" data-level="13.3.2" data-path="s3.html"><a href="s3.html#validators"><i class="fa fa-check"></i><b>13.3.2</b> Validators</a></li>
<li class="chapter" data-level="13.3.3" data-path="s3.html"><a href="s3.html#helpers"><i class="fa fa-check"></i><b>13.3.3</b> Helpers</a></li>
<li class="chapter" data-level="13.3.4" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>13.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="s3.html"><a href="s3.html#s3-methods"><i class="fa fa-check"></i><b>13.4</b> Generics and methods</a><ul>
<li class="chapter" data-level="13.4.1" data-path="s3.html"><a href="s3.html#method-dispatch"><i class="fa fa-check"></i><b>13.4.1</b> Method dispatch</a></li>
<li class="chapter" data-level="13.4.2" data-path="s3.html"><a href="s3.html#finding-methods"><i class="fa fa-check"></i><b>13.4.2</b> Finding methods</a></li>
<li class="chapter" data-level="13.4.3" data-path="s3.html"><a href="s3.html#s3-arguments"><i class="fa fa-check"></i><b>13.4.3</b> Creating methods</a></li>
<li class="chapter" data-level="13.4.4" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>13.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="s3.html"><a href="s3.html#object-styles"><i class="fa fa-check"></i><b>13.5</b> Object styles</a><ul>
<li class="chapter" data-level="13.5.1" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>13.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="s3.html"><a href="s3.html#s3-inheritance"><i class="fa fa-check"></i><b>13.6</b> Inheritance</a><ul>
<li class="chapter" data-level="13.6.1" data-path="s3.html"><a href="s3.html#nextmethod"><i class="fa fa-check"></i><b>13.6.1</b> <code>NextMethod()</code></a></li>
<li class="chapter" data-level="13.6.2" data-path="s3.html"><a href="s3.html#s3-subclassing"><i class="fa fa-check"></i><b>13.6.2</b> Allowing subclassing</a></li>
<li class="chapter" data-level="13.6.3" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>13.6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="s3.html"><a href="s3.html#s3-dispatch"><i class="fa fa-check"></i><b>13.7</b> Dispatch details</a><ul>
<li class="chapter" data-level="13.7.1" data-path="s3.html"><a href="s3.html#implicit-class"><i class="fa fa-check"></i><b>13.7.1</b> S3 and base types</a></li>
<li class="chapter" data-level="13.7.2" data-path="s3.html"><a href="s3.html#internal-generics"><i class="fa fa-check"></i><b>13.7.2</b> Internal generics</a></li>
<li class="chapter" data-level="13.7.3" data-path="s3.html"><a href="s3.html#group-generics"><i class="fa fa-check"></i><b>13.7.3</b> Group generics</a></li>
<li class="chapter" data-level="13.7.4" data-path="s3.html"><a href="s3.html#double-dispatch"><i class="fa fa-check"></i><b>13.7.4</b> Double dispatch</a></li>
<li class="chapter" data-level="13.7.5" data-path="functions.html"><a href="functions.html#exercises-5"><i class="fa fa-check"></i><b>13.7.5</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="r6.html"><a href="r6.html"><i class="fa fa-check"></i><b>14</b> R6</a><ul>
<li class="chapter" data-level="14.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>14.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="r6.html"><a href="r6.html#r6-classes"><i class="fa fa-check"></i><b>14.2</b> Classes and methods</a><ul>
<li class="chapter" data-level="14.2.1" data-path="r6.html"><a href="r6.html#method-chaining"><i class="fa fa-check"></i><b>14.2.1</b> Method chaining</a></li>
<li class="chapter" data-level="14.2.2" data-path="r6.html"><a href="r6.html#r6-important-methods"><i class="fa fa-check"></i><b>14.2.2</b> Important methods</a></li>
<li class="chapter" data-level="14.2.3" data-path="r6.html"><a href="r6.html#adding-methods-after-creation"><i class="fa fa-check"></i><b>14.2.3</b> Adding methods after creation</a></li>
<li class="chapter" data-level="14.2.4" data-path="r6.html"><a href="r6.html#inheritance"><i class="fa fa-check"></i><b>14.2.4</b> Inheritance</a></li>
<li class="chapter" data-level="14.2.5" data-path="r6.html"><a href="r6.html#introspection"><i class="fa fa-check"></i><b>14.2.5</b> Introspection</a></li>
<li class="chapter" data-level="14.2.6" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>14.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="r6.html"><a href="r6.html#r6-access"><i class="fa fa-check"></i><b>14.3</b> Controlling access</a><ul>
<li class="chapter" data-level="14.3.1" data-path="r6.html"><a href="r6.html#privacy"><i class="fa fa-check"></i><b>14.3.1</b> Privacy</a></li>
<li class="chapter" data-level="14.3.2" data-path="r6.html"><a href="r6.html#active-fields"><i class="fa fa-check"></i><b>14.3.2</b> Active fields</a></li>
<li class="chapter" data-level="14.3.3" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>14.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="r6.html"><a href="r6.html#r6-semantics"><i class="fa fa-check"></i><b>14.4</b> Reference semantics</a><ul>
<li class="chapter" data-level="14.4.1" data-path="r6.html"><a href="r6.html#reasoning"><i class="fa fa-check"></i><b>14.4.1</b> Reasoning</a></li>
<li class="chapter" data-level="14.4.2" data-path="r6.html"><a href="r6.html#finalizer"><i class="fa fa-check"></i><b>14.4.2</b> Finalizer</a></li>
<li class="chapter" data-level="14.4.3" data-path="r6.html"><a href="r6.html#r6-fields"><i class="fa fa-check"></i><b>14.4.3</b> R6 fields</a></li>
<li class="chapter" data-level="14.4.4" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>14.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="r6.html"><a href="r6.html#why-r6"><i class="fa fa-check"></i><b>14.5</b> Why R6?</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="s4.html"><a href="s4.html"><i class="fa fa-check"></i><b>15</b> S4</a><ul>
<li class="chapter" data-level="15.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>15.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#learning-more"><i class="fa fa-check"></i>Learning more</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="s4.html"><a href="s4.html#s4-basics"><i class="fa fa-check"></i><b>15.2</b> Basics</a><ul>
<li class="chapter" data-level="15.2.1" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>15.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="s4.html"><a href="s4.html#s4-classes"><i class="fa fa-check"></i><b>15.3</b> Classes</a><ul>
<li class="chapter" data-level="15.3.1" data-path="r6.html"><a href="r6.html#inheritance"><i class="fa fa-check"></i><b>15.3.1</b> Inheritance</a></li>
<li class="chapter" data-level="15.3.2" data-path="r6.html"><a href="r6.html#introspection"><i class="fa fa-check"></i><b>15.3.2</b> Introspection</a></li>
<li class="chapter" data-level="15.3.3" data-path="s4.html"><a href="s4.html#redefinition"><i class="fa fa-check"></i><b>15.3.3</b> Redefinition</a></li>
<li class="chapter" data-level="15.3.4" data-path="s4.html"><a href="s4.html#helper"><i class="fa fa-check"></i><b>15.3.4</b> Helper</a></li>
<li class="chapter" data-level="15.3.5" data-path="s4.html"><a href="s4.html#validator"><i class="fa fa-check"></i><b>15.3.5</b> Validator</a></li>
<li class="chapter" data-level="15.3.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>15.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="s4.html"><a href="s4.html#s4-generics"><i class="fa fa-check"></i><b>15.4</b> Generics and methods</a><ul>
<li class="chapter" data-level="15.4.1" data-path="s4.html"><a href="s4.html#signature"><i class="fa fa-check"></i><b>15.4.1</b> Signature</a></li>
<li class="chapter" data-level="15.4.2" data-path="s4.html"><a href="s4.html#methods"><i class="fa fa-check"></i><b>15.4.2</b> Methods</a></li>
<li class="chapter" data-level="15.4.3" data-path="s4.html"><a href="s4.html#show-method"><i class="fa fa-check"></i><b>15.4.3</b> Show method</a></li>
<li class="chapter" data-level="15.4.4" data-path="s4.html"><a href="s4.html#accessors"><i class="fa fa-check"></i><b>15.4.4</b> Accessors</a></li>
<li class="chapter" data-level="15.4.5" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>15.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="s4.html"><a href="s4.html#s4-dispatch"><i class="fa fa-check"></i><b>15.5</b> Method dispatch</a><ul>
<li class="chapter" data-level="15.5.1" data-path="s4.html"><a href="s4.html#single-dispatch"><i class="fa fa-check"></i><b>15.5.1</b> Single dispatch</a></li>
<li class="chapter" data-level="15.5.2" data-path="s4.html"><a href="s4.html#multiple-inheritance"><i class="fa fa-check"></i><b>15.5.2</b> Multiple inheritance</a></li>
<li class="chapter" data-level="15.5.3" data-path="s4.html"><a href="s4.html#multiple-dispatch"><i class="fa fa-check"></i><b>15.5.3</b> Multiple dispatch</a></li>
<li class="chapter" data-level="15.5.4" data-path="s4.html"><a href="s4.html#multiple-dispatch-and-multiple-inheritance"><i class="fa fa-check"></i><b>15.5.4</b> Multiple dispatch and multiple inheritance</a></li>
<li class="chapter" data-level="15.5.5" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>15.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="s4.html"><a href="s4.html#s4-s3"><i class="fa fa-check"></i><b>15.6</b> S4 and S3</a><ul>
<li class="chapter" data-level="15.6.1" data-path="s4.html"><a href="s4.html#classes"><i class="fa fa-check"></i><b>15.6.1</b> Classes</a></li>
<li class="chapter" data-level="15.6.2" data-path="s4.html"><a href="s4.html#generics"><i class="fa fa-check"></i><b>15.6.2</b> Generics</a></li>
<li class="chapter" data-level="15.6.3" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>15.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html"><i class="fa fa-check"></i><b>16</b> Trade-offs</a><ul>
<li class="chapter" data-level="16.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>16.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-s4"><i class="fa fa-check"></i><b>16.2</b> S4 versus S3</a></li>
<li class="chapter" data-level="16.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-r6"><i class="fa fa-check"></i><b>16.3</b> R6 versus S3</a><ul>
<li class="chapter" data-level="16.3.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#namespacing"><i class="fa fa-check"></i><b>16.3.1</b> Namespacing</a></li>
<li class="chapter" data-level="16.3.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#threading-state"><i class="fa fa-check"></i><b>16.3.2</b> Threading state</a></li>
<li class="chapter" data-level="16.3.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#tradeoffs-pipe"><i class="fa fa-check"></i><b>16.3.3</b> Method chaining</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Metaprogramming</b></span></li>
<li class="chapter" data-level="" data-path="metaprogramming.html"><a href="metaprogramming.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="17" data-path="meta-big-picture.html"><a href="meta-big-picture.html"><i class="fa fa-check"></i><b>17</b> Big picture</a><ul>
<li class="chapter" data-level="17.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>17.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="meta-big-picture.html"><a href="meta-big-picture.html#code-data"><i class="fa fa-check"></i><b>17.2</b> Code is data</a></li>
<li class="chapter" data-level="17.3" data-path="meta-big-picture.html"><a href="meta-big-picture.html#code-tree"><i class="fa fa-check"></i><b>17.3</b> Code is a tree</a></li>
<li class="chapter" data-level="17.4" data-path="meta-big-picture.html"><a href="meta-big-picture.html#coding-code"><i class="fa fa-check"></i><b>17.4</b> Code can generate code</a></li>
<li class="chapter" data-level="17.5" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-intro"><i class="fa fa-check"></i><b>17.5</b> Evaluation runs code</a></li>
<li class="chapter" data-level="17.6" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-funs"><i class="fa fa-check"></i><b>17.6</b> Customising evaluation with functions</a></li>
<li class="chapter" data-level="17.7" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-data"><i class="fa fa-check"></i><b>17.7</b> Customising evaluation with data</a></li>
<li class="chapter" data-level="17.8" data-path="meta-big-picture.html"><a href="meta-big-picture.html#quosure-intro"><i class="fa fa-check"></i><b>17.8</b> Quosures</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="expressions.html"><a href="expressions.html"><i class="fa fa-check"></i><b>18</b> Expressions</a><ul>
<li class="chapter" data-level="18.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>18.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="expressions.html"><a href="expressions.html#ast"><i class="fa fa-check"></i><b>18.2</b> Abstract syntax trees</a><ul>
<li class="chapter" data-level="18.2.1" data-path="expressions.html"><a href="expressions.html#drawing"><i class="fa fa-check"></i><b>18.2.1</b> Drawing</a></li>
<li class="chapter" data-level="18.2.2" data-path="expressions.html"><a href="expressions.html#non-code-components"><i class="fa fa-check"></i><b>18.2.2</b> Non-code components</a></li>
<li class="chapter" data-level="18.2.3" data-path="expressions.html"><a href="expressions.html#infix-calls"><i class="fa fa-check"></i><b>18.2.3</b> Infix calls</a></li>
<li class="chapter" data-level="18.2.4" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>18.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="expressions.html"><a href="expressions.html#expression-details"><i class="fa fa-check"></i><b>18.3</b> Expressions</a><ul>
<li class="chapter" data-level="18.3.1" data-path="expressions.html"><a href="expressions.html#constants"><i class="fa fa-check"></i><b>18.3.1</b> Constants</a></li>
<li class="chapter" data-level="18.3.2" data-path="expressions.html"><a href="expressions.html#symbols"><i class="fa fa-check"></i><b>18.3.2</b> Symbols</a></li>
<li class="chapter" data-level="18.3.3" data-path="expressions.html"><a href="expressions.html#calls"><i class="fa fa-check"></i><b>18.3.3</b> Calls</a></li>
<li class="chapter" data-level="18.3.4" data-path="expressions.html"><a href="expressions.html#summary"><i class="fa fa-check"></i><b>18.3.4</b> Summary</a></li>
<li class="chapter" data-level="18.3.5" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>18.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="expressions.html"><a href="expressions.html#grammar"><i class="fa fa-check"></i><b>18.4</b> Parsing and grammar</a><ul>
<li class="chapter" data-level="18.4.1" data-path="expressions.html"><a href="expressions.html#operator-precedence"><i class="fa fa-check"></i><b>18.4.1</b> Operator precedence</a></li>
<li class="chapter" data-level="18.4.2" data-path="expressions.html"><a href="expressions.html#associativity"><i class="fa fa-check"></i><b>18.4.2</b> Associativity</a></li>
<li class="chapter" data-level="18.4.3" data-path="expressions.html"><a href="expressions.html#parsing"><i class="fa fa-check"></i><b>18.4.3</b> Parsing and deparsing</a></li>
<li class="chapter" data-level="18.4.4" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>18.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="expressions.html"><a href="expressions.html#ast-funs"><i class="fa fa-check"></i><b>18.5</b> Walking AST with recursive functions</a><ul>
<li class="chapter" data-level="18.5.1" data-path="expressions.html"><a href="expressions.html#finding-f-and-t"><i class="fa fa-check"></i><b>18.5.1</b> Finding F and T</a></li>
<li class="chapter" data-level="18.5.2" data-path="expressions.html"><a href="expressions.html#finding-all-variables-created-by-assignment"><i class="fa fa-check"></i><b>18.5.2</b> Finding all variables created by assignment</a></li>
<li class="chapter" data-level="18.5.3" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>18.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="expressions.html"><a href="expressions.html#expression-special"><i class="fa fa-check"></i><b>18.6</b> Specialised data structures</a><ul>
<li class="chapter" data-level="18.6.1" data-path="expressions.html"><a href="expressions.html#pairlists"><i class="fa fa-check"></i><b>18.6.1</b> Pairlists</a></li>
<li class="chapter" data-level="18.6.2" data-path="expressions.html"><a href="expressions.html#empty-symbol"><i class="fa fa-check"></i><b>18.6.2</b> Missing arguments</a></li>
<li class="chapter" data-level="18.6.3" data-path="expressions.html"><a href="expressions.html#expression-vectors"><i class="fa fa-check"></i><b>18.6.3</b> Expression vectors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="quasiquotation.html"><a href="quasiquotation.html"><i class="fa fa-check"></i><b>19</b> Quasiquotation</a><ul>
<li class="chapter" data-level="19.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>19.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#related-work"><i class="fa fa-check"></i>Related work</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="quasiquotation.html"><a href="quasiquotation.html#quasi-motivation"><i class="fa fa-check"></i><b>19.2</b> Motivation</a><ul>
<li class="chapter" data-level="19.2.1" data-path="quasiquotation.html"><a href="quasiquotation.html#vocabulary"><i class="fa fa-check"></i><b>19.2.1</b> Vocabulary</a></li>
<li class="chapter" data-level="19.2.2" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>19.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="quasiquotation.html"><a href="quasiquotation.html#quoting"><i class="fa fa-check"></i><b>19.3</b> Quoting</a><ul>
<li class="chapter" data-level="19.3.1" data-path="quasiquotation.html"><a href="quasiquotation.html#capturing-expressions"><i class="fa fa-check"></i><b>19.3.1</b> Capturing expressions</a></li>
<li class="chapter" data-level="19.3.2" data-path="quasiquotation.html"><a href="quasiquotation.html#capturing-symbols"><i class="fa fa-check"></i><b>19.3.2</b> Capturing symbols</a></li>
<li class="chapter" data-level="19.3.3" data-path="quasiquotation.html"><a href="quasiquotation.html#with-base-r"><i class="fa fa-check"></i><b>19.3.3</b> With base R</a></li>
<li class="chapter" data-level="19.3.4" data-path="quasiquotation.html"><a href="quasiquotation.html#substitution"><i class="fa fa-check"></i><b>19.3.4</b> Substitution</a></li>
<li class="chapter" data-level="19.3.5" data-path="expressions.html"><a href="expressions.html#summary"><i class="fa fa-check"></i><b>19.3.5</b> Summary</a></li>
<li class="chapter" data-level="19.3.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>19.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting"><i class="fa fa-check"></i><b>19.4</b> Unquoting</a><ul>
<li class="chapter" data-level="19.4.1" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-one-argument"><i class="fa fa-check"></i><b>19.4.1</b> Unquoting one argument</a></li>
<li class="chapter" data-level="19.4.2" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-a-function"><i class="fa fa-check"></i><b>19.4.2</b> Unquoting a function</a></li>
<li class="chapter" data-level="19.4.3" data-path="quasiquotation.html"><a href="quasiquotation.html#unquote-missing"><i class="fa fa-check"></i><b>19.4.3</b> Unquoting a missing argument</a></li>
<li class="chapter" data-level="19.4.4" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-in-special-forms"><i class="fa fa-check"></i><b>19.4.4</b> Unquoting in special forms</a></li>
<li class="chapter" data-level="19.4.5" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-many-arguments"><i class="fa fa-check"></i><b>19.4.5</b> Unquoting many arguments</a></li>
<li class="chapter" data-level="19.4.6" data-path="quasiquotation.html"><a href="quasiquotation.html#the-polite-fiction-of"><i class="fa fa-check"></i><b>19.4.6</b> The polite fiction of <code>!!</code></a></li>
<li class="chapter" data-level="19.4.7" data-path="quasiquotation.html"><a href="quasiquotation.html#non-standard-ast"><i class="fa fa-check"></i><b>19.4.7</b> Non-standard ASTs</a></li>
<li class="chapter" data-level="19.4.8" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>19.4.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="quasiquotation.html"><a href="quasiquotation.html#base-nonquote"><i class="fa fa-check"></i><b>19.5</b> Non-quoting</a></li>
<li class="chapter" data-level="19.6" data-path="quasiquotation.html"><a href="quasiquotation.html#tidy-dots"><i class="fa fa-check"></i><b>19.6</b> <code>...</code> (dot-dot-dot)</a><ul>
<li class="chapter" data-level="19.6.1" data-path="quasiquotation.html"><a href="quasiquotation.html#examples"><i class="fa fa-check"></i><b>19.6.1</b> Examples</a></li>
<li class="chapter" data-level="19.6.2" data-path="quasiquotation.html"><a href="quasiquotation.html#exec"><i class="fa fa-check"></i><b>19.6.2</b> <code>exec()</code></a></li>
<li class="chapter" data-level="19.6.3" data-path="quasiquotation.html"><a href="quasiquotation.html#dots_list"><i class="fa fa-check"></i><b>19.6.3</b> <code>dots_list()</code></a></li>
<li class="chapter" data-level="19.6.4" data-path="quasiquotation.html"><a href="quasiquotation.html#do-call"><i class="fa fa-check"></i><b>19.6.4</b> With base R</a></li>
<li class="chapter" data-level="19.6.5" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>19.6.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.7" data-path="quasiquotation.html"><a href="quasiquotation.html#expr-case-studies"><i class="fa fa-check"></i><b>19.7</b> Case studies</a><ul>
<li class="chapter" data-level="19.7.1" data-path="quasiquotation.html"><a href="quasiquotation.html#lobstrast"><i class="fa fa-check"></i><b>19.7.1</b> <code>lobstr::ast()</code></a></li>
<li class="chapter" data-level="19.7.2" data-path="quasiquotation.html"><a href="quasiquotation.html#map-reduce-to-generate-code"><i class="fa fa-check"></i><b>19.7.2</b> Map-reduce to generate code</a></li>
<li class="chapter" data-level="19.7.3" data-path="quasiquotation.html"><a href="quasiquotation.html#slicing-an-array"><i class="fa fa-check"></i><b>19.7.3</b> Slicing an array</a></li>
<li class="chapter" data-level="19.7.4" data-path="quasiquotation.html"><a href="quasiquotation.html#new-function"><i class="fa fa-check"></i><b>19.7.4</b> Creating functions</a></li>
<li class="chapter" data-level="19.7.5" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>19.7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.8" data-path="quasiquotation.html"><a href="quasiquotation.html#history"><i class="fa fa-check"></i><b>19.8</b> History</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="evaluation.html"><a href="evaluation.html"><i class="fa fa-check"></i><b>20</b> Evaluation</a><ul>
<li class="chapter" data-level="20.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>20.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="evaluation.html"><a href="evaluation.html#eval"><i class="fa fa-check"></i><b>20.2</b> Evaluation basics</a><ul>
<li class="chapter" data-level="20.2.1" data-path="evaluation.html"><a href="evaluation.html#application-local"><i class="fa fa-check"></i><b>20.2.1</b> Application: <code>local()</code></a></li>
<li class="chapter" data-level="20.2.2" data-path="evaluation.html"><a href="evaluation.html#application-source"><i class="fa fa-check"></i><b>20.2.2</b> Application: <code>source()</code></a></li>
<li class="chapter" data-level="20.2.3" data-path="evaluation.html"><a href="evaluation.html#gotcha-function"><i class="fa fa-check"></i><b>20.2.3</b> Gotcha: <code>function()</code></a></li>
<li class="chapter" data-level="20.2.4" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>20.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="evaluation.html"><a href="evaluation.html#quosures"><i class="fa fa-check"></i><b>20.3</b> Quosures</a><ul>
<li class="chapter" data-level="20.3.1" data-path="evaluation.html"><a href="evaluation.html#creating"><i class="fa fa-check"></i><b>20.3.1</b> Creating</a></li>
<li class="chapter" data-level="20.3.2" data-path="evaluation.html"><a href="evaluation.html#evaluating"><i class="fa fa-check"></i><b>20.3.2</b> Evaluating</a></li>
<li class="chapter" data-level="20.3.3" data-path="evaluation.html"><a href="evaluation.html#quosure-dots"><i class="fa fa-check"></i><b>20.3.3</b> Dots</a></li>
<li class="chapter" data-level="20.3.4" data-path="evaluation.html"><a href="evaluation.html#quosure-impl"><i class="fa fa-check"></i><b>20.3.4</b> Under the hood</a></li>
<li class="chapter" data-level="20.3.5" data-path="evaluation.html"><a href="evaluation.html#nested-quosures"><i class="fa fa-check"></i><b>20.3.5</b> Nested quosures</a></li>
<li class="chapter" data-level="20.3.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>20.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="evaluation.html"><a href="evaluation.html#data-masks"><i class="fa fa-check"></i><b>20.4</b> Data masks</a><ul>
<li class="chapter" data-level="20.4.1" data-path="environments.html"><a href="environments.html#basics"><i class="fa fa-check"></i><b>20.4.1</b> Basics</a></li>
<li class="chapter" data-level="20.4.2" data-path="evaluation.html"><a href="evaluation.html#pronouns"><i class="fa fa-check"></i><b>20.4.2</b> Pronouns</a></li>
<li class="chapter" data-level="20.4.3" data-path="evaluation.html"><a href="evaluation.html#subset"><i class="fa fa-check"></i><b>20.4.3</b> Application: <code>subset()</code></a></li>
<li class="chapter" data-level="20.4.4" data-path="evaluation.html"><a href="evaluation.html#application-transform"><i class="fa fa-check"></i><b>20.4.4</b> Application: transform</a></li>
<li class="chapter" data-level="20.4.5" data-path="evaluation.html"><a href="evaluation.html#select"><i class="fa fa-check"></i><b>20.4.5</b> Application: <code>select()</code></a></li>
<li class="chapter" data-level="20.4.6" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>20.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="evaluation.html"><a href="evaluation.html#tidy-evaluation"><i class="fa fa-check"></i><b>20.5</b> Using tidy evaluation</a><ul>
<li class="chapter" data-level="20.5.1" data-path="evaluation.html"><a href="evaluation.html#quoting-and-unquoting"><i class="fa fa-check"></i><b>20.5.1</b> Quoting and unquoting</a></li>
<li class="chapter" data-level="20.5.2" data-path="evaluation.html"><a href="evaluation.html#handling-ambiguity"><i class="fa fa-check"></i><b>20.5.2</b> Handling ambiguity</a></li>
<li class="chapter" data-level="20.5.3" data-path="evaluation.html"><a href="evaluation.html#quoting-and-ambiguity"><i class="fa fa-check"></i><b>20.5.3</b> Quoting and ambiguity</a></li>
<li class="chapter" data-level="20.5.4" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>20.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="evaluation.html"><a href="evaluation.html#base-evaluation"><i class="fa fa-check"></i><b>20.6</b> Base evaluation</a><ul>
<li class="chapter" data-level="20.6.1" data-path="evaluation.html"><a href="evaluation.html#substitute"><i class="fa fa-check"></i><b>20.6.1</b> <code>substitute()</code></a></li>
<li class="chapter" data-level="20.6.2" data-path="evaluation.html"><a href="evaluation.html#match.call"><i class="fa fa-check"></i><b>20.6.2</b> <code>match.call()</code></a></li>
<li class="chapter" data-level="20.6.3" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>20.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="translation.html"><a href="translation.html"><i class="fa fa-check"></i><b>21</b> Translating R code</a><ul>
<li class="chapter" data-level="21.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>21.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="translation.html"><a href="translation.html#html"><i class="fa fa-check"></i><b>21.2</b> HTML</a><ul>
<li class="chapter" data-level="21.2.1" data-path="translation.html"><a href="translation.html#goal"><i class="fa fa-check"></i><b>21.2.1</b> Goal</a></li>
<li class="chapter" data-level="21.2.2" data-path="translation.html"><a href="translation.html#escaping"><i class="fa fa-check"></i><b>21.2.2</b> Escaping</a></li>
<li class="chapter" data-level="21.2.3" data-path="translation.html"><a href="translation.html#basic-tag-functions"><i class="fa fa-check"></i><b>21.2.3</b> Basic tag functions</a></li>
<li class="chapter" data-level="21.2.4" data-path="translation.html"><a href="translation.html#tag-functions"><i class="fa fa-check"></i><b>21.2.4</b> Tag functions</a></li>
<li class="chapter" data-level="21.2.5" data-path="translation.html"><a href="translation.html#html-env"><i class="fa fa-check"></i><b>21.2.5</b> Processing all tags</a></li>
<li class="chapter" data-level="21.2.6" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>21.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="translation.html"><a href="translation.html#latex"><i class="fa fa-check"></i><b>21.3</b> LaTeX</a><ul>
<li class="chapter" data-level="21.3.1" data-path="translation.html"><a href="translation.html#latex-mathematics"><i class="fa fa-check"></i><b>21.3.1</b> LaTeX mathematics</a></li>
<li class="chapter" data-level="21.3.2" data-path="translation.html"><a href="translation.html#goal-1"><i class="fa fa-check"></i><b>21.3.2</b> Goal</a></li>
<li class="chapter" data-level="21.3.3" data-path="translation.html"><a href="translation.html#to_math"><i class="fa fa-check"></i><b>21.3.3</b> <code>to_math</code>()</a></li>
<li class="chapter" data-level="21.3.4" data-path="translation.html"><a href="translation.html#known-symbols"><i class="fa fa-check"></i><b>21.3.4</b> Known symbols</a></li>
<li class="chapter" data-level="21.3.5" data-path="translation.html"><a href="translation.html#unknown-symbols"><i class="fa fa-check"></i><b>21.3.5</b> Unknown symbols</a></li>
<li class="chapter" data-level="21.3.6" data-path="translation.html"><a href="translation.html#known-functions"><i class="fa fa-check"></i><b>21.3.6</b> Known functions</a></li>
<li class="chapter" data-level="21.3.7" data-path="translation.html"><a href="translation.html#unknown-functions"><i class="fa fa-check"></i><b>21.3.7</b> Unknown functions</a></li>
<li class="chapter" data-level="21.3.8" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>21.3.8</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Techniques</b></span></li>
<li class="chapter" data-level="" data-path="techniques.html"><a href="techniques.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="22" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>22</b> Debugging</a><ul>
<li class="chapter" data-level="22.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>22.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="debugging.html"><a href="debugging.html#debugging-strategy"><i class="fa fa-check"></i><b>22.2</b> Overall approach</a></li>
<li class="chapter" data-level="22.3" data-path="debugging.html"><a href="debugging.html#traceback"><i class="fa fa-check"></i><b>22.3</b> Locating errors</a><ul>
<li class="chapter" data-level="22.3.1" data-path="debugging.html"><a href="debugging.html#debug-lazy"><i class="fa fa-check"></i><b>22.3.1</b> Lazy evaluation</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="debugging.html"><a href="debugging.html#browser"><i class="fa fa-check"></i><b>22.4</b> Interactive debugger</a><ul>
<li class="chapter" data-level="22.4.1" data-path="debugging.html"><a href="debugging.html#browser-commands"><i class="fa fa-check"></i><b>22.4.1</b> <code>browser()</code> commands</a></li>
<li class="chapter" data-level="22.4.2" data-path="debugging.html"><a href="debugging.html#alternatives"><i class="fa fa-check"></i><b>22.4.2</b> Alternatives</a></li>
<li class="chapter" data-level="22.4.3" data-path="debugging.html"><a href="debugging.html#debug-compiled"><i class="fa fa-check"></i><b>22.4.3</b> Compiled code</a></li>
</ul></li>
<li class="chapter" data-level="22.5" data-path="debugging.html"><a href="debugging.html#non-interactive-debugging"><i class="fa fa-check"></i><b>22.5</b> Non-interactive debugging</a><ul>
<li class="chapter" data-level="22.5.1" data-path="debugging.html"><a href="debugging.html#dump.frames"><i class="fa fa-check"></i><b>22.5.1</b> <code>dump.frames()</code></a></li>
<li class="chapter" data-level="22.5.2" data-path="debugging.html"><a href="debugging.html#print-debugging"><i class="fa fa-check"></i><b>22.5.2</b> Print debugging</a></li>
<li class="chapter" data-level="22.5.3" data-path="debugging.html"><a href="debugging.html#rmarkdown"><i class="fa fa-check"></i><b>22.5.3</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="22.6" data-path="debugging.html"><a href="debugging.html#non-error-failures"><i class="fa fa-check"></i><b>22.6</b> Non-error failures</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="perf-measure.html"><a href="perf-measure.html"><i class="fa fa-check"></i><b>23</b> Measuring performance</a><ul>
<li class="chapter" data-level="23.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>23.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="23.2" data-path="perf-measure.html"><a href="perf-measure.html#profiling"><i class="fa fa-check"></i><b>23.2</b> Profiling</a><ul>
<li class="chapter" data-level="23.2.1" data-path="perf-measure.html"><a href="perf-measure.html#visualising-profiles"><i class="fa fa-check"></i><b>23.2.1</b> Visualising profiles</a></li>
<li class="chapter" data-level="23.2.2" data-path="perf-measure.html"><a href="perf-measure.html#memory-profiling"><i class="fa fa-check"></i><b>23.2.2</b> Memory profiling</a></li>
<li class="chapter" data-level="23.2.3" data-path="perf-measure.html"><a href="perf-measure.html#limitations"><i class="fa fa-check"></i><b>23.2.3</b> Limitations</a></li>
<li class="chapter" data-level="23.2.4" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>23.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="perf-measure.html"><a href="perf-measure.html#microbenchmarking"><i class="fa fa-check"></i><b>23.3</b> Microbenchmarking</a><ul>
<li class="chapter" data-level="23.3.1" data-path="perf-measure.html"><a href="perf-measure.html#benchmark-results"><i class="fa fa-check"></i><b>23.3.1</b> <code>bench::mark()</code> results</a></li>
<li class="chapter" data-level="23.3.2" data-path="perf-measure.html"><a href="perf-measure.html#interpreting-results"><i class="fa fa-check"></i><b>23.3.2</b> Interpreting results</a></li>
<li class="chapter" data-level="23.3.3" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>23.3.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="24" data-path="perf-improve.html"><a href="perf-improve.html"><i class="fa fa-check"></i><b>24</b> Improving performance</a><ul>
<li class="chapter" data-level="24.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>24.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="perf-improve.html"><a href="perf-improve.html#code-organisation"><i class="fa fa-check"></i><b>24.2</b> Code organisation</a></li>
<li class="chapter" data-level="24.3" data-path="perf-improve.html"><a href="perf-improve.html#already-solved"><i class="fa fa-check"></i><b>24.3</b> Checking for existing solutions</a><ul>
<li class="chapter" data-level="24.3.1" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>24.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="perf-improve.html"><a href="perf-improve.html#be-lazy"><i class="fa fa-check"></i><b>24.4</b> Doing as little as possible</a><ul>
<li class="chapter" data-level="24.4.1" data-path="perf-improve.html"><a href="perf-improve.html#mean"><i class="fa fa-check"></i><b>24.4.1</b> <code>mean()</code></a></li>
<li class="chapter" data-level="24.4.2" data-path="perf-improve.html"><a href="perf-improve.html#as.data.frame"><i class="fa fa-check"></i><b>24.4.2</b> <code>as.data.frame()</code></a></li>
<li class="chapter" data-level="24.4.3" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>24.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.5" data-path="perf-improve.html"><a href="perf-improve.html#vectorise"><i class="fa fa-check"></i><b>24.5</b> Vectorise</a><ul>
<li class="chapter" data-level="24.5.1" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>24.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.6" data-path="perf-improve.html"><a href="perf-improve.html#avoid-copies"><i class="fa fa-check"></i><b>24.6</b> Avoiding copies</a></li>
<li class="chapter" data-level="24.7" data-path="perf-improve.html"><a href="perf-improve.html#t-test"><i class="fa fa-check"></i><b>24.7</b> Case study: t-test</a></li>
<li class="chapter" data-level="24.8" data-path="perf-improve.html"><a href="perf-improve.html#more-techniques"><i class="fa fa-check"></i><b>24.8</b> Other techniques</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>25</b> Rewriting R code in C++</a><ul>
<li class="chapter" data-level="25.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>25.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro"><i class="fa fa-check"></i><b>25.2</b> Getting started with C++</a><ul>
<li class="chapter" data-level="25.2.1" data-path="rcpp.html"><a href="rcpp.html#no-inputs-scalar-output"><i class="fa fa-check"></i><b>25.2.1</b> No inputs, scalar output</a></li>
<li class="chapter" data-level="25.2.2" data-path="rcpp.html"><a href="rcpp.html#scalar-input-scalar-output"><i class="fa fa-check"></i><b>25.2.2</b> Scalar input, scalar output</a></li>
<li class="chapter" data-level="25.2.3" data-path="rcpp.html"><a href="rcpp.html#vector-input-scalar-output"><i class="fa fa-check"></i><b>25.2.3</b> Vector input, scalar output</a></li>
<li class="chapter" data-level="25.2.4" data-path="rcpp.html"><a href="rcpp.html#vector-input-vector-output"><i class="fa fa-check"></i><b>25.2.4</b> Vector input, vector output</a></li>
<li class="chapter" data-level="25.2.5" data-path="rcpp.html"><a href="rcpp.html#sourceCpp"><i class="fa fa-check"></i><b>25.2.5</b> Using sourceCpp</a></li>
<li class="chapter" data-level="25.2.6" data-path="rcpp.html"><a href="rcpp.html#exercise-started"><i class="fa fa-check"></i><b>25.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="rcpp.html"><a href="rcpp.html#rcpp-classes"><i class="fa fa-check"></i><b>25.3</b> Other classes</a><ul>
<li class="chapter" data-level="25.3.1" data-path="rcpp.html"><a href="rcpp.html#lists-and-data-frames"><i class="fa fa-check"></i><b>25.3.1</b> Lists and data frames</a></li>
<li class="chapter" data-level="25.3.2" data-path="rcpp.html"><a href="rcpp.html#functions-rcpp"><i class="fa fa-check"></i><b>25.3.2</b> Functions</a></li>
<li class="chapter" data-level="25.3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attributes"><i class="fa fa-check"></i><b>25.3.3</b> Attributes</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="rcpp.html"><a href="rcpp.html#rcpp-na"><i class="fa fa-check"></i><b>25.4</b> Missing values</a><ul>
<li class="chapter" data-level="25.4.1" data-path="vectors-chap.html"><a href="vectors-chap.html#scalars"><i class="fa fa-check"></i><b>25.4.1</b> Scalars</a></li>
<li class="chapter" data-level="25.4.2" data-path="rcpp.html"><a href="rcpp.html#strings"><i class="fa fa-check"></i><b>25.4.2</b> Strings</a></li>
<li class="chapter" data-level="25.4.3" data-path="rcpp.html"><a href="rcpp.html#boolean"><i class="fa fa-check"></i><b>25.4.3</b> Boolean</a></li>
<li class="chapter" data-level="25.4.4" data-path="rcpp.html"><a href="rcpp.html#vectors-rcpp"><i class="fa fa-check"></i><b>25.4.4</b> Vectors</a></li>
<li class="chapter" data-level="25.4.5" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>25.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="rcpp.html"><a href="rcpp.html#stl"><i class="fa fa-check"></i><b>25.5</b> Standard Template Library</a><ul>
<li class="chapter" data-level="25.5.1" data-path="rcpp.html"><a href="rcpp.html#using-iterators"><i class="fa fa-check"></i><b>25.5.1</b> Using iterators</a></li>
<li class="chapter" data-level="25.5.2" data-path="rcpp.html"><a href="rcpp.html#algorithms"><i class="fa fa-check"></i><b>25.5.2</b> Algorithms</a></li>
<li class="chapter" data-level="25.5.3" data-path="rcpp.html"><a href="rcpp.html#data-structures-rcpp"><i class="fa fa-check"></i><b>25.5.3</b> Data structures</a></li>
<li class="chapter" data-level="25.5.4" data-path="rcpp.html"><a href="rcpp.html#vectors-stl"><i class="fa fa-check"></i><b>25.5.4</b> Vectors</a></li>
<li class="chapter" data-level="25.5.5" data-path="rcpp.html"><a href="rcpp.html#sets"><i class="fa fa-check"></i><b>25.5.5</b> Sets</a></li>
<li class="chapter" data-level="25.5.6" data-path="functionals.html"><a href="functionals.html#map"><i class="fa fa-check"></i><b>25.5.6</b> Map</a></li>
<li class="chapter" data-level="25.5.7" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>25.5.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.6" data-path="rcpp.html"><a href="rcpp.html#rcpp-case-studies"><i class="fa fa-check"></i><b>25.6</b> Case studies</a><ul>
<li class="chapter" data-level="25.6.1" data-path="rcpp.html"><a href="rcpp.html#gibbs-sampler"><i class="fa fa-check"></i><b>25.6.1</b> Gibbs sampler</a></li>
<li class="chapter" data-level="25.6.2" data-path="rcpp.html"><a href="rcpp.html#r-vectorisation-versus-c-vectorisation"><i class="fa fa-check"></i><b>25.6.2</b> R vectorisation versus C++ vectorisation</a></li>
</ul></li>
<li class="chapter" data-level="25.7" data-path="rcpp.html"><a href="rcpp.html#rcpp-package"><i class="fa fa-check"></i><b>25.7</b> Using Rcpp in a package</a></li>
<li class="chapter" data-level="25.8" data-path="rcpp.html"><a href="rcpp.html#rcpp-more"><i class="fa fa-check"></i><b>25.8</b> Learning more</a></li>
<li class="chapter" data-level="25.9" data-path="rcpp.html"><a href="rcpp.html#acknowledgments"><i class="fa fa-check"></i><b>25.9</b> Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="function-factories" class="section level1">
<h1><span class="header-section-number">10</span> Function factories</h1>
<p></p>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">10.1</span> Introduction</h2>
<p>A <strong>function factory</strong> is a function that makes functions. Here’s a very simple example: we use a function factory (<code>power1()</code>) to make two child functions (<code>square()</code> and <code>cube()</code>):</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb458-1" data-line-number="1">power1 &lt;-<span class="st"> </span><span class="cf">function</span>(exp) {</a>
<a class="sourceLine" id="cb458-2" data-line-number="2">  <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb458-3" data-line-number="3">    x <span class="op">^</span><span class="st"> </span>exp</a>
<a class="sourceLine" id="cb458-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb458-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb458-6" data-line-number="6"></a>
<a class="sourceLine" id="cb458-7" data-line-number="7">square &lt;-<span class="st"> </span><span class="kw">power1</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb458-8" data-line-number="8">cube &lt;-<span class="st"> </span><span class="kw">power1</span>(<span class="dv">3</span>)</a></code></pre></div>
<p>Don’t worry if this doesn’t make sense yet, it should by the end of the chapter!</p>
<p>

I’ll call <code>square()</code> and <code>cube()</code> <strong>manufactured functions</strong>, but this is just a term to ease communication with other humans: from R’s perspective they are no different to functions created any other way.</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb459-1" data-line-number="1"><span class="kw">square</span>(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb459-2" data-line-number="2"><span class="co">#&gt; [1] 9</span></a>
<a class="sourceLine" id="cb459-3" data-line-number="3"><span class="kw">cube</span>(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb459-4" data-line-number="4"><span class="co">#&gt; [1] 27</span></a></code></pre></div>
<p>You have already learned about the individual components that make function factories possible:</p>
<ul>
<li><p>In Section <a href="functions.html#first-class-functions">6.2.3</a>, you learned about R’s first-class
functions. In R, you bind a function to a name in the same way as you bind
any object to a name: with <code>&lt;-</code>.</p></li>
<li><p>In Section <a href="environments.html#function-environments">7.4.2</a>, you learned that a function
captures (encloses) the environment in which it is created.</p></li>
<li><p>In Section <a href="environments.html#execution-environments">7.4.4</a>, you learned that a function
creates a new execution environment every time it is run. This environment
is usually ephemeral, but here it becomes the enclosing environment of
the manufactured function.</p></li>
</ul>
<p>In this chapter, you’ll learn how the non-obvious combination of these three features leads to the function factory. You’ll also see examples of their usage in visualisation and statistics.</p>
<p>Of the three main functional programming tools (functionals, function factories, and function operators), function factories are the least used. Generally, they don’t tend to reduce overall code complexity but instead partition complexity into more easily digested chunks. Function factories are also an important building block for the very useful function operators, which you’ll learn about in Chapter <a href="function-operators.html#function-operators">11</a>.</p>
<div id="outline" class="section level3 unnumbered">
<h3>Outline</h3>
<ul>
<li><p>Section <a href="function-factories.html#factory-fundamentals">10.2</a> begins the chapter with an explanation
of how function factories work, pulling together ideas from scoping and
environments. You’ll also see how function factories can be used to implement
a memory for functions, allowing data to persist across calls.</p></li>
<li><p>Section <a href="function-factories.html#graph-fact">10.3</a> illustrates the use of function factories with
examples from ggplot2. You’ll see two examples of how ggplot2 works
with user supplied function factories, and one example of where ggplot2
uses a function factory internally.</p></li>
<li><p>Section <a href="function-factories.html#stat-fact">10.4</a> uses function factories to tackle three challenges from
statistics: understanding the Box-Cox transform, solving maximum likelihood
problems, and drawing bootstrap resamples.</p></li>
<li><p>Section <a href="function-factories.html#functional-factories">10.5</a> shows how you can combine function
factories and functionals to rapidly generate a family of functions from data.</p></li>
</ul>
</div>
<div id="prerequisites" class="section level3 unnumbered">
<h3>Prerequisites</h3>
<p>Make sure you’re familiar with the contents of Sections <a href="functions.html#first-class-functions">6.2.3</a> (first-class functions), <a href="environments.html#function-environments">7.4.2</a> (the function environment), and <a href="environments.html#execution-environments">7.4.4</a> (execution environments) mentioned above.</p>
<p>Function factories only need base R. We’ll use a little <a href="https://rlang.r-lib.org">rlang</a> to peek inside of them more easily, and we’ll use <a href="https://ggplot2.tidyverse.org">ggplot2</a> and <a href="https://scales.r-lib.org">scales</a> to explore the use of function factories in visualisation.</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb460-1" data-line-number="1"><span class="kw">library</span>(rlang)</a>
<a class="sourceLine" id="cb460-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb460-3" data-line-number="3"><span class="kw">library</span>(scales)</a></code></pre></div>
</div>
</div>
<div id="factory-fundamentals" class="section level2">
<h2><span class="header-section-number">10.2</span> Factory fundamentals</h2>
<p>The key idea that makes function factories work can be expressed very concisely:</p>
<blockquote>
<p>The enclosing environment of the manufactured function is an execution
environment of the function factory.</p>
</blockquote>
<p>It only takes few words to express these big ideas, but it takes a lot more work to really understand what this means. This section will help you put the pieces together with interactive exploration and some diagrams.</p>
<div id="environments" class="section level3">
<h3><span class="header-section-number">10.2.1</span> Environments</h3>
<p>Let’s start by taking a look at <code>square()</code> and <code>cube()</code>:</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb461-1" data-line-number="1">square</a>
<a class="sourceLine" id="cb461-2" data-line-number="2"><span class="co">#&gt; function(x) {</span></a>
<a class="sourceLine" id="cb461-3" data-line-number="3"><span class="co">#&gt;     x ^ exp</span></a>
<a class="sourceLine" id="cb461-4" data-line-number="4"><span class="co">#&gt;   }</span></a>
<a class="sourceLine" id="cb461-5" data-line-number="5"><span class="co">#&gt; &lt;environment: 0x7ffacfc13ae0&gt;</span></a>
<a class="sourceLine" id="cb461-6" data-line-number="6"></a>
<a class="sourceLine" id="cb461-7" data-line-number="7">cube</a>
<a class="sourceLine" id="cb461-8" data-line-number="8"><span class="co">#&gt; function(x) {</span></a>
<a class="sourceLine" id="cb461-9" data-line-number="9"><span class="co">#&gt;     x ^ exp</span></a>
<a class="sourceLine" id="cb461-10" data-line-number="10"><span class="co">#&gt;   }</span></a>
<a class="sourceLine" id="cb461-11" data-line-number="11"><span class="co">#&gt; &lt;bytecode: 0x7ffacdc2b168&gt;</span></a>
<a class="sourceLine" id="cb461-12" data-line-number="12"><span class="co">#&gt; &lt;environment: 0x7fface5b92c0&gt;</span></a></code></pre></div>
<p>It’s obvious where <code>x</code> comes from, but how does R find the value associated with <code>exp</code>? Simply printing the manufactured functions is not revealing because the bodies are identical; the contents of the enclosing environment are the important factors. We can get a little more insight by using <code>rlang::env_print()</code>. That shows us that we have two different environments (each of which was originally an execution environment of <code>power1()</code>). The environments have the same parent, which is the enclosing environment of <code>power1()</code>, the global environment.</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb462-1" data-line-number="1"><span class="kw">env_print</span>(square)</a>
<a class="sourceLine" id="cb462-2" data-line-number="2"><span class="co">#&gt; &lt;environment: 0x7ffacfc13ae0&gt;</span></a>
<a class="sourceLine" id="cb462-3" data-line-number="3"><span class="co">#&gt; parent: &lt;environment: global&gt;</span></a>
<a class="sourceLine" id="cb462-4" data-line-number="4"><span class="co">#&gt; bindings:</span></a>
<a class="sourceLine" id="cb462-5" data-line-number="5"><span class="co">#&gt;  * exp: &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb462-6" data-line-number="6"></a>
<a class="sourceLine" id="cb462-7" data-line-number="7"><span class="kw">env_print</span>(cube)</a>
<a class="sourceLine" id="cb462-8" data-line-number="8"><span class="co">#&gt; &lt;environment: 0x7fface5b92c0&gt;</span></a>
<a class="sourceLine" id="cb462-9" data-line-number="9"><span class="co">#&gt; parent: &lt;environment: global&gt;</span></a>
<a class="sourceLine" id="cb462-10" data-line-number="10"><span class="co">#&gt; bindings:</span></a>
<a class="sourceLine" id="cb462-11" data-line-number="11"><span class="co">#&gt;  * exp: &lt;dbl&gt;</span></a></code></pre></div>
<p><code>env_print()</code> shows us that both environments have a binding to <code>exp</code>, but we want to see its value<a href="#fn41" class="footnote-ref" id="fnref41"><sup>41</sup></a>. We can do that by first getting the environment of the function, and then extracting the values:</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb463-1" data-line-number="1"><span class="kw">fn_env</span>(square)<span class="op">$</span>exp</a>
<a class="sourceLine" id="cb463-2" data-line-number="2"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb463-3" data-line-number="3"></a>
<a class="sourceLine" id="cb463-4" data-line-number="4"><span class="kw">fn_env</span>(cube)<span class="op">$</span>exp</a>
<a class="sourceLine" id="cb463-5" data-line-number="5"><span class="co">#&gt; [1] 3</span></a></code></pre></div>
<p>This is what makes manufactured functions behave differently from one another: names in the enclosing environment are bound to different values.</p>
</div>
<div id="diagram-conventions" class="section level3">
<h3><span class="header-section-number">10.2.2</span> Diagram conventions</h3>
<p>We can also show these relationships in a diagram:</p>
<p><img src="diagrams/function-factories/power-full.png" style="display: block; margin: auto;" /></p>
<p>There’s a lot going on this diagram and some of the details aren’t that important. We can simplify considerably by using two conventions:</p>
<ul>
<li><p>Any free floating symbol lives in the global environment.</p></li>
<li><p>Any environment without an explicit parent inherits from the global
environment.</p></li>
</ul>
<p><img src="diagrams/function-factories/power-simple.png" style="display: block; margin: auto;" /></p>
<p>This view, which focuses on the environments, doesn’t show any direct link between <code>cube()</code> and <code>square()</code>. That’s because the link is the through the body of the function, which is identical for both, but is not shown in this diagram.</p>
<p>To finish up, let’s look at the execution environment of <code>square(10)</code>. When <code>square()</code> executes <code>x ^ exp</code> it finds <code>x</code> in the execution environment and <code>exp</code> in its enclosing environment.</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb464-1" data-line-number="1"><span class="kw">square</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb464-2" data-line-number="2"><span class="co">#&gt; [1] 100</span></a></code></pre></div>
<p><img src="diagrams/function-factories/power-exec.png" style="display: block; margin: auto;" /></p>
</div>
<div id="forcing-evaluation" class="section level3">
<h3><span class="header-section-number">10.2.3</span> Forcing evaluation</h3>

<p>There’s a subtle bug in <code>power1()</code> caused by lazy evaluation. To see the problem we need to introduce some indirection:</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb465-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb465-2" data-line-number="2">square &lt;-<span class="st"> </span><span class="kw">power1</span>(x)</a>
<a class="sourceLine" id="cb465-3" data-line-number="3">x &lt;-<span class="st"> </span><span class="dv">3</span></a></code></pre></div>
<p>What should <code>square(2)</code> return? You would hope it returns 4:</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb466-1" data-line-number="1"><span class="kw">square</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb466-2" data-line-number="2"><span class="co">#&gt; [1] 8</span></a></code></pre></div>
<p>Unfortunately it doesn’t because <code>x</code> is only evaluated lazily when <code>square()</code> is run, not when <code>power1()</code> is run. In general, this problem will arise whenever a binding changes in between calling the factory function and calling the manufactured function. This is likely to only happen rarely, but when it does, it will lead to a real head-scratcher of a bug.</p>
<p>We can fix this problem by <strong>forcing</strong> evaluation with <code>force()</code>:</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb467-1" data-line-number="1">power2 &lt;-<span class="st"> </span><span class="cf">function</span>(exp) {</a>
<a class="sourceLine" id="cb467-2" data-line-number="2">  <span class="kw">force</span>(exp)</a>
<a class="sourceLine" id="cb467-3" data-line-number="3">  <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb467-4" data-line-number="4">    x <span class="op">^</span><span class="st"> </span>exp</a>
<a class="sourceLine" id="cb467-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb467-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb467-7" data-line-number="7"></a>
<a class="sourceLine" id="cb467-8" data-line-number="8">x &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb467-9" data-line-number="9">square &lt;-<span class="st"> </span><span class="kw">power2</span>(x)</a>
<a class="sourceLine" id="cb467-10" data-line-number="10">x &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb467-11" data-line-number="11"><span class="kw">square</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb467-12" data-line-number="12"><span class="co">#&gt; [1] 4</span></a></code></pre></div>
<p>Whenever you create a function factory, make sure every argument is evaluated, using <code>force()</code> as necessary if the argument is only used by the manufactured function.</p>
</div>
<div id="stateful-funs" class="section level3">
<h3><span class="header-section-number">10.2.4</span> Stateful functions</h3>

<p></p>
<p>Function factories also allow you to maintain state across function invocations, which is generally hard to do because of the fresh start principle described in Section <a href="functions.html#fresh-start">6.4.3</a>.</p>
<p>There are two things that make this possible:</p>
<ul>
<li><p>The enclosing environment of the manufactured function is unique and constant.</p></li>
<li><p>R has a special assignment operator, <code>&lt;&lt;-</code>, which modifies bindings in the
enclosing environment.</p></li>
</ul>
<p>The usual assignment operator, <code>&lt;-</code>, always creates a binding in the current environment. The <strong>super assignment operator</strong>, <code>&lt;&lt;-</code> rebinds an existing name found in a parent environment.</p>
<p>The following example shows how we can combine these ideas to create a function that records how many times it has been called:</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb468-1" data-line-number="1">new_counter &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb468-2" data-line-number="2">  i &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb468-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb468-4" data-line-number="4">  <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb468-5" data-line-number="5">    i &lt;&lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb468-6" data-line-number="6">    i</a>
<a class="sourceLine" id="cb468-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb468-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb468-9" data-line-number="9"></a>
<a class="sourceLine" id="cb468-10" data-line-number="10">counter_one &lt;-<span class="st"> </span><span class="kw">new_counter</span>()</a>
<a class="sourceLine" id="cb468-11" data-line-number="11">counter_two &lt;-<span class="st"> </span><span class="kw">new_counter</span>()</a></code></pre></div>
<p><img src="diagrams/function-factories/counter-1.png" style="display: block; margin: auto;" /></p>
<p>When the manufactured function is run <code>i &lt;&lt;- i + 1</code> will modify <code>i</code> in its enclosing environment. Because manufactured functions have independent enclosing environments, they have independent counts:</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb469-1" data-line-number="1"><span class="kw">counter_one</span>()</a>
<a class="sourceLine" id="cb469-2" data-line-number="2"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb469-3" data-line-number="3"><span class="kw">counter_one</span>()</a>
<a class="sourceLine" id="cb469-4" data-line-number="4"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb469-5" data-line-number="5"><span class="kw">counter_two</span>()</a>
<a class="sourceLine" id="cb469-6" data-line-number="6"><span class="co">#&gt; [1] 1</span></a></code></pre></div>
<p><img src="diagrams/function-factories/counter-2.png" style="display: block; margin: auto;" /></p>
<p>Stateful functions are best used in moderation. As soon as your function starts managing the state of multiple variables, it’s better to switch to R6, the topic of Chapter <a href="r6.html#r6">14</a>.</p>
</div>
<div id="factory-pitfalls" class="section level3">
<h3><span class="header-section-number">10.2.5</span> Garbage collection</h3>
<p></p>
<p>With most functions, you can rely on the garbage collector to clean up any large temporary objects created inside a function. However, manufactured functions hold on to the execution environment, so you’ll need to explicitly unbind any large temporary objects with <code>rm()</code>. Compare the sizes of <code>g1()</code> and <code>g2()</code> in the example below:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb470-1" data-line-number="1">f1 &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb470-2" data-line-number="2">  x &lt;-<span class="st"> </span><span class="kw">runif</span>(n)</a>
<a class="sourceLine" id="cb470-3" data-line-number="3">  m &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</a>
<a class="sourceLine" id="cb470-4" data-line-number="4">  <span class="cf">function</span>() m</a>
<a class="sourceLine" id="cb470-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb470-6" data-line-number="6"></a>
<a class="sourceLine" id="cb470-7" data-line-number="7">g1 &lt;-<span class="st"> </span><span class="kw">f1</span>(<span class="fl">1e6</span>)</a>
<a class="sourceLine" id="cb470-8" data-line-number="8">lobstr<span class="op">::</span><span class="kw">obj_size</span>(g1)</a>
<a class="sourceLine" id="cb470-9" data-line-number="9"><span class="co">#&gt; 8,013,104 B</span></a>
<a class="sourceLine" id="cb470-10" data-line-number="10"></a>
<a class="sourceLine" id="cb470-11" data-line-number="11">f2 &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb470-12" data-line-number="12">  x &lt;-<span class="st"> </span><span class="kw">runif</span>(n)</a>
<a class="sourceLine" id="cb470-13" data-line-number="13">  m &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</a>
<a class="sourceLine" id="cb470-14" data-line-number="14">  <span class="kw">rm</span>(x)</a>
<a class="sourceLine" id="cb470-15" data-line-number="15">  <span class="cf">function</span>() m</a>
<a class="sourceLine" id="cb470-16" data-line-number="16">}</a>
<a class="sourceLine" id="cb470-17" data-line-number="17"></a>
<a class="sourceLine" id="cb470-18" data-line-number="18">g2 &lt;-<span class="st"> </span><span class="kw">f2</span>(<span class="fl">1e6</span>)</a>
<a class="sourceLine" id="cb470-19" data-line-number="19">lobstr<span class="op">::</span><span class="kw">obj_size</span>(g2)</a>
<a class="sourceLine" id="cb470-20" data-line-number="20"><span class="co">#&gt; 12,944 B</span></a></code></pre></div>
</div>
<div id="exercises" class="section level3">
<h3><span class="header-section-number">10.2.6</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>The definition of <code>force()</code> is simple:</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb471-1" data-line-number="1">force</a>
<a class="sourceLine" id="cb471-2" data-line-number="2"><span class="co">#&gt; function (x) </span></a>
<a class="sourceLine" id="cb471-3" data-line-number="3"><span class="co">#&gt; x</span></a>
<a class="sourceLine" id="cb471-4" data-line-number="4"><span class="co">#&gt; &lt;bytecode: 0x7ffacd8a7a08&gt;</span></a>
<a class="sourceLine" id="cb471-5" data-line-number="5"><span class="co">#&gt; &lt;environment: namespace:base&gt;</span></a></code></pre></div>
<p>Why is it better to <code>force(x)</code> instead of just <code>x</code>?</p></li>
<li><p>Base R contains two function factories, <code>approxfun()</code> and <code>ecdf()</code>.
Read their documentation and experiment to figure out what the functions
do and what they return.</p></li>
<li><p>Create a function <code>pick()</code> that takes an index, <code>i</code>, as an argument and
returns a function with an argument <code>x</code> that subsets <code>x</code> with <code>i</code>.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb472-1" data-line-number="1"><span class="kw">pick</span>(<span class="dv">1</span>)(x)</a>
<a class="sourceLine" id="cb472-2" data-line-number="2"><span class="co"># should be equivalent to</span></a>
<a class="sourceLine" id="cb472-3" data-line-number="3">x[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb472-4" data-line-number="4"></a>
<a class="sourceLine" id="cb472-5" data-line-number="5"><span class="kw">lapply</span>(mtcars, <span class="kw">pick</span>(<span class="dv">5</span>))</a>
<a class="sourceLine" id="cb472-6" data-line-number="6"><span class="co"># should be equivalent to</span></a>
<a class="sourceLine" id="cb472-7" data-line-number="7"><span class="kw">lapply</span>(mtcars, <span class="cf">function</span>(x) x[[<span class="dv">5</span>]])</a></code></pre></div></li>
<li><p>Create a function that creates functions that compute the i<sup>th</sup>
<a href="http://en.wikipedia.org/wiki/Central_moment">central moment</a> of a numeric
vector. You can test it by running the following code:</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb473-1" data-line-number="1">m1 &lt;-<span class="st"> </span><span class="kw">moment</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb473-2" data-line-number="2">m2 &lt;-<span class="st"> </span><span class="kw">moment</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb473-3" data-line-number="3"></a>
<a class="sourceLine" id="cb473-4" data-line-number="4">x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb473-5" data-line-number="5"><span class="kw">stopifnot</span>(<span class="kw">all.equal</span>(<span class="kw">m1</span>(x), <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb473-6" data-line-number="6"><span class="kw">stopifnot</span>(<span class="kw">all.equal</span>(<span class="kw">m2</span>(x), <span class="kw">var</span>(x) <span class="op">*</span><span class="st"> </span><span class="dv">99</span> <span class="op">/</span><span class="st"> </span><span class="dv">100</span>))</a></code></pre></div></li>
<li><p>What happens if you don’t use a closure? Make predictions, then verify with
the code below.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb474-1" data-line-number="1">i &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb474-2" data-line-number="2">new_counter2 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb474-3" data-line-number="3">  i &lt;&lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb474-4" data-line-number="4">  i</a>
<a class="sourceLine" id="cb474-5" data-line-number="5">}</a></code></pre></div></li>
<li><p>What happens if you use <code>&lt;-</code> instead of <code>&lt;&lt;-</code>? Make predictions, then verify
with the code below.</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb475-1" data-line-number="1">new_counter3 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb475-2" data-line-number="2">  i &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb475-3" data-line-number="3">  <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb475-4" data-line-number="4">    i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb475-5" data-line-number="5">    i</a>
<a class="sourceLine" id="cb475-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb475-7" data-line-number="7">}</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="graph-fact" class="section level2">
<h2><span class="header-section-number">10.3</span> Graphical factories</h2>
<p>We’ll begin our exploration of useful function factories with a few examples from ggplot2.</p>
<div id="labelling" class="section level3">
<h3><span class="header-section-number">10.3.1</span> Labelling</h3>
<p>One of the goals of the <a href="http://scales.r-lib.org">scales</a> package is to make it easy to customise the labels on ggplot2. It provides many functions to control the fine details of axes and legends. The formatter functions<a href="#fn42" class="footnote-ref" id="fnref42"><sup>42</sup></a> are a useful class of functions which make it easier to control the appearance of axis breaks. The design of these functions might initially seem a little odd: they all return a function, which you have to call in order to format a number.</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb476-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">12345</span>, <span class="dv">123456</span>, <span class="dv">1234567</span>)</a>
<a class="sourceLine" id="cb476-2" data-line-number="2"><span class="kw">comma_format</span>()(y)</a>
<a class="sourceLine" id="cb476-3" data-line-number="3"><span class="co">#&gt; [1] &quot;12,345&quot;    &quot;123,456&quot;   &quot;1,234,567&quot;</span></a>
<a class="sourceLine" id="cb476-4" data-line-number="4"></a>
<a class="sourceLine" id="cb476-5" data-line-number="5"><span class="kw">number_format</span>(<span class="dt">scale =</span> <span class="fl">1e-3</span>, <span class="dt">suffix =</span> <span class="st">&quot; K&quot;</span>)(y)</a>
<a class="sourceLine" id="cb476-6" data-line-number="6"><span class="co">#&gt; [1] &quot;12 K&quot;    &quot;123 K&quot;   &quot;1 235 K&quot;</span></a></code></pre></div>
<p>In other words, the primary interface is a function factory. At first glance, this seems to add extra complexity for little gain. But it enables a nice interaction with ggplot2’s scales, because they accept functions in the <code>label</code> argument:</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb477-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> y)</a>
<a class="sourceLine" id="cb477-2" data-line-number="2">core &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb477-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb477-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span>, <span class="dt">labels =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb477-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb477-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb477-7" data-line-number="7">core</a>
<a class="sourceLine" id="cb477-8" data-line-number="8">core <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb477-9" data-line-number="9">  <span class="dt">labels =</span> <span class="kw">comma_format</span>()</a>
<a class="sourceLine" id="cb477-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb477-11" data-line-number="11">core <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb477-12" data-line-number="12">  <span class="dt">labels =</span> <span class="kw">number_format</span>(<span class="dt">scale =</span> <span class="fl">1e-3</span>, <span class="dt">suffix =</span> <span class="st">&quot; K&quot;</span>)</a>
<a class="sourceLine" id="cb477-13" data-line-number="13">)</a>
<a class="sourceLine" id="cb477-14" data-line-number="14">core <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb477-15" data-line-number="15">  <span class="dt">labels =</span> <span class="kw">scientific_format</span>()</a>
<a class="sourceLine" id="cb477-16" data-line-number="16">)</a></code></pre></div>
<p><img src="Function-factories_files/figure-html/unnamed-chunk-25-1.png" width="24%" /><img src="Function-factories_files/figure-html/unnamed-chunk-25-2.png" width="24%" /><img src="Function-factories_files/figure-html/unnamed-chunk-25-3.png" width="24%" /><img src="Function-factories_files/figure-html/unnamed-chunk-25-4.png" width="24%" /></p>
</div>
<div id="histogram-bins" class="section level3">
<h3><span class="header-section-number">10.3.2</span> Histogram bins</h3>
<p>A little known feature of <code>geom_histogram()</code> is that the <code>binwidth</code> argument can be a function. This is particularly useful because the function is executed once for each group, which means you can have different binwidths in different facets, which is otherwise not possible.</p>
<p>To illustrate this idea, and see where variable binwidth might be useful, I’m going to construct an example where a fixed binwidth isn’t great.</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb478-1" data-line-number="1"><span class="co"># construct some sample data with very different numbers in each cell</span></a>
<a class="sourceLine" id="cb478-2" data-line-number="2">sd &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">15</span>)</a>
<a class="sourceLine" id="cb478-3" data-line-number="3">n &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb478-4" data-line-number="4"></a>
<a class="sourceLine" id="cb478-5" data-line-number="5">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="dv">3</span> <span class="op">*</span><span class="st"> </span>n, <span class="dt">sd =</span> sd), <span class="dt">sd =</span> <span class="kw">rep</span>(sd, n))</a>
<a class="sourceLine" id="cb478-6" data-line-number="6"></a>
<a class="sourceLine" id="cb478-7" data-line-number="7"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(x)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb478-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb478-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>sd, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb478-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>)</a></code></pre></div>
<p><img src="Function-factories_files/figure-html/unnamed-chunk-26-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Here each facet has the same number of observations, but the variability is very different. It would be nice if we could request that the binwidths vary so we get approximately the same number of observations in each bin. One way to do that is with a function factory that inputs the desired number of bins (<code>n</code>), and outputs a function that takes a numeric vector and returns a binwidth:</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb479-1" data-line-number="1">binwidth_bins &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb479-2" data-line-number="2">  <span class="kw">force</span>(n)</a>
<a class="sourceLine" id="cb479-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb479-4" data-line-number="4">  <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb479-5" data-line-number="5">    (<span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)) <span class="op">/</span><span class="st"> </span>n</a>
<a class="sourceLine" id="cb479-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb479-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb479-8" data-line-number="8"></a>
<a class="sourceLine" id="cb479-9" data-line-number="9"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(x)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb479-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="kw">binwidth_bins</span>(<span class="dv">20</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb479-11" data-line-number="11"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>sd, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb479-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>)</a></code></pre></div>
<p><img src="Function-factories_files/figure-html/unnamed-chunk-27-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>We could use this same pattern to wrap around the base R functions that automatically find the so-called optimal<a href="#fn43" class="footnote-ref" id="fnref43"><sup>43</sup></a> binwidth, <code>nclass.Sturges()</code>, <code>nclass.scott()</code>, and <code>nclass.FD()</code>:</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb480-1" data-line-number="1">base_bins &lt;-<span class="st"> </span><span class="cf">function</span>(type) {</a>
<a class="sourceLine" id="cb480-2" data-line-number="2">  fun &lt;-<span class="st"> </span><span class="cf">switch</span>(type,</a>
<a class="sourceLine" id="cb480-3" data-line-number="3">    <span class="dt">Sturges =</span> nclass.Sturges,</a>
<a class="sourceLine" id="cb480-4" data-line-number="4">    <span class="dt">scott =</span> nclass.scott,</a>
<a class="sourceLine" id="cb480-5" data-line-number="5">    <span class="dt">FD =</span> nclass.FD,</a>
<a class="sourceLine" id="cb480-6" data-line-number="6">    <span class="kw">stop</span>(<span class="st">&quot;Unknown type&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb480-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb480-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb480-9" data-line-number="9">  <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb480-10" data-line-number="10">    (<span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)) <span class="op">/</span><span class="st"> </span><span class="kw">fun</span>(x)</a>
<a class="sourceLine" id="cb480-11" data-line-number="11">  }</a>
<a class="sourceLine" id="cb480-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb480-13" data-line-number="13"></a>
<a class="sourceLine" id="cb480-14" data-line-number="14"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(x)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb480-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="kw">base_bins</span>(<span class="st">&quot;FD&quot;</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb480-16" data-line-number="16"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>sd, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb480-17" data-line-number="17"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>)</a></code></pre></div>
<p><img src="Function-factories_files/figure-html/unnamed-chunk-28-1.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggsave" class="section level3">
<h3><span class="header-section-number">10.3.3</span> <code>ggsave()</code></h3>

<p>Finally, I want to show a function factory used internally by ggplot2. <code>ggplot2:::plot_dev()</code> is used by <code>ggsave()</code> to go from a file extension (e.g. <code>png</code>, <code>jpeg</code> etc) to a graphics device function (e.g. <code>png()</code>, <code>jpeg()</code>). The challenge here arises because the base graphics devices have some minor inconsistencies which we need to paper over:</p>
<ul>
<li><p>Most have <code>filename</code> as first argument but some have <code>file</code>.</p></li>
<li><p>The <code>width</code> and <code>height</code> of raster graphic devices use pixels units
by default, but the vector graphics use inches.</p></li>
</ul>
<p>A mildly simplified version of <code>plot_dev()</code> is shown below:</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb481-1" data-line-number="1">plot_dev &lt;-<span class="st"> </span><span class="cf">function</span>(ext, <span class="dt">dpi =</span> <span class="dv">96</span>) {</a>
<a class="sourceLine" id="cb481-2" data-line-number="2">  <span class="kw">force</span>(dpi)</a>
<a class="sourceLine" id="cb481-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb481-4" data-line-number="4">  <span class="cf">switch</span>(ext,</a>
<a class="sourceLine" id="cb481-5" data-line-number="5">    <span class="dt">eps =</span>  ,</a>
<a class="sourceLine" id="cb481-6" data-line-number="6">    <span class="dt">ps  =</span>  <span class="cf">function</span>(path, ...) {</a>
<a class="sourceLine" id="cb481-7" data-line-number="7">      grDevices<span class="op">::</span><span class="kw">postscript</span>(</a>
<a class="sourceLine" id="cb481-8" data-line-number="8">        <span class="dt">file =</span> filename, ..., <span class="dt">onefile =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb481-9" data-line-number="9">        <span class="dt">horizontal =</span> <span class="ot">FALSE</span>, <span class="dt">paper =</span> <span class="st">&quot;special&quot;</span></a>
<a class="sourceLine" id="cb481-10" data-line-number="10">      )</a>
<a class="sourceLine" id="cb481-11" data-line-number="11">    },</a>
<a class="sourceLine" id="cb481-12" data-line-number="12">    <span class="dt">pdf =</span> <span class="cf">function</span>(filename, ...) grDevices<span class="op">::</span><span class="kw">pdf</span>(<span class="dt">file =</span> filename, ...),</a>
<a class="sourceLine" id="cb481-13" data-line-number="13">    <span class="dt">svg =</span> <span class="cf">function</span>(filename, ...) svglite<span class="op">::</span><span class="kw">svglite</span>(<span class="dt">file =</span> filename, ...),</a>
<a class="sourceLine" id="cb481-14" data-line-number="14">    <span class="dt">emf =</span> ,</a>
<a class="sourceLine" id="cb481-15" data-line-number="15">    <span class="dt">wmf =</span> <span class="cf">function</span>(...) grDevices<span class="op">::</span><span class="kw">win.metafile</span>(...),</a>
<a class="sourceLine" id="cb481-16" data-line-number="16">    <span class="dt">png =</span> <span class="cf">function</span>(...) grDevices<span class="op">::</span><span class="kw">png</span>(..., <span class="dt">res =</span> dpi, <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>),</a>
<a class="sourceLine" id="cb481-17" data-line-number="17">    <span class="dt">jpg =</span> ,</a>
<a class="sourceLine" id="cb481-18" data-line-number="18">    <span class="dt">jpeg =</span> <span class="cf">function</span>(...) grDevices<span class="op">::</span><span class="kw">jpeg</span>(..., <span class="dt">res =</span> dpi, <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>),</a>
<a class="sourceLine" id="cb481-19" data-line-number="19">    <span class="dt">bmp =</span> <span class="cf">function</span>(...) grDevices<span class="op">::</span><span class="kw">bmp</span>(..., <span class="dt">res =</span> dpi, <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>),</a>
<a class="sourceLine" id="cb481-20" data-line-number="20">    <span class="dt">tiff =</span> <span class="cf">function</span>(...) grDevices<span class="op">::</span><span class="kw">tiff</span>(..., <span class="dt">res =</span> dpi, <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>),</a>
<a class="sourceLine" id="cb481-21" data-line-number="21">    <span class="kw">stop</span>(<span class="st">&quot;Unknown graphics extension: &quot;</span>, ext, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb481-22" data-line-number="22">  )</a>
<a class="sourceLine" id="cb481-23" data-line-number="23">}</a>
<a class="sourceLine" id="cb481-24" data-line-number="24"></a>
<a class="sourceLine" id="cb481-25" data-line-number="25"><span class="kw">plot_dev</span>(<span class="st">&quot;pdf&quot;</span>)</a>
<a class="sourceLine" id="cb481-26" data-line-number="26"><span class="co">#&gt; function(filename, ...) grDevices::pdf(file = filename, ...)</span></a>
<a class="sourceLine" id="cb481-27" data-line-number="27"><span class="co">#&gt; &lt;bytecode: 0x7ffacdf66030&gt;</span></a>
<a class="sourceLine" id="cb481-28" data-line-number="28"><span class="co">#&gt; &lt;environment: 0x7ffad28606d0&gt;</span></a>
<a class="sourceLine" id="cb481-29" data-line-number="29"><span class="kw">plot_dev</span>(<span class="st">&quot;png&quot;</span>)</a>
<a class="sourceLine" id="cb481-30" data-line-number="30"><span class="co">#&gt; function(...) grDevices::png(..., res = dpi, units = &quot;in&quot;)</span></a>
<a class="sourceLine" id="cb481-31" data-line-number="31"><span class="co">#&gt; &lt;bytecode: 0x7ffacfca5748&gt;</span></a>
<a class="sourceLine" id="cb481-32" data-line-number="32"><span class="co">#&gt; &lt;environment: 0x7ffad05bd6f0&gt;</span></a></code></pre></div>
</div>
<div id="exercises-1" class="section level3">
<h3><span class="header-section-number">10.3.4</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>Compare and contrast <code>ggplot2::label_bquote()</code> with
<code>scales::number_format()</code></li>
</ol>
</div>
</div>
<div id="stat-fact" class="section level2">
<h2><span class="header-section-number">10.4</span> Statistical factories</h2>
<p>More motivating examples for function factories come from statistics:</p>
<ul>
<li>The Box-Cox transformation.</li>
<li>Bootstrap resampling.</li>
<li>Maximum likelihood estimation.</li>
</ul>
<p>All of these examples can be tackled without function factories, but I think function factories are a good fit for these problems and provide elegant solutions. These examples expect some statistical background, so feel free to skip if they don’t make much sense to you.</p>
<div id="box-cox-transformation" class="section level3">
<h3><span class="header-section-number">10.4.1</span> Box-Cox transformation</h3>
<p></p>
<p>The Box-Cox transformation (a type of <a href="https://en.wikipedia.org/wiki/Power_transform">power transformation</a>) is a flexible transformation often used to transform data towards normality. It has a single parameter, <span class="math inline">\(\lambda\)</span>, which controls the strength of the transformation. We could express the transformation as a simple two argument function:</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb482-1" data-line-number="1">boxcox1 &lt;-<span class="st"> </span><span class="cf">function</span>(x, lambda) {</a>
<a class="sourceLine" id="cb482-2" data-line-number="2">  <span class="kw">stopifnot</span>(<span class="kw">length</span>(lambda) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb482-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb482-4" data-line-number="4">  <span class="cf">if</span> (lambda <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb482-5" data-line-number="5">    <span class="kw">log</span>(x)</a>
<a class="sourceLine" id="cb482-6" data-line-number="6">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb482-7" data-line-number="7">    (x <span class="op">^</span><span class="st"> </span>lambda <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>lambda</a>
<a class="sourceLine" id="cb482-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb482-9" data-line-number="9">}</a></code></pre></div>
<p>But re-formulating as a function factory makes it easy to explore its behaviour with <code>stat_function()</code>:</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb483-1" data-line-number="1">boxcox2 &lt;-<span class="st"> </span><span class="cf">function</span>(lambda) {</a>
<a class="sourceLine" id="cb483-2" data-line-number="2">  <span class="cf">if</span> (lambda <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb483-3" data-line-number="3">    <span class="cf">function</span>(x) <span class="kw">log</span>(x)</a>
<a class="sourceLine" id="cb483-4" data-line-number="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb483-5" data-line-number="5">    <span class="cf">function</span>(x) (x <span class="op">^</span><span class="st"> </span>lambda <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>lambda</a>
<a class="sourceLine" id="cb483-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb483-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb483-8" data-line-number="8"></a>
<a class="sourceLine" id="cb483-9" data-line-number="9">stat_boxcox &lt;-<span class="st"> </span><span class="cf">function</span>(lambda) {</a>
<a class="sourceLine" id="cb483-10" data-line-number="10">  <span class="kw">stat_function</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> lambda), <span class="dt">fun =</span> <span class="kw">boxcox2</span>(lambda), <span class="dt">size =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb483-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb483-12" data-line-number="12"></a>
<a class="sourceLine" id="cb483-13" data-line-number="13"><span class="kw">ggplot</span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>)), <span class="kw">aes</span>(x)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb483-14" data-line-number="14"><span class="st">  </span><span class="kw">lapply</span>(<span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>), stat_boxcox) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb483-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_colour_viridis_c</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>))</a>
<a class="sourceLine" id="cb483-16" data-line-number="16"></a>
<a class="sourceLine" id="cb483-17" data-line-number="17"><span class="co"># visually, log() does seem to make sense as the transformation</span></a>
<a class="sourceLine" id="cb483-18" data-line-number="18"><span class="co"># for lambda = 0; as values get smaller and smaller, the function</span></a>
<a class="sourceLine" id="cb483-19" data-line-number="19"><span class="co"># gets close and closer to a log transformation</span></a>
<a class="sourceLine" id="cb483-20" data-line-number="20"><span class="kw">ggplot</span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">0.01</span>, <span class="dv">1</span>)), <span class="kw">aes</span>(x)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb483-21" data-line-number="21"><span class="st">  </span><span class="kw">lapply</span>(<span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.25</span>, <span class="fl">0.1</span>, <span class="dv">0</span>), stat_boxcox) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb483-22" data-line-number="22"><span class="st">  </span><span class="kw">scale_colour_viridis_c</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>))</a></code></pre></div>
<p><img src="Function-factories_files/figure-html/unnamed-chunk-31-1.png" width="50%" /><img src="Function-factories_files/figure-html/unnamed-chunk-31-2.png" width="50%" /></p>
<p>In general, this allows you to use a Box-Cox transformation with any function that accepts a unary transformation function: you don’t have to worry about that function providing <code>...</code> to pass along additional arguments. I also think that the partitioning of <code>lambda</code> and <code>x</code> into two different function arguments is natural since <code>lambda</code> plays quite a different role than <code>x</code>.</p>
</div>
<div id="bootstrap-generators" class="section level3">
<h3><span class="header-section-number">10.4.2</span> Bootstrap generators</h3>
<p></p>
<p>Function factories are a useful approach for bootstrapping. Instead of thinking about a single bootstrap (you always need more than one!), you can think about a bootstrap <strong>generator</strong>, a function that yields a fresh bootstrap every time it is called:</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb484-1" data-line-number="1">boot_permute &lt;-<span class="st"> </span><span class="cf">function</span>(df, var) {</a>
<a class="sourceLine" id="cb484-2" data-line-number="2">  n &lt;-<span class="st"> </span><span class="kw">nrow</span>(df)</a>
<a class="sourceLine" id="cb484-3" data-line-number="3">  <span class="kw">force</span>(var)</a>
<a class="sourceLine" id="cb484-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb484-5" data-line-number="5">  <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb484-6" data-line-number="6">    col &lt;-<span class="st"> </span>df[[var]]</a>
<a class="sourceLine" id="cb484-7" data-line-number="7">    col[<span class="kw">sample</span>(n, <span class="dt">replace =</span> <span class="ot">TRUE</span>)]</a>
<a class="sourceLine" id="cb484-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb484-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb484-10" data-line-number="10"></a>
<a class="sourceLine" id="cb484-11" data-line-number="11">boot_mtcars1 &lt;-<span class="st"> </span><span class="kw">boot_permute</span>(mtcars, <span class="st">&quot;mpg&quot;</span>)</a>
<a class="sourceLine" id="cb484-12" data-line-number="12"><span class="kw">head</span>(<span class="kw">boot_mtcars1</span>())</a>
<a class="sourceLine" id="cb484-13" data-line-number="13"><span class="co">#&gt; [1] 16.4 22.8 22.8 22.8 16.4 19.2</span></a>
<a class="sourceLine" id="cb484-14" data-line-number="14"><span class="kw">head</span>(<span class="kw">boot_mtcars1</span>())</a>
<a class="sourceLine" id="cb484-15" data-line-number="15"><span class="co">#&gt; [1] 17.8 18.7 30.4 30.4 16.4 21.0</span></a></code></pre></div>
<p>The advantage of a function factory is more clear with a parametric bootstrap where we have to first fit a model. We can do this setup step once, when the factory is called, rather than once every time we generate the bootstrap:</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb485-1" data-line-number="1">boot_model &lt;-<span class="st"> </span><span class="cf">function</span>(df, formula) {</a>
<a class="sourceLine" id="cb485-2" data-line-number="2">  mod &lt;-<span class="st"> </span><span class="kw">lm</span>(formula, <span class="dt">data =</span> df)</a>
<a class="sourceLine" id="cb485-3" data-line-number="3">  fitted &lt;-<span class="st"> </span><span class="kw">unname</span>(<span class="kw">fitted</span>(mod))</a>
<a class="sourceLine" id="cb485-4" data-line-number="4">  resid &lt;-<span class="st"> </span><span class="kw">unname</span>(<span class="kw">resid</span>(mod))</a>
<a class="sourceLine" id="cb485-5" data-line-number="5">  <span class="kw">rm</span>(mod)</a>
<a class="sourceLine" id="cb485-6" data-line-number="6"></a>
<a class="sourceLine" id="cb485-7" data-line-number="7">  <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb485-8" data-line-number="8">    fitted <span class="op">+</span><span class="st"> </span><span class="kw">sample</span>(resid)</a>
<a class="sourceLine" id="cb485-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb485-10" data-line-number="10">} </a>
<a class="sourceLine" id="cb485-11" data-line-number="11"></a>
<a class="sourceLine" id="cb485-12" data-line-number="12">boot_mtcars2 &lt;-<span class="st"> </span><span class="kw">boot_model</span>(mtcars, mpg <span class="op">~</span><span class="st"> </span>wt)</a>
<a class="sourceLine" id="cb485-13" data-line-number="13"><span class="kw">head</span>(<span class="kw">boot_mtcars2</span>())</a>
<a class="sourceLine" id="cb485-14" data-line-number="14"><span class="co">#&gt; [1] 25.0 24.0 21.7 19.2 24.9 16.0</span></a>
<a class="sourceLine" id="cb485-15" data-line-number="15"><span class="kw">head</span>(<span class="kw">boot_mtcars2</span>())</a>
<a class="sourceLine" id="cb485-16" data-line-number="16"><span class="co">#&gt; [1] 27.4 21.0 20.3 19.4 16.3 21.3</span></a></code></pre></div>
<p>I use <code>rm(mod)</code> because linear model objects are quite large (they include complete copies of the model matrix and input data) and I want to keep the manufactured function as small as possible.</p>
</div>
<div id="MLE" class="section level3">
<h3><span class="header-section-number">10.4.3</span> Maximum likelihood estimation</h3>
<p>

</p>
<p>The goal of maximum likelihood estimation (MLE) is to find the parameter values for a distribution that make the observed data most likely. To do MLE, you start with a probability function. For example, take the Poisson distribution. If we know <span class="math inline">\(\lambda\)</span>, we can compute the probability of getting a vector <span class="math inline">\(\mathbf{x}\)</span> of values (<span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span>, …, <span class="math inline">\(x_n\)</span>) by multiplying the Poisson probability function as follows:</p>
<p><span class="math display">\[ P(\lambda, \mathbf{x}) = \prod_{i=1}^{n} \frac{\lambda ^ {x_i} e^{-\lambda}}{x_i!} \]</span></p>
<p>In statistics, we almost always work with the log of this function. The log is a monotonic transformation which preserves important properties (i.e. the extrema occur in the same place), but has specific advantages:</p>
<ul>
<li><p>The log turns a product into a sum, which is easier to work with.</p></li>
<li><p>Multiplying small numbers yields even smaller numbers, which makes the
floating point approximation used by a computer less accurate.</p></li>
</ul>
<p>Let’s apply a log transformation to this probability function and simplify it as much as possible:</p>
<p><span class="math display">\[ \log(P(\lambda, \mathbf{x})) = \sum_{i=1}^{n} \log(\frac{\lambda ^ {x_i} e^{-\lambda}}{x_i!}) \]</span></p>
<p><span class="math display">\[ \log(P(\lambda, \mathbf{x})) = \sum_{i=1}^{n} \left( x_i \log(\lambda) - \lambda - \log(x_i!) \right) \]</span></p>
<p><span class="math display">\[ \log(P(\lambda, \mathbf{x})) = 
     \sum_{i=1}^{n} x_i \log(\lambda)
   - \sum_{i=1}^{n} \lambda 
   - \sum_{i=1}^{n} \log(x_i!) \]</span></p>
<p><span class="math display">\[ \log(P(\lambda, \mathbf{x})) = 
   \log(\lambda) \sum_{i=1}^{n} x_i - n \lambda - \sum_{i=1}^{n} \log(x_i!) \]</span></p>
<p>We can now turn this function into an R function. The R function is quite elegant because R is vectorised and, because it’s a statistical programming language, R comes with built-in functions like the log-factorial (<code>lfactorial()</code>).</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb486-1" data-line-number="1">lprob_poisson &lt;-<span class="st"> </span><span class="cf">function</span>(lambda, x) {</a>
<a class="sourceLine" id="cb486-2" data-line-number="2">  n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb486-3" data-line-number="3">  (<span class="kw">log</span>(lambda) <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(x)) <span class="op">-</span><span class="st"> </span>(n <span class="op">*</span><span class="st"> </span>lambda) <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">lfactorial</span>(x))</a>
<a class="sourceLine" id="cb486-4" data-line-number="4">}</a></code></pre></div>
<p>Consider this vector of observations:</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb487-1" data-line-number="1">x1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">41</span>, <span class="dv">30</span>, <span class="dv">31</span>, <span class="dv">38</span>, <span class="dv">29</span>, <span class="dv">24</span>, <span class="dv">30</span>, <span class="dv">29</span>, <span class="dv">31</span>, <span class="dv">38</span>)</a></code></pre></div>
<p>We can use <code>lprob_poisson()</code> to compute the (logged) probability of <code>x1</code> for different values of <code>lambda</code>.</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb488-1" data-line-number="1"><span class="kw">lprob_poisson</span>(<span class="dv">10</span>, x1)</a>
<a class="sourceLine" id="cb488-2" data-line-number="2"><span class="co">#&gt; [1] -184</span></a>
<a class="sourceLine" id="cb488-3" data-line-number="3"><span class="kw">lprob_poisson</span>(<span class="dv">20</span>, x1)</a>
<a class="sourceLine" id="cb488-4" data-line-number="4"><span class="co">#&gt; [1] -61.1</span></a>
<a class="sourceLine" id="cb488-5" data-line-number="5"><span class="kw">lprob_poisson</span>(<span class="dv">30</span>, x1)</a>
<a class="sourceLine" id="cb488-6" data-line-number="6"><span class="co">#&gt; [1] -31</span></a></code></pre></div>
<p>So far we’ve been thinking of <code>lambda</code> as fixed and known and the function told us the probability of getting different values of <code>x</code>. But in real-life, we observe <code>x</code> and it is <code>lambda</code> that is unknown. The likelihood is the probability function seen through this lens: we want to find the <code>lambda</code> that makes the observed <code>x</code> the most likely. That is, given <code>x</code>, what value of <code>lambda</code> gives us the highest value of <code>lprob_poisson</code>()?</p>
<p>In statistics, we highlight this change in perspective by writing <span class="math inline">\(f_{\mathbf{x}}(\lambda)\)</span> instead of <span class="math inline">\(f(\lambda, \mathbf{x})\)</span>. In R, we can use a function factory. We provide <code>x</code> and generate a function with a single parameter, <code>lambda</code>:</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb489-1" data-line-number="1">ll_poisson1 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb489-2" data-line-number="2">  n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb489-3" data-line-number="3"></a>
<a class="sourceLine" id="cb489-4" data-line-number="4">  <span class="cf">function</span>(lambda) {</a>
<a class="sourceLine" id="cb489-5" data-line-number="5">    <span class="kw">log</span>(lambda) <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(x) <span class="op">-</span><span class="st"> </span>n <span class="op">*</span><span class="st"> </span>lambda <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">lfactorial</span>(x))</a>
<a class="sourceLine" id="cb489-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb489-7" data-line-number="7">}</a></code></pre></div>
<p>(We don’t need <code>force()</code> because <code>length()</code> implicitly forces evaluation of <code>x</code>.)</p>
<p>One nice thing about this approach is that we can do some precomputation: any term that only involves <code>x</code> can be computed once in the factory. This is useful because we’re going to need to call this function many times to find the best <code>lambda</code>.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb490-1" data-line-number="1">ll_poisson2 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb490-2" data-line-number="2">  n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb490-3" data-line-number="3">  sum_x &lt;-<span class="st"> </span><span class="kw">sum</span>(x)</a>
<a class="sourceLine" id="cb490-4" data-line-number="4">  c &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">lfactorial</span>(x))</a>
<a class="sourceLine" id="cb490-5" data-line-number="5"></a>
<a class="sourceLine" id="cb490-6" data-line-number="6">  <span class="cf">function</span>(lambda) {</a>
<a class="sourceLine" id="cb490-7" data-line-number="7">    <span class="kw">log</span>(lambda) <span class="op">*</span><span class="st"> </span>sum_x <span class="op">-</span><span class="st"> </span>n <span class="op">*</span><span class="st"> </span>lambda <span class="op">-</span><span class="st"> </span>c</a>
<a class="sourceLine" id="cb490-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb490-9" data-line-number="9">}</a></code></pre></div>
<p>Now we can use this function to find the value of <code>lambda</code> that maximizes the (log) likelihood:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb491-1" data-line-number="1">ll1 &lt;-<span class="st"> </span><span class="kw">ll_poisson2</span>(x1)</a>
<a class="sourceLine" id="cb491-2" data-line-number="2"></a>
<a class="sourceLine" id="cb491-3" data-line-number="3"><span class="kw">ll1</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb491-4" data-line-number="4"><span class="co">#&gt; [1] -184</span></a>
<a class="sourceLine" id="cb491-5" data-line-number="5"><span class="kw">ll1</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb491-6" data-line-number="6"><span class="co">#&gt; [1] -61.1</span></a>
<a class="sourceLine" id="cb491-7" data-line-number="7"><span class="kw">ll1</span>(<span class="dv">30</span>)</a>
<a class="sourceLine" id="cb491-8" data-line-number="8"><span class="co">#&gt; [1] -31</span></a></code></pre></div>
<p>Rather than trial and error, we can automate the process of finding the best value with <code>optimise()</code>. It will evaluate <code>ll1()</code> many times, using mathematical tricks to narrow in on the largest value as quickly as possible. The results tell us that the highest value is <code>-30.27</code> which occurs when <code>lambda = 32.1</code>:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb492-1" data-line-number="1"><span class="kw">optimise</span>(ll1, <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">maximum =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb492-2" data-line-number="2"><span class="co">#&gt; $maximum</span></a>
<a class="sourceLine" id="cb492-3" data-line-number="3"><span class="co">#&gt; [1] 32.1</span></a>
<a class="sourceLine" id="cb492-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb492-5" data-line-number="5"><span class="co">#&gt; $objective</span></a>
<a class="sourceLine" id="cb492-6" data-line-number="6"><span class="co">#&gt; [1] -30.3</span></a></code></pre></div>
<p>Now, we could have solved this problem without using a function factory because <code>optimise()</code> passes <code>...</code> on to the function being optimised. That means we could use the log-probability function directly:</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb493-1" data-line-number="1"><span class="kw">optimise</span>(lprob_poisson, <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">x =</span> x1, <span class="dt">maximum =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb493-2" data-line-number="2"><span class="co">#&gt; $maximum</span></a>
<a class="sourceLine" id="cb493-3" data-line-number="3"><span class="co">#&gt; [1] 32.1</span></a>
<a class="sourceLine" id="cb493-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb493-5" data-line-number="5"><span class="co">#&gt; $objective</span></a>
<a class="sourceLine" id="cb493-6" data-line-number="6"><span class="co">#&gt; [1] -30.3</span></a></code></pre></div>
<p>The advantage of using a function factory here is fairly small, but there are two niceties:</p>
<ul>
<li><p>We can precompute some values in the factory, saving computation time
in each iteration.</p></li>
<li><p>The two-level design better reflects the mathematical structure of
the underlying problem.</p></li>
</ul>
<p>These advantages get bigger in more complex MLE problems, where you have multiple parameters and multiple data vectors.</p>
<!-- GVW: stepping back, what patterns in existing code should people look for that suggest "Hey, maybe use a function factory here"? -->
</div>
<div id="exercises-2" class="section level3">
<h3><span class="header-section-number">10.4.4</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>In <code>boot_model()</code>, why don’t I need to force the evaluation of <code>df</code>
or <code>model</code>?</p></li>
<li><p>Why might you formulate the Box-Cox transformation like this?</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb494-1" data-line-number="1">boxcox3 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb494-2" data-line-number="2">  <span class="cf">function</span>(lambda) {</a>
<a class="sourceLine" id="cb494-3" data-line-number="3">    <span class="cf">if</span> (lambda <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb494-4" data-line-number="4">      <span class="kw">log</span>(x)</a>
<a class="sourceLine" id="cb494-5" data-line-number="5">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb494-6" data-line-number="6">      (x <span class="op">^</span><span class="st"> </span>lambda <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>lambda</a>
<a class="sourceLine" id="cb494-7" data-line-number="7">    }</a>
<a class="sourceLine" id="cb494-8" data-line-number="8">  }  </a>
<a class="sourceLine" id="cb494-9" data-line-number="9">}</a></code></pre></div></li>
<li><p>Why don’t you need to worry that <code>boot_permute()</code> stores a copy of the
data inside the function that it generates?</p></li>
<li><p>How much time does <code>ll_poisson2()</code> save compared to <code>ll_poisson1()</code>?
Use <code>bench::mark()</code> to see how much faster the optimisation occurs.
How does changing the length of <code>x</code> change the results?</p></li>
</ol>
</div>
</div>
<div id="functional-factories" class="section level2">
<h2><span class="header-section-number">10.5</span> Function factories + functionals</h2>
<p>To finish off the chapter, I’ll show how you might combine functionals and function factories to turn data into many functions. The following code creates many specially named power functions by iterating over a list of arguments:</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb495-1" data-line-number="1">names &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb495-2" data-line-number="2">  <span class="dt">square =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb495-3" data-line-number="3">  <span class="dt">cube =</span> <span class="dv">3</span>, </a>
<a class="sourceLine" id="cb495-4" data-line-number="4">  <span class="dt">root =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, </a>
<a class="sourceLine" id="cb495-5" data-line-number="5">  <span class="dt">cuberoot =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, </a>
<a class="sourceLine" id="cb495-6" data-line-number="6">  <span class="dt">reciprocal =</span> <span class="dv">-1</span></a>
<a class="sourceLine" id="cb495-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb495-8" data-line-number="8">funs &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(names, power1)</a>
<a class="sourceLine" id="cb495-9" data-line-number="9"></a>
<a class="sourceLine" id="cb495-10" data-line-number="10">funs<span class="op">$</span><span class="kw">root</span>(<span class="dv">64</span>)</a>
<a class="sourceLine" id="cb495-11" data-line-number="11"><span class="co">#&gt; [1] 8</span></a>
<a class="sourceLine" id="cb495-12" data-line-number="12">funs<span class="op">$</span>root</a>
<a class="sourceLine" id="cb495-13" data-line-number="13"><span class="co">#&gt; function(x) {</span></a>
<a class="sourceLine" id="cb495-14" data-line-number="14"><span class="co">#&gt;     x ^ exp</span></a>
<a class="sourceLine" id="cb495-15" data-line-number="15"><span class="co">#&gt;   }</span></a>
<a class="sourceLine" id="cb495-16" data-line-number="16"><span class="co">#&gt; &lt;bytecode: 0x7ffacdc2b168&gt;</span></a>
<a class="sourceLine" id="cb495-17" data-line-number="17"><span class="co">#&gt; &lt;environment: 0x7ffad1a52210&gt;</span></a></code></pre></div>
<p>This idea extends in a straightforward way if your function factory takes two (replace <code>map()</code> with <code>map2()</code>) or more (replace with <code>pmap()</code>) arguments.</p>

<p>One downside of the current construction is that you have to prefix every function call with <code>funs$</code>. There are three ways to eliminate this additional syntax:</p>
<ul>
<li><p>For a very temporary effect, you can use <code>with()</code>:</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb496-1" data-line-number="1"><span class="kw">with</span>(funs, <span class="kw">root</span>(<span class="dv">100</span>))</a>
<a class="sourceLine" id="cb496-2" data-line-number="2"><span class="co">#&gt; [1] 10</span></a></code></pre></div>
<p>I recommend this because it makes it very clear when code is being
executed in a special context and what that context is.</p></li>
<li><p>For a longer effect, you can <code>attach()</code> the functions to the search path,
then <code>detach()</code> when you’re done:</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb497-1" data-line-number="1"><span class="kw">attach</span>(funs)</a>
<a class="sourceLine" id="cb497-2" data-line-number="2"><span class="co">#&gt; The following objects are masked _by_ .GlobalEnv:</span></a>
<a class="sourceLine" id="cb497-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb497-4" data-line-number="4"><span class="co">#&gt;     cube, square</span></a>
<a class="sourceLine" id="cb497-5" data-line-number="5"><span class="kw">root</span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb497-6" data-line-number="6"><span class="co">#&gt; [1] 10</span></a>
<a class="sourceLine" id="cb497-7" data-line-number="7"><span class="kw">detach</span>(funs)</a></code></pre></div>
<p>You’ve probably been told to avoid using <code>attach()</code>, and that’s generally
good advice. However, the situation is a little different to the usual
because we’re attaching a list of functions, not a data frame. It’s less
likely that you’ll modify a function than a column in a data frame, so the
some of the worst problems with <code>attach()</code> don’t apply.</p></li>
<li><p>Finally, you could copy the functions to the global environment with
<code>env_bind()</code> (you’ll learn about <code>!!!</code> in Section <a href="quasiquotation.html#tidy-dots">19.6</a>).
This is mostly permanent:</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb498-1" data-line-number="1">rlang<span class="op">::</span><span class="kw">env_bind</span>(<span class="kw">globalenv</span>(), <span class="op">!!!</span>funs)</a>
<a class="sourceLine" id="cb498-2" data-line-number="2"><span class="kw">root</span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb498-3" data-line-number="3"><span class="co">#&gt; [1] 10</span></a></code></pre></div>
<p>You can later unbind those same names, but there’s no guarantee that
they haven’t been rebound in the meantime, and you might be deleting an
object that someone else created.</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb499-1" data-line-number="1">rlang<span class="op">::</span><span class="kw">env_unbind</span>(<span class="kw">globalenv</span>(), <span class="kw">names</span>(funs))</a></code></pre></div></li>
</ul>
<p>You’ll learn an alternative approach to the same problem in Section <a href="quasiquotation.html#new-function">19.7.4</a>. Instead of using a function factory, you could construct the function with quasiquotation. This requires additional knowledge, but generates functions with readable bodies, and avoids accidentally capturing large objects in the enclosing scope. We use that idea in Section <a href="translation.html#tag-functions">21.2.4</a> when we work on tools for generating HTML from R.</p>
<div id="exercises-3" class="section level3">
<h3><span class="header-section-number">10.5.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Which of the following commands is equivalent to <code>with(x, f(z))</code>?</p>
<ol style="list-style-type: lower-alpha">
<li><code>x$f(x$z)</code>.</li>
<li><code>f(x$z)</code>.</li>
<li><code>x$f(z)</code>.</li>
<li><code>f(z)</code>.</li>
<li>It depends.</li>
</ol></li>
<li><p>Compare and contrast the effects of <code>env_bind()</code> vs. <code>attach()</code> for the
following code.</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb500-1" data-line-number="1">funs &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb500-2" data-line-number="2">  <span class="dt">mean =</span> <span class="cf">function</span>(x) <span class="kw">mean</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb500-3" data-line-number="3">  <span class="dt">sum =</span> <span class="cf">function</span>(x) <span class="kw">sum</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb500-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb500-5" data-line-number="5"></a>
<a class="sourceLine" id="cb500-6" data-line-number="6"><span class="kw">attach</span>(funs)</a>
<a class="sourceLine" id="cb500-7" data-line-number="7"><span class="co">#&gt; The following objects are masked from package:base:</span></a>
<a class="sourceLine" id="cb500-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb500-9" data-line-number="9"><span class="co">#&gt;     mean, sum</span></a>
<a class="sourceLine" id="cb500-10" data-line-number="10">mean &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">stop</span>(<span class="st">&quot;Hi!&quot;</span>)</a>
<a class="sourceLine" id="cb500-11" data-line-number="11"><span class="kw">detach</span>(funs)</a>
<a class="sourceLine" id="cb500-12" data-line-number="12"></a>
<a class="sourceLine" id="cb500-13" data-line-number="13"><span class="kw">env_bind</span>(<span class="kw">globalenv</span>(), <span class="op">!!!</span>funs)</a>
<a class="sourceLine" id="cb500-14" data-line-number="14">mean &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">stop</span>(<span class="st">&quot;Hi!&quot;</span>) </a>
<a class="sourceLine" id="cb500-15" data-line-number="15"><span class="kw">env_unbind</span>(<span class="kw">globalenv</span>(), <span class="kw">names</span>(funs))</a></code></pre></div></li>
</ol>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="41">
<li id="fn41"><p>A future version of <code>env_print()</code> is likely to do better at summarising the contents so you don’t need this step.<a href="function-factories.html#fnref41" class="footnote-back">↩</a></p></li>
<li id="fn42"><p>It’s an unfortunate accident of history that scales uses function suffixes instead of function prefixes. That’s because it was written before I understood the autocomplete advantages to using common prefixes instead of common suffixes.<a href="function-factories.html#fnref42" class="footnote-back">↩</a></p></li>
<li id="fn43"><p>ggplot2 doesn’t expose these functions directly because I don’t think the definition of optimality needed to make the problem mathematically tractable is a good match to the actual needs of data exploration.<a href="function-factories.html#fnref43" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functionals.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="function-operators.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hadley/adv-r/edit/master/Function-factories.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
