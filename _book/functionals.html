<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Functionals | Advanced R</title>
  <meta name="description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as help you to understand why R works the way it does." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Functionals | Advanced R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://adv-r.hadley.nz/" />
  <meta property="og:image" content="https://adv-r.hadley.nz/cover.png" />
  <meta property="og:description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as help you to understand why R works the way it does." />
  <meta name="github-repo" content="hadley/adv-r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Functionals | Advanced R" />
  <meta name="twitter:site" content="@hadleywickham" />
  <meta name="twitter:description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as help you to understand why R works the way it does." />
  <meta name="twitter:image" content="https://adv-r.hadley.nz/cover.png" />

<meta name="author" content="Hadley Wickham" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="fp.html"/>
<link rel="next" href="function-factories.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-141212623-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-141212623-1');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="adv-r.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Advanced R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-books"><i class="fa fa-check"></i>Other books</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.1</b> Why R?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#who-should-read"><i class="fa fa-check"></i><b>1.2</b> Who should read this book</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-you-will-get"><i class="fa fa-check"></i><b>1.3</b> What you will get out of this book</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-you-will-not-learn"><i class="fa fa-check"></i><b>1.4</b> What you will not learn</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#meta-techniques"><i class="fa fa-check"></i><b>1.5</b> Meta-techniques</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#recommended-reading"><i class="fa fa-check"></i><b>1.6</b> Recommended reading</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#getting-help"><i class="fa fa-check"></i><b>1.7</b> Getting help</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#intro-ack"><i class="fa fa-check"></i><b>1.8</b> Acknowledgments</a></li>
<li class="chapter" data-level="1.9" data-path="introduction.html"><a href="introduction.html#conventions"><i class="fa fa-check"></i><b>1.9</b> Conventions</a></li>
<li class="chapter" data-level="1.10" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i><b>1.10</b> Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Foundations</b></span></li>
<li class="chapter" data-level="" data-path="foundations-intro.html"><a href="foundations-intro.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="2" data-path="names-values.html"><a href="names-values.html"><i class="fa fa-check"></i><b>2</b> Names and values</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#sources"><i class="fa fa-check"></i>Sources</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="names-values.html"><a href="names-values.html#binding-basics"><i class="fa fa-check"></i><b>2.2</b> Binding basics</a><ul>
<li class="chapter" data-level="2.2.1" data-path="names-values.html"><a href="names-values.html#non-syntactic"><i class="fa fa-check"></i><b>2.2.1</b> Non-syntactic names</a></li>
<li class="chapter" data-level="2.2.2" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>2.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="names-values.html"><a href="names-values.html#copy-on-modify"><i class="fa fa-check"></i><b>2.3</b> Copy-on-modify</a><ul>
<li class="chapter" data-level="2.3.1" data-path="names-values.html"><a href="names-values.html#tracemem"><i class="fa fa-check"></i><b>2.3.1</b> <code>tracemem()</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="names-values.html"><a href="names-values.html#function-calls"><i class="fa fa-check"></i><b>2.3.2</b> Function calls</a></li>
<li class="chapter" data-level="2.3.3" data-path="names-values.html"><a href="names-values.html#list-references"><i class="fa fa-check"></i><b>2.3.3</b> Lists</a></li>
<li class="chapter" data-level="2.3.4" data-path="names-values.html"><a href="names-values.html#df-modify"><i class="fa fa-check"></i><b>2.3.4</b> Data frames</a></li>
<li class="chapter" data-level="2.3.5" data-path="names-values.html"><a href="names-values.html#character-vectors"><i class="fa fa-check"></i><b>2.3.5</b> Character vectors</a></li>
<li class="chapter" data-level="2.3.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>2.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="names-values.html"><a href="names-values.html#object-size"><i class="fa fa-check"></i><b>2.4</b> Object size</a><ul>
<li class="chapter" data-level="2.4.1" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>2.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="names-values.html"><a href="names-values.html#modify-in-place"><i class="fa fa-check"></i><b>2.5</b> Modify-in-place</a><ul>
<li class="chapter" data-level="2.5.1" data-path="names-values.html"><a href="names-values.html#single-binding"><i class="fa fa-check"></i><b>2.5.1</b> Objects with a single binding</a></li>
<li class="chapter" data-level="2.5.2" data-path="names-values.html"><a href="names-values.html#env-modify"><i class="fa fa-check"></i><b>2.5.2</b> Environments</a></li>
<li class="chapter" data-level="2.5.3" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>2.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="names-values.html"><a href="names-values.html#gc"><i class="fa fa-check"></i><b>2.6</b> Unbinding and the garbage collector</a></li>
<li class="chapter" data-level="2.7" data-path="names-values.html"><a href="names-values.html#names-values-answers"><i class="fa fa-check"></i><b>2.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vectors-chap.html"><a href="vectors-chap.html"><i class="fa fa-check"></i><b>3</b> Vectors</a><ul>
<li class="chapter" data-level="3.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-vectors"><i class="fa fa-check"></i><b>3.2</b> Atomic vectors</a><ul>
<li class="chapter" data-level="3.2.1" data-path="vectors-chap.html"><a href="vectors-chap.html#scalars"><i class="fa fa-check"></i><b>3.2.1</b> Scalars</a></li>
<li class="chapter" data-level="3.2.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-constructing"><i class="fa fa-check"></i><b>3.2.2</b> Making longer vectors with <code>c()</code></a></li>
<li class="chapter" data-level="3.2.3" data-path="vectors-chap.html"><a href="vectors-chap.html#missing-values"><i class="fa fa-check"></i><b>3.2.3</b> Missing values</a></li>
<li class="chapter" data-level="3.2.4" data-path="vectors-chap.html"><a href="vectors-chap.html#testing-and-coercion"><i class="fa fa-check"></i><b>3.2.4</b> Testing and coercion</a></li>
<li class="chapter" data-level="3.2.5" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>3.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attributes"><i class="fa fa-check"></i><b>3.3</b> Attributes</a><ul>
<li class="chapter" data-level="3.3.1" data-path="vectors-chap.html"><a href="vectors-chap.html#getting-and-setting"><i class="fa fa-check"></i><b>3.3.1</b> Getting and setting</a></li>
<li class="chapter" data-level="3.3.2" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-names"><i class="fa fa-check"></i><b>3.3.2</b> Names</a></li>
<li class="chapter" data-level="3.3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-dims"><i class="fa fa-check"></i><b>3.3.3</b> Dimensions</a></li>
<li class="chapter" data-level="3.3.4" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>3.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="vectors-chap.html"><a href="vectors-chap.html#s3-atomic-vectors"><i class="fa fa-check"></i><b>3.4</b> S3 atomic vectors</a><ul>
<li class="chapter" data-level="3.4.1" data-path="vectors-chap.html"><a href="vectors-chap.html#factors"><i class="fa fa-check"></i><b>3.4.1</b> Factors</a></li>
<li class="chapter" data-level="3.4.2" data-path="vectors-chap.html"><a href="vectors-chap.html#dates"><i class="fa fa-check"></i><b>3.4.2</b> Dates</a></li>
<li class="chapter" data-level="3.4.3" data-path="vectors-chap.html"><a href="vectors-chap.html#date-times"><i class="fa fa-check"></i><b>3.4.3</b> Date-times</a></li>
<li class="chapter" data-level="3.4.4" data-path="vectors-chap.html"><a href="vectors-chap.html#durations"><i class="fa fa-check"></i><b>3.4.4</b> Durations</a></li>
<li class="chapter" data-level="3.4.5" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>3.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="vectors-chap.html"><a href="vectors-chap.html#lists"><i class="fa fa-check"></i><b>3.5</b> Lists</a><ul>
<li class="chapter" data-level="3.5.1" data-path="vectors-chap.html"><a href="vectors-chap.html#list-creating"><i class="fa fa-check"></i><b>3.5.1</b> Creating</a></li>
<li class="chapter" data-level="3.5.2" data-path="vectors-chap.html"><a href="vectors-chap.html#list-types"><i class="fa fa-check"></i><b>3.5.2</b> Testing and coercion</a></li>
<li class="chapter" data-level="3.5.3" data-path="vectors-chap.html"><a href="vectors-chap.html#list-array"><i class="fa fa-check"></i><b>3.5.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="3.5.4" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>3.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="vectors-chap.html"><a href="vectors-chap.html#tibble"><i class="fa fa-check"></i><b>3.6</b> Data frames and tibbles</a><ul>
<li class="chapter" data-level="3.6.1" data-path="vectors-chap.html"><a href="vectors-chap.html#df-create"><i class="fa fa-check"></i><b>3.6.1</b> Creating</a></li>
<li class="chapter" data-level="3.6.2" data-path="vectors-chap.html"><a href="vectors-chap.html#rownames"><i class="fa fa-check"></i><b>3.6.2</b> Row names</a></li>
<li class="chapter" data-level="3.6.3" data-path="vectors-chap.html"><a href="vectors-chap.html#printing"><i class="fa fa-check"></i><b>3.6.3</b> Printing</a></li>
<li class="chapter" data-level="3.6.4" data-path="vectors-chap.html"><a href="vectors-chap.html#safe-subsetting"><i class="fa fa-check"></i><b>3.6.4</b> Subsetting</a></li>
<li class="chapter" data-level="3.6.5" data-path="vectors-chap.html"><a href="vectors-chap.html#df-test-coerce"><i class="fa fa-check"></i><b>3.6.5</b> Testing and coercing</a></li>
<li class="chapter" data-level="3.6.6" data-path="vectors-chap.html"><a href="vectors-chap.html#list-columns"><i class="fa fa-check"></i><b>3.6.6</b> List columns</a></li>
<li class="chapter" data-level="3.6.7" data-path="vectors-chap.html"><a href="vectors-chap.html#matrix-and-data-frame-columns"><i class="fa fa-check"></i><b>3.6.7</b> Matrix and data frame columns</a></li>
<li class="chapter" data-level="3.6.8" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>3.6.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="vectors-chap.html"><a href="vectors-chap.html#null"><i class="fa fa-check"></i><b>3.7</b> <code>NULL</code></a></li>
<li class="chapter" data-level="3.8" data-path="vectors-chap.html"><a href="vectors-chap.html#data-structure-answers"><i class="fa fa-check"></i><b>3.8</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>4</b> Subsetting</a><ul>
<li class="chapter" data-level="4.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="subsetting.html"><a href="subsetting.html#subset-multiple"><i class="fa fa-check"></i><b>4.2</b> Selecting multiple elements</a><ul>
<li class="chapter" data-level="4.2.1" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-vectors"><i class="fa fa-check"></i><b>4.2.1</b> Atomic vectors</a></li>
<li class="chapter" data-level="4.2.2" data-path="vectors-chap.html"><a href="vectors-chap.html#lists"><i class="fa fa-check"></i><b>4.2.2</b> Lists</a></li>
<li class="chapter" data-level="4.2.3" data-path="subsetting.html"><a href="subsetting.html#matrix-subsetting"><i class="fa fa-check"></i><b>4.2.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="4.2.4" data-path="subsetting.html"><a href="subsetting.html#df-subsetting"><i class="fa fa-check"></i><b>4.2.4</b> Data frames and tibbles</a></li>
<li class="chapter" data-level="4.2.5" data-path="subsetting.html"><a href="subsetting.html#simplify-preserve"><i class="fa fa-check"></i><b>4.2.5</b> Preserving dimensionality</a></li>
<li class="chapter" data-level="4.2.6" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>4.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="subsetting.html"><a href="subsetting.html#subset-single"><i class="fa fa-check"></i><b>4.3</b> Selecting a single element</a><ul>
<li class="chapter" data-level="4.3.1" data-path="subsetting.html"><a href="subsetting.html#section"><i class="fa fa-check"></i><b>4.3.1</b> <code>[[</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="subsetting.html"><a href="subsetting.html#section-1"><i class="fa fa-check"></i><b>4.3.2</b> <code>$</code></a></li>
<li class="chapter" data-level="4.3.3" data-path="subsetting.html"><a href="subsetting.html#subsetting-oob"><i class="fa fa-check"></i><b>4.3.3</b> Missing and out-of-bounds indices</a></li>
<li class="chapter" data-level="4.3.4" data-path="subsetting.html"><a href="subsetting.html#and-slot"><i class="fa fa-check"></i><b>4.3.4</b> <code>@</code> and <code>slot()</code></a></li>
<li class="chapter" data-level="4.3.5" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>4.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="subsetting.html"><a href="subsetting.html#subassignment"><i class="fa fa-check"></i><b>4.4</b> Subsetting and assignment</a></li>
<li class="chapter" data-level="4.5" data-path="subsetting.html"><a href="subsetting.html#applications"><i class="fa fa-check"></i><b>4.5</b> Applications</a><ul>
<li class="chapter" data-level="4.5.1" data-path="subsetting.html"><a href="subsetting.html#lookup-tables"><i class="fa fa-check"></i><b>4.5.1</b> Lookup tables (character subsetting)</a></li>
<li class="chapter" data-level="4.5.2" data-path="subsetting.html"><a href="subsetting.html#matching-merging"><i class="fa fa-check"></i><b>4.5.2</b> Matching and merging by hand (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.3" data-path="subsetting.html"><a href="subsetting.html#random-samples-and-bootstraps-integer-subsetting"><i class="fa fa-check"></i><b>4.5.3</b> Random samples and bootstraps (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.4" data-path="subsetting.html"><a href="subsetting.html#ordering-integer-subsetting"><i class="fa fa-check"></i><b>4.5.4</b> Ordering (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.5" data-path="subsetting.html"><a href="subsetting.html#expanding-aggregated-counts-integer-subsetting"><i class="fa fa-check"></i><b>4.5.5</b> Expanding aggregated counts (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.6" data-path="subsetting.html"><a href="subsetting.html#removing-columns-from-data-frames-character"><i class="fa fa-check"></i><b>4.5.6</b> Removing columns from data frames (character )</a></li>
<li class="chapter" data-level="4.5.7" data-path="subsetting.html"><a href="subsetting.html#selecting-rows-based-on-a-condition-logical-subsetting"><i class="fa fa-check"></i><b>4.5.7</b> Selecting rows based on a condition (logical subsetting)</a></li>
<li class="chapter" data-level="4.5.8" data-path="subsetting.html"><a href="subsetting.html#boolean-algebra-versus-sets-logical-and-integer"><i class="fa fa-check"></i><b>4.5.8</b> Boolean algebra versus sets (logical and integer )</a></li>
<li class="chapter" data-level="4.5.9" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>4.5.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="subsetting.html"><a href="subsetting.html#subsetting-answers"><i class="fa fa-check"></i><b>4.6</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="control-flow.html"><a href="control-flow.html"><i class="fa fa-check"></i><b>5</b> Control flow</a><ul>
<li class="chapter" data-level="5.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="control-flow.html"><a href="control-flow.html#choices"><i class="fa fa-check"></i><b>5.2</b> Choices</a><ul>
<li class="chapter" data-level="5.2.1" data-path="control-flow.html"><a href="control-flow.html#invalid-inputs"><i class="fa fa-check"></i><b>5.2.1</b> Invalid inputs</a></li>
<li class="chapter" data-level="5.2.2" data-path="control-flow.html"><a href="control-flow.html#vectorised-if"><i class="fa fa-check"></i><b>5.2.2</b> Vectorised if</a></li>
<li class="chapter" data-level="5.2.3" data-path="control-flow.html"><a href="control-flow.html#switch"><i class="fa fa-check"></i><b>5.2.3</b> <code>switch()</code> statement</a></li>
<li class="chapter" data-level="5.2.4" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>5.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="control-flow.html"><a href="control-flow.html#loops"><i class="fa fa-check"></i><b>5.3</b> Loops</a><ul>
<li class="chapter" data-level="5.3.1" data-path="control-flow.html"><a href="control-flow.html#common-pitfalls"><i class="fa fa-check"></i><b>5.3.1</b> Common pitfalls</a></li>
<li class="chapter" data-level="5.3.2" data-path="control-flow.html"><a href="control-flow.html#for-family"><i class="fa fa-check"></i><b>5.3.2</b> Related tools</a></li>
<li class="chapter" data-level="5.3.3" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>5.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="control-flow.html"><a href="control-flow.html#control-flow-answers"><i class="fa fa-check"></i><b>5.4</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>6</b> Functions</a><ul>
<li class="chapter" data-level="6.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="functions.html"><a href="functions.html#function-fundamentals"><i class="fa fa-check"></i><b>6.2</b> Function fundamentals</a><ul>
<li class="chapter" data-level="6.2.1" data-path="functions.html"><a href="functions.html#fun-components"><i class="fa fa-check"></i><b>6.2.1</b> Function components</a></li>
<li class="chapter" data-level="6.2.2" data-path="functions.html"><a href="functions.html#primitive-functions"><i class="fa fa-check"></i><b>6.2.2</b> Primitive functions</a></li>
<li class="chapter" data-level="6.2.3" data-path="functions.html"><a href="functions.html#first-class-functions"><i class="fa fa-check"></i><b>6.2.3</b> First-class functions</a></li>
<li class="chapter" data-level="6.2.4" data-path="functions.html"><a href="functions.html#invoking-a-function"><i class="fa fa-check"></i><b>6.2.4</b> Invoking a function</a></li>
<li class="chapter" data-level="6.2.5" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>6.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="functions.html"><a href="functions.html#function-composition"><i class="fa fa-check"></i><b>6.3</b> Function composition</a></li>
<li class="chapter" data-level="6.4" data-path="functions.html"><a href="functions.html#lexical-scoping"><i class="fa fa-check"></i><b>6.4</b> Lexical scoping</a><ul>
<li class="chapter" data-level="6.4.1" data-path="functions.html"><a href="functions.html#name-masking"><i class="fa fa-check"></i><b>6.4.1</b> Name masking</a></li>
<li class="chapter" data-level="6.4.2" data-path="functions.html"><a href="functions.html#functions-versus-variables"><i class="fa fa-check"></i><b>6.4.2</b> Functions versus variables</a></li>
<li class="chapter" data-level="6.4.3" data-path="functions.html"><a href="functions.html#fresh-start"><i class="fa fa-check"></i><b>6.4.3</b> A fresh start</a></li>
<li class="chapter" data-level="6.4.4" data-path="functions.html"><a href="functions.html#dynamic-lookup"><i class="fa fa-check"></i><b>6.4.4</b> Dynamic lookup</a></li>
<li class="chapter" data-level="6.4.5" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>6.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i><b>6.5</b> Lazy evaluation</a><ul>
<li class="chapter" data-level="6.5.1" data-path="functions.html"><a href="functions.html#promises"><i class="fa fa-check"></i><b>6.5.1</b> Promises</a></li>
<li class="chapter" data-level="6.5.2" data-path="functions.html"><a href="functions.html#default-arguments"><i class="fa fa-check"></i><b>6.5.2</b> Default arguments</a></li>
<li class="chapter" data-level="6.5.3" data-path="functions.html"><a href="functions.html#missing-arguments"><i class="fa fa-check"></i><b>6.5.3</b> Missing arguments</a></li>
<li class="chapter" data-level="6.5.4" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>6.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="functions.html"><a href="functions.html#fun-dot-dot-dot"><i class="fa fa-check"></i><b>6.6</b> <code>...</code> (dot-dot-dot)</a><ul>
<li class="chapter" data-level="6.6.1" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>6.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="functions.html"><a href="functions.html#exiting-a-function"><i class="fa fa-check"></i><b>6.7</b> Exiting a function</a><ul>
<li class="chapter" data-level="6.7.1" data-path="functions.html"><a href="functions.html#implicit-versus-explicit-returns"><i class="fa fa-check"></i><b>6.7.1</b> Implicit versus explicit returns</a></li>
<li class="chapter" data-level="6.7.2" data-path="functions.html"><a href="functions.html#invisible"><i class="fa fa-check"></i><b>6.7.2</b> Invisible values</a></li>
<li class="chapter" data-level="6.7.3" data-path="functions.html"><a href="functions.html#errors"><i class="fa fa-check"></i><b>6.7.3</b> Errors</a></li>
<li class="chapter" data-level="6.7.4" data-path="functions.html"><a href="functions.html#on-exit"><i class="fa fa-check"></i><b>6.7.4</b> Exit handlers</a></li>
<li class="chapter" data-level="6.7.5" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>6.7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="functions.html"><a href="functions.html#function-forms"><i class="fa fa-check"></i><b>6.8</b> Function forms</a><ul>
<li class="chapter" data-level="6.8.1" data-path="functions.html"><a href="functions.html#prefix-transform"><i class="fa fa-check"></i><b>6.8.1</b> Rewriting to prefix form</a></li>
<li class="chapter" data-level="6.8.2" data-path="functions.html"><a href="functions.html#prefix-form"><i class="fa fa-check"></i><b>6.8.2</b> Prefix form</a></li>
<li class="chapter" data-level="6.8.3" data-path="functions.html"><a href="functions.html#infix-functions"><i class="fa fa-check"></i><b>6.8.3</b> Infix functions</a></li>
<li class="chapter" data-level="6.8.4" data-path="functions.html"><a href="functions.html#replacement-functions"><i class="fa fa-check"></i><b>6.8.4</b> Replacement functions</a></li>
<li class="chapter" data-level="6.8.5" data-path="functions.html"><a href="functions.html#special-forms"><i class="fa fa-check"></i><b>6.8.5</b> Special forms</a></li>
<li class="chapter" data-level="6.8.6" data-path="functions.html"><a href="functions.html#exercises-5"><i class="fa fa-check"></i><b>6.8.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="functions.html"><a href="functions.html#function-answers"><i class="fa fa-check"></i><b>6.9</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>7</b> Environments</a><ul>
<li class="chapter" data-level="7.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>7.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="environments.html"><a href="environments.html#env-basics"><i class="fa fa-check"></i><b>7.2</b> Environment basics</a><ul>
<li class="chapter" data-level="7.2.1" data-path="environments.html"><a href="environments.html#basics"><i class="fa fa-check"></i><b>7.2.1</b> Basics</a></li>
<li class="chapter" data-level="7.2.2" data-path="environments.html"><a href="environments.html#important-environments"><i class="fa fa-check"></i><b>7.2.2</b> Important environments</a></li>
<li class="chapter" data-level="7.2.3" data-path="environments.html"><a href="environments.html#parents"><i class="fa fa-check"></i><b>7.2.3</b> Parents</a></li>
<li class="chapter" data-level="7.2.4" data-path="environments.html"><a href="environments.html#super-assignment--"><i class="fa fa-check"></i><b>7.2.4</b> Super assignment, <code>&lt;&lt;-</code></a></li>
<li class="chapter" data-level="7.2.5" data-path="vectors-chap.html"><a href="vectors-chap.html#getting-and-setting"><i class="fa fa-check"></i><b>7.2.5</b> Getting and setting</a></li>
<li class="chapter" data-level="7.2.6" data-path="environments.html"><a href="environments.html#advanced-bindings"><i class="fa fa-check"></i><b>7.2.6</b> Advanced bindings</a></li>
<li class="chapter" data-level="7.2.7" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>7.2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="environments.html"><a href="environments.html#env-recursion"><i class="fa fa-check"></i><b>7.3</b> Recursing over environments</a><ul>
<li class="chapter" data-level="7.3.1" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>7.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="environments.html"><a href="environments.html#special-environments"><i class="fa fa-check"></i><b>7.4</b> Special environments</a><ul>
<li class="chapter" data-level="7.4.1" data-path="environments.html"><a href="environments.html#search-path"><i class="fa fa-check"></i><b>7.4.1</b> Package environments and the search path</a></li>
<li class="chapter" data-level="7.4.2" data-path="environments.html"><a href="environments.html#function-environments"><i class="fa fa-check"></i><b>7.4.2</b> The function environment</a></li>
<li class="chapter" data-level="7.4.3" data-path="environments.html"><a href="environments.html#namespaces"><i class="fa fa-check"></i><b>7.4.3</b> Namespaces</a></li>
<li class="chapter" data-level="7.4.4" data-path="environments.html"><a href="environments.html#execution-environments"><i class="fa fa-check"></i><b>7.4.4</b> Execution environments</a></li>
<li class="chapter" data-level="7.4.5" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>7.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="environments.html"><a href="environments.html#call-stack"><i class="fa fa-check"></i><b>7.5</b> Call stacks</a><ul>
<li class="chapter" data-level="7.5.1" data-path="environments.html"><a href="environments.html#simple-stack"><i class="fa fa-check"></i><b>7.5.1</b> Simple call stacks</a></li>
<li class="chapter" data-level="7.5.2" data-path="environments.html"><a href="environments.html#lazy-call-stack"><i class="fa fa-check"></i><b>7.5.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="7.5.3" data-path="environments.html"><a href="environments.html#frames"><i class="fa fa-check"></i><b>7.5.3</b> Frames</a></li>
<li class="chapter" data-level="7.5.4" data-path="environments.html"><a href="environments.html#dynamic-scope"><i class="fa fa-check"></i><b>7.5.4</b> Dynamic scope</a></li>
<li class="chapter" data-level="7.5.5" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>7.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="environments.html"><a href="environments.html#explicit-envs"><i class="fa fa-check"></i><b>7.6</b> As data structures</a></li>
<li class="chapter" data-level="7.7" data-path="environments.html"><a href="environments.html#env-answers"><i class="fa fa-check"></i><b>7.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditions.html"><a href="conditions.html"><i class="fa fa-check"></i><b>8</b> Conditions</a><ul>
<li class="chapter" data-level="8.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>8.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="8.1.1" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i><b>8.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditions.html"><a href="conditions.html#signalling-conditions"><i class="fa fa-check"></i><b>8.2</b> Signalling conditions</a><ul>
<li class="chapter" data-level="8.2.1" data-path="functions.html"><a href="functions.html#errors"><i class="fa fa-check"></i><b>8.2.1</b> Errors</a></li>
<li class="chapter" data-level="8.2.2" data-path="conditions.html"><a href="conditions.html#warnings"><i class="fa fa-check"></i><b>8.2.2</b> Warnings</a></li>
<li class="chapter" data-level="8.2.3" data-path="conditions.html"><a href="conditions.html#messages"><i class="fa fa-check"></i><b>8.2.3</b> Messages</a></li>
<li class="chapter" data-level="8.2.4" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>8.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="conditions.html"><a href="conditions.html#ignoring-conditions"><i class="fa fa-check"></i><b>8.3</b> Ignoring conditions</a></li>
<li class="chapter" data-level="8.4" data-path="conditions.html"><a href="conditions.html#handling-conditions"><i class="fa fa-check"></i><b>8.4</b> Handling conditions</a><ul>
<li class="chapter" data-level="8.4.1" data-path="conditions.html"><a href="conditions.html#condition-objects"><i class="fa fa-check"></i><b>8.4.1</b> Condition objects</a></li>
<li class="chapter" data-level="8.4.2" data-path="conditions.html"><a href="conditions.html#exiting-handlers"><i class="fa fa-check"></i><b>8.4.2</b> Exiting handlers</a></li>
<li class="chapter" data-level="8.4.3" data-path="conditions.html"><a href="conditions.html#calling-handlers"><i class="fa fa-check"></i><b>8.4.3</b> Calling handlers</a></li>
<li class="chapter" data-level="8.4.4" data-path="conditions.html"><a href="conditions.html#call-stacks"><i class="fa fa-check"></i><b>8.4.4</b> Call stacks</a></li>
<li class="chapter" data-level="8.4.5" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>8.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="conditions.html"><a href="conditions.html#custom-conditions"><i class="fa fa-check"></i><b>8.5</b> Custom conditions</a><ul>
<li class="chapter" data-level="8.5.1" data-path="conditions.html"><a href="conditions.html#motivation"><i class="fa fa-check"></i><b>8.5.1</b> Motivation</a></li>
<li class="chapter" data-level="8.5.2" data-path="conditions.html"><a href="conditions.html#signalling"><i class="fa fa-check"></i><b>8.5.2</b> Signalling</a></li>
<li class="chapter" data-level="8.5.3" data-path="conditions.html"><a href="conditions.html#handling"><i class="fa fa-check"></i><b>8.5.3</b> Handling</a></li>
<li class="chapter" data-level="8.5.4" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>8.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="conditions.html"><a href="conditions.html#condition-applications"><i class="fa fa-check"></i><b>8.6</b> Applications</a><ul>
<li class="chapter" data-level="8.6.1" data-path="conditions.html"><a href="conditions.html#failure-value"><i class="fa fa-check"></i><b>8.6.1</b> Failure value</a></li>
<li class="chapter" data-level="8.6.2" data-path="conditions.html"><a href="conditions.html#try-success-failure"><i class="fa fa-check"></i><b>8.6.2</b> Success and failure values</a></li>
<li class="chapter" data-level="8.6.3" data-path="conditions.html"><a href="conditions.html#resignal"><i class="fa fa-check"></i><b>8.6.3</b> Resignal</a></li>
<li class="chapter" data-level="8.6.4" data-path="conditions.html"><a href="conditions.html#record"><i class="fa fa-check"></i><b>8.6.4</b> Record</a></li>
<li class="chapter" data-level="8.6.5" data-path="conditions.html"><a href="conditions.html#no-default-behaviour"><i class="fa fa-check"></i><b>8.6.5</b> No default behaviour</a></li>
<li class="chapter" data-level="8.6.6" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>8.6.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="conditions.html"><a href="conditions.html#conditions-answers"><i class="fa fa-check"></i><b>8.7</b> Quiz answers</a></li>
</ul></li>
<li class="part"><span><b>II Functional programming</b></span></li>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html#functional-programming-languages"><i class="fa fa-check"></i>Functional programming languages</a></li>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html#functional-style"><i class="fa fa-check"></i>Functional style</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>9</b> Functionals</a><ul>
<li class="chapter" data-level="9.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>9.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="functionals.html"><a href="functionals.html#map"><i class="fa fa-check"></i><b>9.2</b> My first functional: <code>map()</code></a><ul>
<li class="chapter" data-level="9.2.1" data-path="functionals.html"><a href="functionals.html#map-atomic"><i class="fa fa-check"></i><b>9.2.1</b> Producing atomic vectors</a></li>
<li class="chapter" data-level="9.2.2" data-path="functionals.html"><a href="functionals.html#purrr-shortcuts"><i class="fa fa-check"></i><b>9.2.2</b> Anonymous functions and shortcuts</a></li>
<li class="chapter" data-level="9.2.3" data-path="functionals.html"><a href="functionals.html#passing-arguments"><i class="fa fa-check"></i><b>9.2.3</b> Passing arguments with <code>...</code></a></li>
<li class="chapter" data-level="9.2.4" data-path="functionals.html"><a href="functionals.html#argument-names"><i class="fa fa-check"></i><b>9.2.4</b> Argument names</a></li>
<li class="chapter" data-level="9.2.5" data-path="functionals.html"><a href="functionals.html#change-argument"><i class="fa fa-check"></i><b>9.2.5</b> Varying another argument</a></li>
<li class="chapter" data-level="9.2.6" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>9.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="functionals.html"><a href="functionals.html#purrr-style"><i class="fa fa-check"></i><b>9.3</b> Purrr style</a></li>
<li class="chapter" data-level="9.4" data-path="functionals.html"><a href="functionals.html#map-variants"><i class="fa fa-check"></i><b>9.4</b> Map variants</a><ul>
<li class="chapter" data-level="9.4.1" data-path="functionals.html"><a href="functionals.html#modify"><i class="fa fa-check"></i><b>9.4.1</b> Same type of output as input: <code>modify()</code></a></li>
<li class="chapter" data-level="9.4.2" data-path="functionals.html"><a href="functionals.html#map2"><i class="fa fa-check"></i><b>9.4.2</b> Two inputs: <code>map2()</code> and friends</a></li>
<li class="chapter" data-level="9.4.3" data-path="functionals.html"><a href="functionals.html#no-outputs-walk-and-friends"><i class="fa fa-check"></i><b>9.4.3</b> No outputs: <code>walk()</code> and friends</a></li>
<li class="chapter" data-level="9.4.4" data-path="functionals.html"><a href="functionals.html#iterating-over-values-and-indices"><i class="fa fa-check"></i><b>9.4.4</b> Iterating over values and indices</a></li>
<li class="chapter" data-level="9.4.5" data-path="functionals.html"><a href="functionals.html#pmap"><i class="fa fa-check"></i><b>9.4.5</b> Any number of inputs: <code>pmap()</code> and friends</a></li>
<li class="chapter" data-level="9.4.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>9.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="functionals.html"><a href="functionals.html#reduce"><i class="fa fa-check"></i><b>9.5</b> Reduce family</a><ul>
<li class="chapter" data-level="9.5.1" data-path="environments.html"><a href="environments.html#basics"><i class="fa fa-check"></i><b>9.5.1</b> Basics</a></li>
<li class="chapter" data-level="9.5.2" data-path="functionals.html"><a href="functionals.html#accumulate"><i class="fa fa-check"></i><b>9.5.2</b> Accumulate</a></li>
<li class="chapter" data-level="9.5.3" data-path="functionals.html"><a href="functionals.html#output-types"><i class="fa fa-check"></i><b>9.5.3</b> Output types</a></li>
<li class="chapter" data-level="9.5.4" data-path="functionals.html"><a href="functionals.html#multiple-inputs"><i class="fa fa-check"></i><b>9.5.4</b> Multiple inputs</a></li>
<li class="chapter" data-level="9.5.5" data-path="functionals.html"><a href="functionals.html#map-reduce"><i class="fa fa-check"></i><b>9.5.5</b> Map-reduce</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="functionals.html"><a href="functionals.html#predicate-functionals"><i class="fa fa-check"></i><b>9.6</b> Predicate functionals</a><ul>
<li class="chapter" data-level="9.6.1" data-path="functionals.html"><a href="functionals.html#basics-1"><i class="fa fa-check"></i><b>9.6.1</b> Basics</a></li>
<li class="chapter" data-level="9.6.2" data-path="functionals.html"><a href="functionals.html#predicate-map"><i class="fa fa-check"></i><b>9.6.2</b> Map variants</a></li>
<li class="chapter" data-level="9.6.3" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>9.6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="functionals.html"><a href="functionals.html#base-functionals"><i class="fa fa-check"></i><b>9.7</b> Base functionals</a><ul>
<li class="chapter" data-level="9.7.1" data-path="functionals.html"><a href="functionals.html#matrices-and-arrays"><i class="fa fa-check"></i><b>9.7.1</b> Matrices and arrays</a></li>
<li class="chapter" data-level="9.7.2" data-path="functionals.html"><a href="functionals.html#mathematical-concerns"><i class="fa fa-check"></i><b>9.7.2</b> Mathematical concerns</a></li>
<li class="chapter" data-level="9.7.3" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>9.7.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="function-factories.html"><a href="function-factories.html"><i class="fa fa-check"></i><b>10</b> Function factories</a><ul>
<li class="chapter" data-level="10.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>10.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="function-factories.html"><a href="function-factories.html#factory-fundamentals"><i class="fa fa-check"></i><b>10.2</b> Factory fundamentals</a><ul>
<li class="chapter" data-level="10.2.1" data-path="environments.html"><a href="environments.html#environments"><i class="fa fa-check"></i><b>10.2.1</b> Environments</a></li>
<li class="chapter" data-level="10.2.2" data-path="function-factories.html"><a href="function-factories.html#diagram-conventions"><i class="fa fa-check"></i><b>10.2.2</b> Diagram conventions</a></li>
<li class="chapter" data-level="10.2.3" data-path="function-factories.html"><a href="function-factories.html#forcing-evaluation"><i class="fa fa-check"></i><b>10.2.3</b> Forcing evaluation</a></li>
<li class="chapter" data-level="10.2.4" data-path="function-factories.html"><a href="function-factories.html#stateful-funs"><i class="fa fa-check"></i><b>10.2.4</b> Stateful functions</a></li>
<li class="chapter" data-level="10.2.5" data-path="function-factories.html"><a href="function-factories.html#factory-pitfalls"><i class="fa fa-check"></i><b>10.2.5</b> Garbage collection</a></li>
<li class="chapter" data-level="10.2.6" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>10.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="function-factories.html"><a href="function-factories.html#graph-fact"><i class="fa fa-check"></i><b>10.3</b> Graphical factories</a><ul>
<li class="chapter" data-level="10.3.1" data-path="function-factories.html"><a href="function-factories.html#labelling"><i class="fa fa-check"></i><b>10.3.1</b> Labelling</a></li>
<li class="chapter" data-level="10.3.2" data-path="function-factories.html"><a href="function-factories.html#histogram-bins"><i class="fa fa-check"></i><b>10.3.2</b> Histogram bins</a></li>
<li class="chapter" data-level="10.3.3" data-path="function-factories.html"><a href="function-factories.html#ggsave"><i class="fa fa-check"></i><b>10.3.3</b> <code>ggsave()</code></a></li>
<li class="chapter" data-level="10.3.4" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>10.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="function-factories.html"><a href="function-factories.html#stat-fact"><i class="fa fa-check"></i><b>10.4</b> Statistical factories</a><ul>
<li class="chapter" data-level="10.4.1" data-path="function-factories.html"><a href="function-factories.html#box-cox-transformation"><i class="fa fa-check"></i><b>10.4.1</b> Box-Cox transformation</a></li>
<li class="chapter" data-level="10.4.2" data-path="function-factories.html"><a href="function-factories.html#bootstrap-generators"><i class="fa fa-check"></i><b>10.4.2</b> Bootstrap generators</a></li>
<li class="chapter" data-level="10.4.3" data-path="function-factories.html"><a href="function-factories.html#MLE"><i class="fa fa-check"></i><b>10.4.3</b> Maximum likelihood estimation</a></li>
<li class="chapter" data-level="10.4.4" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>10.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="function-factories.html"><a href="function-factories.html#functional-factories"><i class="fa fa-check"></i><b>10.5</b> Function factories + functionals</a><ul>
<li class="chapter" data-level="10.5.1" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>10.5.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="function-operators.html"><a href="function-operators.html"><i class="fa fa-check"></i><b>11</b> Function operators</a><ul>
<li class="chapter" data-level="11.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>11.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="function-operators.html"><a href="function-operators.html#existing-fos"><i class="fa fa-check"></i><b>11.2</b> Existing function operators</a><ul>
<li class="chapter" data-level="11.2.1" data-path="function-operators.html"><a href="function-operators.html#safely"><i class="fa fa-check"></i><b>11.2.1</b> Capturing errors with <code>purrr::safely()</code></a></li>
<li class="chapter" data-level="11.2.2" data-path="function-operators.html"><a href="function-operators.html#memoise"><i class="fa fa-check"></i><b>11.2.2</b> Caching computations with <code>memoise::memoise()</code></a></li>
<li class="chapter" data-level="11.2.3" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>11.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="function-operators.html"><a href="function-operators.html#fo-case-study"><i class="fa fa-check"></i><b>11.3</b> Case study: Creating your own function operators</a><ul>
<li class="chapter" data-level="11.3.1" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>11.3.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Object-oriented programming</b></span></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#oop-systems"><i class="fa fa-check"></i>OOP systems</a></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#oop-in-r"><i class="fa fa-check"></i>OOP in R</a></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#sloop"><i class="fa fa-check"></i>sloop</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="base-types.html"><a href="base-types.html"><i class="fa fa-check"></i><b>12</b> Base types</a><ul>
<li class="chapter" data-level="12.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>12.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="base-types.html"><a href="base-types.html#base-vs-oo"><i class="fa fa-check"></i><b>12.2</b> Base versus OO objects</a></li>
<li class="chapter" data-level="12.3" data-path="base-types.html"><a href="base-types.html#base-types-2"><i class="fa fa-check"></i><b>12.3</b> Base types</a><ul>
<li class="chapter" data-level="12.3.1" data-path="base-types.html"><a href="base-types.html#numeric-type"><i class="fa fa-check"></i><b>12.3.1</b> Numeric type</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="s3.html"><a href="s3.html"><i class="fa fa-check"></i><b>13</b> S3</a><ul>
<li class="chapter" data-level="13.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>13.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="s3.html"><a href="s3.html#s3-basics"><i class="fa fa-check"></i><b>13.2</b> Basics</a><ul>
<li class="chapter" data-level="13.2.1" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>13.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="s3.html"><a href="s3.html#s3-classes"><i class="fa fa-check"></i><b>13.3</b> Classes</a><ul>
<li class="chapter" data-level="13.3.1" data-path="s3.html"><a href="s3.html#s3-constructor"><i class="fa fa-check"></i><b>13.3.1</b> Constructors</a></li>
<li class="chapter" data-level="13.3.2" data-path="s3.html"><a href="s3.html#validators"><i class="fa fa-check"></i><b>13.3.2</b> Validators</a></li>
<li class="chapter" data-level="13.3.3" data-path="s3.html"><a href="s3.html#helpers"><i class="fa fa-check"></i><b>13.3.3</b> Helpers</a></li>
<li class="chapter" data-level="13.3.4" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>13.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="s3.html"><a href="s3.html#s3-methods"><i class="fa fa-check"></i><b>13.4</b> Generics and methods</a><ul>
<li class="chapter" data-level="13.4.1" data-path="s3.html"><a href="s3.html#method-dispatch"><i class="fa fa-check"></i><b>13.4.1</b> Method dispatch</a></li>
<li class="chapter" data-level="13.4.2" data-path="s3.html"><a href="s3.html#finding-methods"><i class="fa fa-check"></i><b>13.4.2</b> Finding methods</a></li>
<li class="chapter" data-level="13.4.3" data-path="s3.html"><a href="s3.html#s3-arguments"><i class="fa fa-check"></i><b>13.4.3</b> Creating methods</a></li>
<li class="chapter" data-level="13.4.4" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>13.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="s3.html"><a href="s3.html#object-styles"><i class="fa fa-check"></i><b>13.5</b> Object styles</a><ul>
<li class="chapter" data-level="13.5.1" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>13.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="s3.html"><a href="s3.html#s3-inheritance"><i class="fa fa-check"></i><b>13.6</b> Inheritance</a><ul>
<li class="chapter" data-level="13.6.1" data-path="s3.html"><a href="s3.html#nextmethod"><i class="fa fa-check"></i><b>13.6.1</b> <code>NextMethod()</code></a></li>
<li class="chapter" data-level="13.6.2" data-path="s3.html"><a href="s3.html#s3-subclassing"><i class="fa fa-check"></i><b>13.6.2</b> Allowing subclassing</a></li>
<li class="chapter" data-level="13.6.3" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>13.6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="s3.html"><a href="s3.html#s3-dispatch"><i class="fa fa-check"></i><b>13.7</b> Dispatch details</a><ul>
<li class="chapter" data-level="13.7.1" data-path="s3.html"><a href="s3.html#implicit-class"><i class="fa fa-check"></i><b>13.7.1</b> S3 and base types</a></li>
<li class="chapter" data-level="13.7.2" data-path="s3.html"><a href="s3.html#internal-generics"><i class="fa fa-check"></i><b>13.7.2</b> Internal generics</a></li>
<li class="chapter" data-level="13.7.3" data-path="s3.html"><a href="s3.html#group-generics"><i class="fa fa-check"></i><b>13.7.3</b> Group generics</a></li>
<li class="chapter" data-level="13.7.4" data-path="s3.html"><a href="s3.html#double-dispatch"><i class="fa fa-check"></i><b>13.7.4</b> Double dispatch</a></li>
<li class="chapter" data-level="13.7.5" data-path="functions.html"><a href="functions.html#exercises-5"><i class="fa fa-check"></i><b>13.7.5</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="r6.html"><a href="r6.html"><i class="fa fa-check"></i><b>14</b> R6</a><ul>
<li class="chapter" data-level="14.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>14.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="r6.html"><a href="r6.html#r6-classes"><i class="fa fa-check"></i><b>14.2</b> Classes and methods</a><ul>
<li class="chapter" data-level="14.2.1" data-path="r6.html"><a href="r6.html#method-chaining"><i class="fa fa-check"></i><b>14.2.1</b> Method chaining</a></li>
<li class="chapter" data-level="14.2.2" data-path="r6.html"><a href="r6.html#r6-important-methods"><i class="fa fa-check"></i><b>14.2.2</b> Important methods</a></li>
<li class="chapter" data-level="14.2.3" data-path="r6.html"><a href="r6.html#adding-methods-after-creation"><i class="fa fa-check"></i><b>14.2.3</b> Adding methods after creation</a></li>
<li class="chapter" data-level="14.2.4" data-path="r6.html"><a href="r6.html#inheritance"><i class="fa fa-check"></i><b>14.2.4</b> Inheritance</a></li>
<li class="chapter" data-level="14.2.5" data-path="r6.html"><a href="r6.html#introspection"><i class="fa fa-check"></i><b>14.2.5</b> Introspection</a></li>
<li class="chapter" data-level="14.2.6" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>14.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="r6.html"><a href="r6.html#r6-access"><i class="fa fa-check"></i><b>14.3</b> Controlling access</a><ul>
<li class="chapter" data-level="14.3.1" data-path="r6.html"><a href="r6.html#privacy"><i class="fa fa-check"></i><b>14.3.1</b> Privacy</a></li>
<li class="chapter" data-level="14.3.2" data-path="r6.html"><a href="r6.html#active-fields"><i class="fa fa-check"></i><b>14.3.2</b> Active fields</a></li>
<li class="chapter" data-level="14.3.3" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>14.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="r6.html"><a href="r6.html#r6-semantics"><i class="fa fa-check"></i><b>14.4</b> Reference semantics</a><ul>
<li class="chapter" data-level="14.4.1" data-path="r6.html"><a href="r6.html#reasoning"><i class="fa fa-check"></i><b>14.4.1</b> Reasoning</a></li>
<li class="chapter" data-level="14.4.2" data-path="r6.html"><a href="r6.html#finalizer"><i class="fa fa-check"></i><b>14.4.2</b> Finalizer</a></li>
<li class="chapter" data-level="14.4.3" data-path="r6.html"><a href="r6.html#r6-fields"><i class="fa fa-check"></i><b>14.4.3</b> R6 fields</a></li>
<li class="chapter" data-level="14.4.4" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>14.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="r6.html"><a href="r6.html#why-r6"><i class="fa fa-check"></i><b>14.5</b> Why R6?</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="s4.html"><a href="s4.html"><i class="fa fa-check"></i><b>15</b> S4</a><ul>
<li class="chapter" data-level="15.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>15.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#learning-more"><i class="fa fa-check"></i>Learning more</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="s4.html"><a href="s4.html#s4-basics"><i class="fa fa-check"></i><b>15.2</b> Basics</a><ul>
<li class="chapter" data-level="15.2.1" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>15.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="s4.html"><a href="s4.html#s4-classes"><i class="fa fa-check"></i><b>15.3</b> Classes</a><ul>
<li class="chapter" data-level="15.3.1" data-path="r6.html"><a href="r6.html#inheritance"><i class="fa fa-check"></i><b>15.3.1</b> Inheritance</a></li>
<li class="chapter" data-level="15.3.2" data-path="r6.html"><a href="r6.html#introspection"><i class="fa fa-check"></i><b>15.3.2</b> Introspection</a></li>
<li class="chapter" data-level="15.3.3" data-path="s4.html"><a href="s4.html#redefinition"><i class="fa fa-check"></i><b>15.3.3</b> Redefinition</a></li>
<li class="chapter" data-level="15.3.4" data-path="s4.html"><a href="s4.html#helper"><i class="fa fa-check"></i><b>15.3.4</b> Helper</a></li>
<li class="chapter" data-level="15.3.5" data-path="s4.html"><a href="s4.html#validator"><i class="fa fa-check"></i><b>15.3.5</b> Validator</a></li>
<li class="chapter" data-level="15.3.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>15.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="s4.html"><a href="s4.html#s4-generics"><i class="fa fa-check"></i><b>15.4</b> Generics and methods</a><ul>
<li class="chapter" data-level="15.4.1" data-path="s4.html"><a href="s4.html#signature"><i class="fa fa-check"></i><b>15.4.1</b> Signature</a></li>
<li class="chapter" data-level="15.4.2" data-path="s4.html"><a href="s4.html#methods"><i class="fa fa-check"></i><b>15.4.2</b> Methods</a></li>
<li class="chapter" data-level="15.4.3" data-path="s4.html"><a href="s4.html#show-method"><i class="fa fa-check"></i><b>15.4.3</b> Show method</a></li>
<li class="chapter" data-level="15.4.4" data-path="s4.html"><a href="s4.html#accessors"><i class="fa fa-check"></i><b>15.4.4</b> Accessors</a></li>
<li class="chapter" data-level="15.4.5" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>15.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="s4.html"><a href="s4.html#s4-dispatch"><i class="fa fa-check"></i><b>15.5</b> Method dispatch</a><ul>
<li class="chapter" data-level="15.5.1" data-path="s4.html"><a href="s4.html#single-dispatch"><i class="fa fa-check"></i><b>15.5.1</b> Single dispatch</a></li>
<li class="chapter" data-level="15.5.2" data-path="s4.html"><a href="s4.html#multiple-inheritance"><i class="fa fa-check"></i><b>15.5.2</b> Multiple inheritance</a></li>
<li class="chapter" data-level="15.5.3" data-path="s4.html"><a href="s4.html#multiple-dispatch"><i class="fa fa-check"></i><b>15.5.3</b> Multiple dispatch</a></li>
<li class="chapter" data-level="15.5.4" data-path="s4.html"><a href="s4.html#multiple-dispatch-and-multiple-inheritance"><i class="fa fa-check"></i><b>15.5.4</b> Multiple dispatch and multiple inheritance</a></li>
<li class="chapter" data-level="15.5.5" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>15.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="s4.html"><a href="s4.html#s4-s3"><i class="fa fa-check"></i><b>15.6</b> S4 and S3</a><ul>
<li class="chapter" data-level="15.6.1" data-path="s4.html"><a href="s4.html#classes"><i class="fa fa-check"></i><b>15.6.1</b> Classes</a></li>
<li class="chapter" data-level="15.6.2" data-path="s4.html"><a href="s4.html#generics"><i class="fa fa-check"></i><b>15.6.2</b> Generics</a></li>
<li class="chapter" data-level="15.6.3" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>15.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html"><i class="fa fa-check"></i><b>16</b> Trade-offs</a><ul>
<li class="chapter" data-level="16.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>16.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-s4"><i class="fa fa-check"></i><b>16.2</b> S4 versus S3</a></li>
<li class="chapter" data-level="16.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-r6"><i class="fa fa-check"></i><b>16.3</b> R6 versus S3</a><ul>
<li class="chapter" data-level="16.3.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#namespacing"><i class="fa fa-check"></i><b>16.3.1</b> Namespacing</a></li>
<li class="chapter" data-level="16.3.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#threading-state"><i class="fa fa-check"></i><b>16.3.2</b> Threading state</a></li>
<li class="chapter" data-level="16.3.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#tradeoffs-pipe"><i class="fa fa-check"></i><b>16.3.3</b> Method chaining</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Metaprogramming</b></span></li>
<li class="chapter" data-level="" data-path="metaprogramming.html"><a href="metaprogramming.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="17" data-path="meta-big-picture.html"><a href="meta-big-picture.html"><i class="fa fa-check"></i><b>17</b> Big picture</a><ul>
<li class="chapter" data-level="17.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>17.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="meta-big-picture.html"><a href="meta-big-picture.html#code-data"><i class="fa fa-check"></i><b>17.2</b> Code is data</a></li>
<li class="chapter" data-level="17.3" data-path="meta-big-picture.html"><a href="meta-big-picture.html#code-tree"><i class="fa fa-check"></i><b>17.3</b> Code is a tree</a></li>
<li class="chapter" data-level="17.4" data-path="meta-big-picture.html"><a href="meta-big-picture.html#coding-code"><i class="fa fa-check"></i><b>17.4</b> Code can generate code</a></li>
<li class="chapter" data-level="17.5" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-intro"><i class="fa fa-check"></i><b>17.5</b> Evaluation runs code</a></li>
<li class="chapter" data-level="17.6" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-funs"><i class="fa fa-check"></i><b>17.6</b> Customising evaluation with functions</a></li>
<li class="chapter" data-level="17.7" data-path="meta-big-picture.html"><a href="meta-big-picture.html#eval-data"><i class="fa fa-check"></i><b>17.7</b> Customising evaluation with data</a></li>
<li class="chapter" data-level="17.8" data-path="meta-big-picture.html"><a href="meta-big-picture.html#quosure-intro"><i class="fa fa-check"></i><b>17.8</b> Quosures</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="expressions.html"><a href="expressions.html"><i class="fa fa-check"></i><b>18</b> Expressions</a><ul>
<li class="chapter" data-level="18.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>18.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="expressions.html"><a href="expressions.html#ast"><i class="fa fa-check"></i><b>18.2</b> Abstract syntax trees</a><ul>
<li class="chapter" data-level="18.2.1" data-path="expressions.html"><a href="expressions.html#drawing"><i class="fa fa-check"></i><b>18.2.1</b> Drawing</a></li>
<li class="chapter" data-level="18.2.2" data-path="expressions.html"><a href="expressions.html#non-code-components"><i class="fa fa-check"></i><b>18.2.2</b> Non-code components</a></li>
<li class="chapter" data-level="18.2.3" data-path="expressions.html"><a href="expressions.html#infix-calls"><i class="fa fa-check"></i><b>18.2.3</b> Infix calls</a></li>
<li class="chapter" data-level="18.2.4" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>18.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="expressions.html"><a href="expressions.html#expression-details"><i class="fa fa-check"></i><b>18.3</b> Expressions</a><ul>
<li class="chapter" data-level="18.3.1" data-path="expressions.html"><a href="expressions.html#constants"><i class="fa fa-check"></i><b>18.3.1</b> Constants</a></li>
<li class="chapter" data-level="18.3.2" data-path="expressions.html"><a href="expressions.html#symbols"><i class="fa fa-check"></i><b>18.3.2</b> Symbols</a></li>
<li class="chapter" data-level="18.3.3" data-path="expressions.html"><a href="expressions.html#calls"><i class="fa fa-check"></i><b>18.3.3</b> Calls</a></li>
<li class="chapter" data-level="18.3.4" data-path="expressions.html"><a href="expressions.html#summary"><i class="fa fa-check"></i><b>18.3.4</b> Summary</a></li>
<li class="chapter" data-level="18.3.5" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>18.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="expressions.html"><a href="expressions.html#grammar"><i class="fa fa-check"></i><b>18.4</b> Parsing and grammar</a><ul>
<li class="chapter" data-level="18.4.1" data-path="expressions.html"><a href="expressions.html#operator-precedence"><i class="fa fa-check"></i><b>18.4.1</b> Operator precedence</a></li>
<li class="chapter" data-level="18.4.2" data-path="expressions.html"><a href="expressions.html#associativity"><i class="fa fa-check"></i><b>18.4.2</b> Associativity</a></li>
<li class="chapter" data-level="18.4.3" data-path="expressions.html"><a href="expressions.html#parsing"><i class="fa fa-check"></i><b>18.4.3</b> Parsing and deparsing</a></li>
<li class="chapter" data-level="18.4.4" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>18.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="expressions.html"><a href="expressions.html#ast-funs"><i class="fa fa-check"></i><b>18.5</b> Walking AST with recursive functions</a><ul>
<li class="chapter" data-level="18.5.1" data-path="expressions.html"><a href="expressions.html#finding-f-and-t"><i class="fa fa-check"></i><b>18.5.1</b> Finding F and T</a></li>
<li class="chapter" data-level="18.5.2" data-path="expressions.html"><a href="expressions.html#finding-all-variables-created-by-assignment"><i class="fa fa-check"></i><b>18.5.2</b> Finding all variables created by assignment</a></li>
<li class="chapter" data-level="18.5.3" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>18.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="expressions.html"><a href="expressions.html#expression-special"><i class="fa fa-check"></i><b>18.6</b> Specialised data structures</a><ul>
<li class="chapter" data-level="18.6.1" data-path="expressions.html"><a href="expressions.html#pairlists"><i class="fa fa-check"></i><b>18.6.1</b> Pairlists</a></li>
<li class="chapter" data-level="18.6.2" data-path="expressions.html"><a href="expressions.html#empty-symbol"><i class="fa fa-check"></i><b>18.6.2</b> Missing arguments</a></li>
<li class="chapter" data-level="18.6.3" data-path="expressions.html"><a href="expressions.html#expression-vectors"><i class="fa fa-check"></i><b>18.6.3</b> Expression vectors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="quasiquotation.html"><a href="quasiquotation.html"><i class="fa fa-check"></i><b>19</b> Quasiquotation</a><ul>
<li class="chapter" data-level="19.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>19.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#related-work"><i class="fa fa-check"></i>Related work</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="quasiquotation.html"><a href="quasiquotation.html#quasi-motivation"><i class="fa fa-check"></i><b>19.2</b> Motivation</a><ul>
<li class="chapter" data-level="19.2.1" data-path="quasiquotation.html"><a href="quasiquotation.html#vocabulary"><i class="fa fa-check"></i><b>19.2.1</b> Vocabulary</a></li>
<li class="chapter" data-level="19.2.2" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>19.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="quasiquotation.html"><a href="quasiquotation.html#quoting"><i class="fa fa-check"></i><b>19.3</b> Quoting</a><ul>
<li class="chapter" data-level="19.3.1" data-path="quasiquotation.html"><a href="quasiquotation.html#capturing-expressions"><i class="fa fa-check"></i><b>19.3.1</b> Capturing expressions</a></li>
<li class="chapter" data-level="19.3.2" data-path="quasiquotation.html"><a href="quasiquotation.html#capturing-symbols"><i class="fa fa-check"></i><b>19.3.2</b> Capturing symbols</a></li>
<li class="chapter" data-level="19.3.3" data-path="quasiquotation.html"><a href="quasiquotation.html#with-base-r"><i class="fa fa-check"></i><b>19.3.3</b> With base R</a></li>
<li class="chapter" data-level="19.3.4" data-path="quasiquotation.html"><a href="quasiquotation.html#substitution"><i class="fa fa-check"></i><b>19.3.4</b> Substitution</a></li>
<li class="chapter" data-level="19.3.5" data-path="expressions.html"><a href="expressions.html#summary"><i class="fa fa-check"></i><b>19.3.5</b> Summary</a></li>
<li class="chapter" data-level="19.3.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>19.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting"><i class="fa fa-check"></i><b>19.4</b> Unquoting</a><ul>
<li class="chapter" data-level="19.4.1" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-one-argument"><i class="fa fa-check"></i><b>19.4.1</b> Unquoting one argument</a></li>
<li class="chapter" data-level="19.4.2" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-a-function"><i class="fa fa-check"></i><b>19.4.2</b> Unquoting a function</a></li>
<li class="chapter" data-level="19.4.3" data-path="quasiquotation.html"><a href="quasiquotation.html#unquote-missing"><i class="fa fa-check"></i><b>19.4.3</b> Unquoting a missing argument</a></li>
<li class="chapter" data-level="19.4.4" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-in-special-forms"><i class="fa fa-check"></i><b>19.4.4</b> Unquoting in special forms</a></li>
<li class="chapter" data-level="19.4.5" data-path="quasiquotation.html"><a href="quasiquotation.html#unquoting-many-arguments"><i class="fa fa-check"></i><b>19.4.5</b> Unquoting many arguments</a></li>
<li class="chapter" data-level="19.4.6" data-path="quasiquotation.html"><a href="quasiquotation.html#the-polite-fiction-of"><i class="fa fa-check"></i><b>19.4.6</b> The polite fiction of <code>!!</code></a></li>
<li class="chapter" data-level="19.4.7" data-path="quasiquotation.html"><a href="quasiquotation.html#non-standard-ast"><i class="fa fa-check"></i><b>19.4.7</b> Non-standard ASTs</a></li>
<li class="chapter" data-level="19.4.8" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>19.4.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="quasiquotation.html"><a href="quasiquotation.html#base-nonquote"><i class="fa fa-check"></i><b>19.5</b> Non-quoting</a></li>
<li class="chapter" data-level="19.6" data-path="quasiquotation.html"><a href="quasiquotation.html#tidy-dots"><i class="fa fa-check"></i><b>19.6</b> <code>...</code> (dot-dot-dot)</a><ul>
<li class="chapter" data-level="19.6.1" data-path="quasiquotation.html"><a href="quasiquotation.html#examples"><i class="fa fa-check"></i><b>19.6.1</b> Examples</a></li>
<li class="chapter" data-level="19.6.2" data-path="quasiquotation.html"><a href="quasiquotation.html#exec"><i class="fa fa-check"></i><b>19.6.2</b> <code>exec()</code></a></li>
<li class="chapter" data-level="19.6.3" data-path="quasiquotation.html"><a href="quasiquotation.html#dots_list"><i class="fa fa-check"></i><b>19.6.3</b> <code>dots_list()</code></a></li>
<li class="chapter" data-level="19.6.4" data-path="quasiquotation.html"><a href="quasiquotation.html#do-call"><i class="fa fa-check"></i><b>19.6.4</b> With base R</a></li>
<li class="chapter" data-level="19.6.5" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>19.6.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.7" data-path="quasiquotation.html"><a href="quasiquotation.html#expr-case-studies"><i class="fa fa-check"></i><b>19.7</b> Case studies</a><ul>
<li class="chapter" data-level="19.7.1" data-path="quasiquotation.html"><a href="quasiquotation.html#lobstrast"><i class="fa fa-check"></i><b>19.7.1</b> <code>lobstr::ast()</code></a></li>
<li class="chapter" data-level="19.7.2" data-path="quasiquotation.html"><a href="quasiquotation.html#map-reduce-to-generate-code"><i class="fa fa-check"></i><b>19.7.2</b> Map-reduce to generate code</a></li>
<li class="chapter" data-level="19.7.3" data-path="quasiquotation.html"><a href="quasiquotation.html#slicing-an-array"><i class="fa fa-check"></i><b>19.7.3</b> Slicing an array</a></li>
<li class="chapter" data-level="19.7.4" data-path="quasiquotation.html"><a href="quasiquotation.html#new-function"><i class="fa fa-check"></i><b>19.7.4</b> Creating functions</a></li>
<li class="chapter" data-level="19.7.5" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>19.7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.8" data-path="quasiquotation.html"><a href="quasiquotation.html#history"><i class="fa fa-check"></i><b>19.8</b> History</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="evaluation.html"><a href="evaluation.html"><i class="fa fa-check"></i><b>20</b> Evaluation</a><ul>
<li class="chapter" data-level="20.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>20.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="evaluation.html"><a href="evaluation.html#eval"><i class="fa fa-check"></i><b>20.2</b> Evaluation basics</a><ul>
<li class="chapter" data-level="20.2.1" data-path="evaluation.html"><a href="evaluation.html#application-local"><i class="fa fa-check"></i><b>20.2.1</b> Application: <code>local()</code></a></li>
<li class="chapter" data-level="20.2.2" data-path="evaluation.html"><a href="evaluation.html#application-source"><i class="fa fa-check"></i><b>20.2.2</b> Application: <code>source()</code></a></li>
<li class="chapter" data-level="20.2.3" data-path="evaluation.html"><a href="evaluation.html#gotcha-function"><i class="fa fa-check"></i><b>20.2.3</b> Gotcha: <code>function()</code></a></li>
<li class="chapter" data-level="20.2.4" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>20.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="evaluation.html"><a href="evaluation.html#quosures"><i class="fa fa-check"></i><b>20.3</b> Quosures</a><ul>
<li class="chapter" data-level="20.3.1" data-path="evaluation.html"><a href="evaluation.html#creating"><i class="fa fa-check"></i><b>20.3.1</b> Creating</a></li>
<li class="chapter" data-level="20.3.2" data-path="evaluation.html"><a href="evaluation.html#evaluating"><i class="fa fa-check"></i><b>20.3.2</b> Evaluating</a></li>
<li class="chapter" data-level="20.3.3" data-path="evaluation.html"><a href="evaluation.html#quosure-dots"><i class="fa fa-check"></i><b>20.3.3</b> Dots</a></li>
<li class="chapter" data-level="20.3.4" data-path="evaluation.html"><a href="evaluation.html#quosure-impl"><i class="fa fa-check"></i><b>20.3.4</b> Under the hood</a></li>
<li class="chapter" data-level="20.3.5" data-path="evaluation.html"><a href="evaluation.html#nested-quosures"><i class="fa fa-check"></i><b>20.3.5</b> Nested quosures</a></li>
<li class="chapter" data-level="20.3.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>20.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="evaluation.html"><a href="evaluation.html#data-masks"><i class="fa fa-check"></i><b>20.4</b> Data masks</a><ul>
<li class="chapter" data-level="20.4.1" data-path="environments.html"><a href="environments.html#basics"><i class="fa fa-check"></i><b>20.4.1</b> Basics</a></li>
<li class="chapter" data-level="20.4.2" data-path="evaluation.html"><a href="evaluation.html#pronouns"><i class="fa fa-check"></i><b>20.4.2</b> Pronouns</a></li>
<li class="chapter" data-level="20.4.3" data-path="evaluation.html"><a href="evaluation.html#subset"><i class="fa fa-check"></i><b>20.4.3</b> Application: <code>subset()</code></a></li>
<li class="chapter" data-level="20.4.4" data-path="evaluation.html"><a href="evaluation.html#application-transform"><i class="fa fa-check"></i><b>20.4.4</b> Application: transform</a></li>
<li class="chapter" data-level="20.4.5" data-path="evaluation.html"><a href="evaluation.html#select"><i class="fa fa-check"></i><b>20.4.5</b> Application: <code>select()</code></a></li>
<li class="chapter" data-level="20.4.6" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>20.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="evaluation.html"><a href="evaluation.html#tidy-evaluation"><i class="fa fa-check"></i><b>20.5</b> Using tidy evaluation</a><ul>
<li class="chapter" data-level="20.5.1" data-path="evaluation.html"><a href="evaluation.html#quoting-and-unquoting"><i class="fa fa-check"></i><b>20.5.1</b> Quoting and unquoting</a></li>
<li class="chapter" data-level="20.5.2" data-path="evaluation.html"><a href="evaluation.html#handling-ambiguity"><i class="fa fa-check"></i><b>20.5.2</b> Handling ambiguity</a></li>
<li class="chapter" data-level="20.5.3" data-path="evaluation.html"><a href="evaluation.html#quoting-and-ambiguity"><i class="fa fa-check"></i><b>20.5.3</b> Quoting and ambiguity</a></li>
<li class="chapter" data-level="20.5.4" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>20.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="evaluation.html"><a href="evaluation.html#base-evaluation"><i class="fa fa-check"></i><b>20.6</b> Base evaluation</a><ul>
<li class="chapter" data-level="20.6.1" data-path="evaluation.html"><a href="evaluation.html#substitute"><i class="fa fa-check"></i><b>20.6.1</b> <code>substitute()</code></a></li>
<li class="chapter" data-level="20.6.2" data-path="evaluation.html"><a href="evaluation.html#match.call"><i class="fa fa-check"></i><b>20.6.2</b> <code>match.call()</code></a></li>
<li class="chapter" data-level="20.6.3" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>20.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="translation.html"><a href="translation.html"><i class="fa fa-check"></i><b>21</b> Translating R code</a><ul>
<li class="chapter" data-level="21.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>21.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="translation.html"><a href="translation.html#html"><i class="fa fa-check"></i><b>21.2</b> HTML</a><ul>
<li class="chapter" data-level="21.2.1" data-path="translation.html"><a href="translation.html#goal"><i class="fa fa-check"></i><b>21.2.1</b> Goal</a></li>
<li class="chapter" data-level="21.2.2" data-path="translation.html"><a href="translation.html#escaping"><i class="fa fa-check"></i><b>21.2.2</b> Escaping</a></li>
<li class="chapter" data-level="21.2.3" data-path="translation.html"><a href="translation.html#basic-tag-functions"><i class="fa fa-check"></i><b>21.2.3</b> Basic tag functions</a></li>
<li class="chapter" data-level="21.2.4" data-path="translation.html"><a href="translation.html#tag-functions"><i class="fa fa-check"></i><b>21.2.4</b> Tag functions</a></li>
<li class="chapter" data-level="21.2.5" data-path="translation.html"><a href="translation.html#html-env"><i class="fa fa-check"></i><b>21.2.5</b> Processing all tags</a></li>
<li class="chapter" data-level="21.2.6" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>21.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="translation.html"><a href="translation.html#latex"><i class="fa fa-check"></i><b>21.3</b> LaTeX</a><ul>
<li class="chapter" data-level="21.3.1" data-path="translation.html"><a href="translation.html#latex-mathematics"><i class="fa fa-check"></i><b>21.3.1</b> LaTeX mathematics</a></li>
<li class="chapter" data-level="21.3.2" data-path="translation.html"><a href="translation.html#goal-1"><i class="fa fa-check"></i><b>21.3.2</b> Goal</a></li>
<li class="chapter" data-level="21.3.3" data-path="translation.html"><a href="translation.html#to_math"><i class="fa fa-check"></i><b>21.3.3</b> <code>to_math</code>()</a></li>
<li class="chapter" data-level="21.3.4" data-path="translation.html"><a href="translation.html#known-symbols"><i class="fa fa-check"></i><b>21.3.4</b> Known symbols</a></li>
<li class="chapter" data-level="21.3.5" data-path="translation.html"><a href="translation.html#unknown-symbols"><i class="fa fa-check"></i><b>21.3.5</b> Unknown symbols</a></li>
<li class="chapter" data-level="21.3.6" data-path="translation.html"><a href="translation.html#known-functions"><i class="fa fa-check"></i><b>21.3.6</b> Known functions</a></li>
<li class="chapter" data-level="21.3.7" data-path="translation.html"><a href="translation.html#unknown-functions"><i class="fa fa-check"></i><b>21.3.7</b> Unknown functions</a></li>
<li class="chapter" data-level="21.3.8" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>21.3.8</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Techniques</b></span></li>
<li class="chapter" data-level="" data-path="techniques.html"><a href="techniques.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="22" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>22</b> Debugging</a><ul>
<li class="chapter" data-level="22.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>22.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="debugging.html"><a href="debugging.html#debugging-strategy"><i class="fa fa-check"></i><b>22.2</b> Overall approach</a></li>
<li class="chapter" data-level="22.3" data-path="debugging.html"><a href="debugging.html#traceback"><i class="fa fa-check"></i><b>22.3</b> Locating errors</a><ul>
<li class="chapter" data-level="22.3.1" data-path="debugging.html"><a href="debugging.html#debug-lazy"><i class="fa fa-check"></i><b>22.3.1</b> Lazy evaluation</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="debugging.html"><a href="debugging.html#browser"><i class="fa fa-check"></i><b>22.4</b> Interactive debugger</a><ul>
<li class="chapter" data-level="22.4.1" data-path="debugging.html"><a href="debugging.html#browser-commands"><i class="fa fa-check"></i><b>22.4.1</b> <code>browser()</code> commands</a></li>
<li class="chapter" data-level="22.4.2" data-path="debugging.html"><a href="debugging.html#alternatives"><i class="fa fa-check"></i><b>22.4.2</b> Alternatives</a></li>
<li class="chapter" data-level="22.4.3" data-path="debugging.html"><a href="debugging.html#debug-compiled"><i class="fa fa-check"></i><b>22.4.3</b> Compiled code</a></li>
</ul></li>
<li class="chapter" data-level="22.5" data-path="debugging.html"><a href="debugging.html#non-interactive-debugging"><i class="fa fa-check"></i><b>22.5</b> Non-interactive debugging</a><ul>
<li class="chapter" data-level="22.5.1" data-path="debugging.html"><a href="debugging.html#dump.frames"><i class="fa fa-check"></i><b>22.5.1</b> <code>dump.frames()</code></a></li>
<li class="chapter" data-level="22.5.2" data-path="debugging.html"><a href="debugging.html#print-debugging"><i class="fa fa-check"></i><b>22.5.2</b> Print debugging</a></li>
<li class="chapter" data-level="22.5.3" data-path="debugging.html"><a href="debugging.html#rmarkdown"><i class="fa fa-check"></i><b>22.5.3</b> RMarkdown</a></li>
</ul></li>
<li class="chapter" data-level="22.6" data-path="debugging.html"><a href="debugging.html#non-error-failures"><i class="fa fa-check"></i><b>22.6</b> Non-error failures</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="perf-measure.html"><a href="perf-measure.html"><i class="fa fa-check"></i><b>23</b> Measuring performance</a><ul>
<li class="chapter" data-level="23.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>23.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="23.2" data-path="perf-measure.html"><a href="perf-measure.html#profiling"><i class="fa fa-check"></i><b>23.2</b> Profiling</a><ul>
<li class="chapter" data-level="23.2.1" data-path="perf-measure.html"><a href="perf-measure.html#visualising-profiles"><i class="fa fa-check"></i><b>23.2.1</b> Visualising profiles</a></li>
<li class="chapter" data-level="23.2.2" data-path="perf-measure.html"><a href="perf-measure.html#memory-profiling"><i class="fa fa-check"></i><b>23.2.2</b> Memory profiling</a></li>
<li class="chapter" data-level="23.2.3" data-path="perf-measure.html"><a href="perf-measure.html#limitations"><i class="fa fa-check"></i><b>23.2.3</b> Limitations</a></li>
<li class="chapter" data-level="23.2.4" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>23.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="perf-measure.html"><a href="perf-measure.html#microbenchmarking"><i class="fa fa-check"></i><b>23.3</b> Microbenchmarking</a><ul>
<li class="chapter" data-level="23.3.1" data-path="perf-measure.html"><a href="perf-measure.html#benchmark-results"><i class="fa fa-check"></i><b>23.3.1</b> <code>bench::mark()</code> results</a></li>
<li class="chapter" data-level="23.3.2" data-path="perf-measure.html"><a href="perf-measure.html#interpreting-results"><i class="fa fa-check"></i><b>23.3.2</b> Interpreting results</a></li>
<li class="chapter" data-level="23.3.3" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>23.3.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="24" data-path="perf-improve.html"><a href="perf-improve.html"><i class="fa fa-check"></i><b>24</b> Improving performance</a><ul>
<li class="chapter" data-level="24.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>24.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="perf-improve.html"><a href="perf-improve.html#code-organisation"><i class="fa fa-check"></i><b>24.2</b> Code organisation</a></li>
<li class="chapter" data-level="24.3" data-path="perf-improve.html"><a href="perf-improve.html#already-solved"><i class="fa fa-check"></i><b>24.3</b> Checking for existing solutions</a><ul>
<li class="chapter" data-level="24.3.1" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>24.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="perf-improve.html"><a href="perf-improve.html#be-lazy"><i class="fa fa-check"></i><b>24.4</b> Doing as little as possible</a><ul>
<li class="chapter" data-level="24.4.1" data-path="perf-improve.html"><a href="perf-improve.html#mean"><i class="fa fa-check"></i><b>24.4.1</b> <code>mean()</code></a></li>
<li class="chapter" data-level="24.4.2" data-path="perf-improve.html"><a href="perf-improve.html#as.data.frame"><i class="fa fa-check"></i><b>24.4.2</b> <code>as.data.frame()</code></a></li>
<li class="chapter" data-level="24.4.3" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>24.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.5" data-path="perf-improve.html"><a href="perf-improve.html#vectorise"><i class="fa fa-check"></i><b>24.5</b> Vectorise</a><ul>
<li class="chapter" data-level="24.5.1" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>24.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.6" data-path="perf-improve.html"><a href="perf-improve.html#avoid-copies"><i class="fa fa-check"></i><b>24.6</b> Avoiding copies</a></li>
<li class="chapter" data-level="24.7" data-path="perf-improve.html"><a href="perf-improve.html#t-test"><i class="fa fa-check"></i><b>24.7</b> Case study: t-test</a></li>
<li class="chapter" data-level="24.8" data-path="perf-improve.html"><a href="perf-improve.html#more-techniques"><i class="fa fa-check"></i><b>24.8</b> Other techniques</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>25</b> Rewriting R code in C++</a><ul>
<li class="chapter" data-level="25.1" data-path="introduction.html"><a href="introduction.html#introduction"><i class="fa fa-check"></i><b>25.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro"><i class="fa fa-check"></i><b>25.2</b> Getting started with C++</a><ul>
<li class="chapter" data-level="25.2.1" data-path="rcpp.html"><a href="rcpp.html#no-inputs-scalar-output"><i class="fa fa-check"></i><b>25.2.1</b> No inputs, scalar output</a></li>
<li class="chapter" data-level="25.2.2" data-path="rcpp.html"><a href="rcpp.html#scalar-input-scalar-output"><i class="fa fa-check"></i><b>25.2.2</b> Scalar input, scalar output</a></li>
<li class="chapter" data-level="25.2.3" data-path="rcpp.html"><a href="rcpp.html#vector-input-scalar-output"><i class="fa fa-check"></i><b>25.2.3</b> Vector input, scalar output</a></li>
<li class="chapter" data-level="25.2.4" data-path="rcpp.html"><a href="rcpp.html#vector-input-vector-output"><i class="fa fa-check"></i><b>25.2.4</b> Vector input, vector output</a></li>
<li class="chapter" data-level="25.2.5" data-path="rcpp.html"><a href="rcpp.html#sourceCpp"><i class="fa fa-check"></i><b>25.2.5</b> Using sourceCpp</a></li>
<li class="chapter" data-level="25.2.6" data-path="rcpp.html"><a href="rcpp.html#exercise-started"><i class="fa fa-check"></i><b>25.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="rcpp.html"><a href="rcpp.html#rcpp-classes"><i class="fa fa-check"></i><b>25.3</b> Other classes</a><ul>
<li class="chapter" data-level="25.3.1" data-path="rcpp.html"><a href="rcpp.html#lists-and-data-frames"><i class="fa fa-check"></i><b>25.3.1</b> Lists and data frames</a></li>
<li class="chapter" data-level="25.3.2" data-path="rcpp.html"><a href="rcpp.html#functions-rcpp"><i class="fa fa-check"></i><b>25.3.2</b> Functions</a></li>
<li class="chapter" data-level="25.3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attributes"><i class="fa fa-check"></i><b>25.3.3</b> Attributes</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="rcpp.html"><a href="rcpp.html#rcpp-na"><i class="fa fa-check"></i><b>25.4</b> Missing values</a><ul>
<li class="chapter" data-level="25.4.1" data-path="vectors-chap.html"><a href="vectors-chap.html#scalars"><i class="fa fa-check"></i><b>25.4.1</b> Scalars</a></li>
<li class="chapter" data-level="25.4.2" data-path="rcpp.html"><a href="rcpp.html#strings"><i class="fa fa-check"></i><b>25.4.2</b> Strings</a></li>
<li class="chapter" data-level="25.4.3" data-path="rcpp.html"><a href="rcpp.html#boolean"><i class="fa fa-check"></i><b>25.4.3</b> Boolean</a></li>
<li class="chapter" data-level="25.4.4" data-path="rcpp.html"><a href="rcpp.html#vectors-rcpp"><i class="fa fa-check"></i><b>25.4.4</b> Vectors</a></li>
<li class="chapter" data-level="25.4.5" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>25.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="rcpp.html"><a href="rcpp.html#stl"><i class="fa fa-check"></i><b>25.5</b> Standard Template Library</a><ul>
<li class="chapter" data-level="25.5.1" data-path="rcpp.html"><a href="rcpp.html#using-iterators"><i class="fa fa-check"></i><b>25.5.1</b> Using iterators</a></li>
<li class="chapter" data-level="25.5.2" data-path="rcpp.html"><a href="rcpp.html#algorithms"><i class="fa fa-check"></i><b>25.5.2</b> Algorithms</a></li>
<li class="chapter" data-level="25.5.3" data-path="rcpp.html"><a href="rcpp.html#data-structures-rcpp"><i class="fa fa-check"></i><b>25.5.3</b> Data structures</a></li>
<li class="chapter" data-level="25.5.4" data-path="rcpp.html"><a href="rcpp.html#vectors-stl"><i class="fa fa-check"></i><b>25.5.4</b> Vectors</a></li>
<li class="chapter" data-level="25.5.5" data-path="rcpp.html"><a href="rcpp.html#sets"><i class="fa fa-check"></i><b>25.5.5</b> Sets</a></li>
<li class="chapter" data-level="25.5.6" data-path="functionals.html"><a href="functionals.html#map"><i class="fa fa-check"></i><b>25.5.6</b> Map</a></li>
<li class="chapter" data-level="25.5.7" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>25.5.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.6" data-path="rcpp.html"><a href="rcpp.html#rcpp-case-studies"><i class="fa fa-check"></i><b>25.6</b> Case studies</a><ul>
<li class="chapter" data-level="25.6.1" data-path="rcpp.html"><a href="rcpp.html#gibbs-sampler"><i class="fa fa-check"></i><b>25.6.1</b> Gibbs sampler</a></li>
<li class="chapter" data-level="25.6.2" data-path="rcpp.html"><a href="rcpp.html#r-vectorisation-versus-c-vectorisation"><i class="fa fa-check"></i><b>25.6.2</b> R vectorisation versus C++ vectorisation</a></li>
</ul></li>
<li class="chapter" data-level="25.7" data-path="rcpp.html"><a href="rcpp.html#rcpp-package"><i class="fa fa-check"></i><b>25.7</b> Using Rcpp in a package</a></li>
<li class="chapter" data-level="25.8" data-path="rcpp.html"><a href="rcpp.html#rcpp-more"><i class="fa fa-check"></i><b>25.8</b> Learning more</a></li>
<li class="chapter" data-level="25.9" data-path="rcpp.html"><a href="rcpp.html#acknowledgments"><i class="fa fa-check"></i><b>25.9</b> Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functionals" class="section level1">
<h1><span class="header-section-number">9</span> Functionals</h1>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">9.1</span> Introduction</h2>
<p></p>
<blockquote>
<p>To become significantly more reliable, code must become more transparent.
In particular, nested conditions and loops must be viewed with great
suspicion. Complicated control flows confuse programmers. Messy code often
hides bugs.</p>
<p> Bjarne Stroustrup</p>
</blockquote>
<p>A <strong>functional</strong> is a function that takes a function as an input and returns a vector as output. Heres a simple functional: it calls the function provided as input with 1000 random uniform numbers.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb384-1" data-line-number="1">randomise &lt;-<span class="st"> </span><span class="cf">function</span>(f) <span class="kw">f</span>(<span class="kw">runif</span>(<span class="fl">1e3</span>))</a>
<a class="sourceLine" id="cb384-2" data-line-number="2"><span class="kw">randomise</span>(mean)</a>
<a class="sourceLine" id="cb384-3" data-line-number="3"><span class="co">#&gt; [1] 0.506</span></a>
<a class="sourceLine" id="cb384-4" data-line-number="4"><span class="kw">randomise</span>(mean)</a>
<a class="sourceLine" id="cb384-5" data-line-number="5"><span class="co">#&gt; [1] 0.501</span></a>
<a class="sourceLine" id="cb384-6" data-line-number="6"><span class="kw">randomise</span>(sum)</a>
<a class="sourceLine" id="cb384-7" data-line-number="7"><span class="co">#&gt; [1] 489</span></a></code></pre></div>
<p>The chances are that youve already used a functional. You might have used for-loop replacements like base Rs <code>lapply()</code>, <code>apply()</code>, and <code>tapply()</code>; or purrrs <code>map()</code>; or maybe youve used a mathematical functional like <code>integrate()</code> or <code>optim()</code>.</p>
<p>
A common use of functionals is as an alternative to for loops. For loops have a bad rap in R because many people believe they are slow<a href="#fn37" class="footnote-ref" id="fnref37"><sup>37</sup></a>, but the real downside of for loops is that theyre very flexible: a loop conveys that youre iterating, but not what should be done with the results. Just as its better to use <code>while</code> than <code>repeat</code>, and its better to use <code>for</code> than <code>while</code> (Section <a href="control-flow.html#for-family">5.3.2</a>), its better to use a functional than <code>for</code>. Each functional is tailored for a specific task, so when you recognise the functional you immediately know why its being used.</p>
<p>If youre an experienced for loop user, switching to functionals is typically a pattern matching exercise. You look at the for loop and find a functional that matches the basic form. If one doesnt exist, dont try and torture an existing functional to fit the form you need. Instead, just leave it as a for loop! (Or once youve repeated the same loop two or more times, maybe think about writing your own functional).</p>
<div id="outline" class="section level3 unnumbered">
<h3>Outline</h3>
<ul>
<li><p>Section <a href="functionals.html#map">9.2</a> introduces your first functional: <code>purrr::map()</code>.</p></li>
<li><p>Section <a href="functionals.html#purrr-style">9.3</a> demonstrates how you can combine multiple simple
functionals to solve a more complex problem and discusses how purrr style
differs from other approaches.</p></li>
<li><p>Section <a href="functionals.html#map-variants">9.4</a> teaches you about 18 (!!) important variants of
<code>purrr::map()</code>. Fortunately, their orthogonal design makes them easy to
learn, remember, and master.</p></li>
<li><p>Section <a href="functionals.html#reduce">9.5</a> introduces a new style of functional: <code>purrr::reduce()</code>.
<code>reduce()</code> systematically reduces a vector to a single result by applying
a function that takes two inputs.</p></li>
<li><p>Section <a href="functionals.html#predicate-functionals">9.6</a> teaches you about predicates: functions
that return a single <code>TRUE</code> or <code>FALSE</code>, and the family of functionals
that use them to solve common problems.</p></li>
<li><p>Section <a href="functionals.html#base-functionals">9.7</a> reviews some functionals in base R that
are not members of the map, reduce, or predicate families.</p></li>
</ul>
</div>
<div id="prerequisites" class="section level3 unnumbered">
<h3>Prerequisites</h3>
<p>This chapter will focus on functionals provided by the <a href="https://purrr.tidyverse.org">purrr package</a> <span class="citation">(Henry and Wickham <a href="#ref-purrr">2018</a><a href="#ref-purrr">a</a>)</span>. These functions have a consistent interface that makes it easier to understand the key ideas than their base equivalents, which have grown organically over many years. Ill compare and contrast base R functions as we go, and then wrap up the chapter with a discussion of base functionals that dont have purrr equivalents.</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb385-1" data-line-number="1"><span class="kw">library</span>(purrr)</a></code></pre></div>
</div>
</div>
<div id="map" class="section level2">
<h2><span class="header-section-number">9.2</span> My first functional: <code>map()</code></h2>

<p>The most fundamental functional is <code>purrr::map()</code><a href="#fn38" class="footnote-ref" id="fnref38"><sup>38</sup></a>. It takes a vector and a function, calls the function once for each element of the vector, and returns the results in a list. In other words, <code>map(1:3, f)</code> is equivalent to <code>list(f(1), f(2), f(3))</code>.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb386-1" data-line-number="1">triple &lt;-<span class="st"> </span><span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb386-2" data-line-number="2"><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, triple)</a>
<a class="sourceLine" id="cb386-3" data-line-number="3"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb386-4" data-line-number="4"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb386-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb386-6" data-line-number="6"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb386-7" data-line-number="7"><span class="co">#&gt; [1] 6</span></a>
<a class="sourceLine" id="cb386-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb386-9" data-line-number="9"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb386-10" data-line-number="10"><span class="co">#&gt; [1] 9</span></a></code></pre></div>
<p>Or, graphically:</p>
<p><img src="diagrams/functionals/map.png" style="display: block; margin: auto;" /></p>
<div class="sidebar">
<p>You might wonder why this function is called <code>map()</code>. What does it have to do with depicting physical features of land or sea ? In fact, the meaning comes from mathematics where <em>map</em> refers to an operation that associates each element of a given set with one or more elements of a second set. This makes sense here because <code>map()</code> defines a mapping from one vector to another. (<em>Map</em> also has the nice property of being short, which is useful for such a fundamental building block.)</p>
</div>
<p>The implementation of <code>map()</code> is quite simple. We allocate a list the same length as the input, and then fill in the list with a for loop. The heart of the implementation is only a handful of lines of code:</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb387-1" data-line-number="1">simple_map &lt;-<span class="st"> </span><span class="cf">function</span>(x, f, ...) {</a>
<a class="sourceLine" id="cb387-2" data-line-number="2">  out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb387-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {</a>
<a class="sourceLine" id="cb387-4" data-line-number="4">    out[[i]] &lt;-<span class="st"> </span><span class="kw">f</span>(x[[i]], ...)</a>
<a class="sourceLine" id="cb387-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb387-6" data-line-number="6">  out</a>
<a class="sourceLine" id="cb387-7" data-line-number="7">}</a></code></pre></div>
<p>The real <code>purrr::map()</code> function has a few differences: it is written in C to eke out every last iota of performance, preserves names, and supports a few shortcuts that youll learn about in Section <a href="functionals.html#purrr-shortcuts">9.2.2</a>.</p>
<div class="base">
<p>The base equivalent to <code>map()</code> is <code>lapply()</code>. The only difference is that <code>lapply()</code> does not support the helpers that youll learn about below, so if youre only using <code>map()</code> from purrr, you can skip the additional dependency and use <code>lapply()</code> directly.</p>
</div>
<div id="map-atomic" class="section level3">
<h3><span class="header-section-number">9.2.1</span> Producing atomic vectors</h3>
<p><code>map()</code> returns a list, which makes it the most general of the map family because you can put anything in a list. But it is inconvenient to return a list when a simpler data structure would do, so there are four more specific variants: <code>map_lgl()</code>, <code>map_int()</code>, <code>map_dbl()</code>, and <code>map_chr()</code>. Each returns an atomic vector of the specified type:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb388-1" data-line-number="1"><span class="co"># map_chr() always returns a character vector</span></a>
<a class="sourceLine" id="cb388-2" data-line-number="2"><span class="kw">map_chr</span>(mtcars, typeof)</a>
<a class="sourceLine" id="cb388-3" data-line-number="3"><span class="co">#&gt;      mpg      cyl     disp       hp     drat       wt     qsec       vs </span></a>
<a class="sourceLine" id="cb388-4" data-line-number="4"><span class="co">#&gt; &quot;double&quot; &quot;double&quot; &quot;double&quot; &quot;double&quot; &quot;double&quot; &quot;double&quot; &quot;double&quot; &quot;double&quot; </span></a>
<a class="sourceLine" id="cb388-5" data-line-number="5"><span class="co">#&gt;       am     gear     carb </span></a>
<a class="sourceLine" id="cb388-6" data-line-number="6"><span class="co">#&gt; &quot;double&quot; &quot;double&quot; &quot;double&quot;</span></a>
<a class="sourceLine" id="cb388-7" data-line-number="7"></a>
<a class="sourceLine" id="cb388-8" data-line-number="8"><span class="co"># map_lgl() always returns a logical vector</span></a>
<a class="sourceLine" id="cb388-9" data-line-number="9"><span class="kw">map_lgl</span>(mtcars, is.double)</a>
<a class="sourceLine" id="cb388-10" data-line-number="10"><span class="co">#&gt;  mpg  cyl disp   hp drat   wt qsec   vs   am gear carb </span></a>
<a class="sourceLine" id="cb388-11" data-line-number="11"><span class="co">#&gt; TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE</span></a>
<a class="sourceLine" id="cb388-12" data-line-number="12"></a>
<a class="sourceLine" id="cb388-13" data-line-number="13"><span class="co"># map_int() always returns a integer vector</span></a>
<a class="sourceLine" id="cb388-14" data-line-number="14">n_unique &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">length</span>(<span class="kw">unique</span>(x))</a>
<a class="sourceLine" id="cb388-15" data-line-number="15"><span class="kw">map_int</span>(mtcars, n_unique)</a>
<a class="sourceLine" id="cb388-16" data-line-number="16"><span class="co">#&gt;  mpg  cyl disp   hp drat   wt qsec   vs   am gear carb </span></a>
<a class="sourceLine" id="cb388-17" data-line-number="17"><span class="co">#&gt;   25    3   27   22   22   29   30    2    2    3    6</span></a>
<a class="sourceLine" id="cb388-18" data-line-number="18"></a>
<a class="sourceLine" id="cb388-19" data-line-number="19"><span class="co"># map_dbl() always returns a double vector</span></a>
<a class="sourceLine" id="cb388-20" data-line-number="20"><span class="kw">map_dbl</span>(mtcars, mean)</a>
<a class="sourceLine" id="cb388-21" data-line-number="21"><span class="co">#&gt;     mpg     cyl    disp      hp    drat      wt    qsec      vs      am    gear </span></a>
<a class="sourceLine" id="cb388-22" data-line-number="22"><span class="co">#&gt;  20.091   6.188 230.722 146.688   3.597   3.217  17.849   0.438   0.406   3.688 </span></a>
<a class="sourceLine" id="cb388-23" data-line-number="23"><span class="co">#&gt;    carb </span></a>
<a class="sourceLine" id="cb388-24" data-line-number="24"><span class="co">#&gt;   2.812</span></a></code></pre></div>
<p>purrr uses the convention that suffixes, like <code>_dbl()</code>, refer to the output. All <code>map_*()</code> functions can take any type of vector as input. These examples rely on two facts: <code>mtcars</code> is a data frame, and data frames are lists containing vectors of the same length. This is more obvious if we draw a data frame with the same orientation as vector:</p>
<p><img src="diagrams/functionals/map-list.png" style="display: block; margin: auto;" /></p>
<p>All map functions always return an output vector the same length as the input, which implies that each call to <code>.f</code> must return a single value. If it does not, youll get an error:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb389-1" data-line-number="1">pair &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">c</span>(x, x)</a>
<a class="sourceLine" id="cb389-2" data-line-number="2"><span class="kw">map_dbl</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, pair)</a>
<a class="sourceLine" id="cb389-3" data-line-number="3"><span class="co">#&gt; Error: Result 1 must be a single double, not an integer vector of length 2</span></a></code></pre></div>
<p>This is similar to the error youll get if <code>.f</code> returns the wrong type of result:</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb390-1" data-line-number="1"><span class="kw">map_dbl</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, as.character)</a>
<a class="sourceLine" id="cb390-2" data-line-number="2"><span class="co">#&gt; Error: Can&#39;t coerce element 1 from a character to a double</span></a></code></pre></div>
<p>In either case, its often useful to switch back to <code>map()</code>, because <code>map()</code> can accept any type of output. That allows you to see the problematic output, and figure out what to do with it.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb391-1" data-line-number="1"><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, pair)</a>
<a class="sourceLine" id="cb391-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb391-3" data-line-number="3"><span class="co">#&gt; [1] 1 1</span></a>
<a class="sourceLine" id="cb391-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb391-5" data-line-number="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb391-6" data-line-number="6"><span class="co">#&gt; [1] 2 2</span></a>
<a class="sourceLine" id="cb391-7" data-line-number="7"><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, as.character)</a>
<a class="sourceLine" id="cb391-8" data-line-number="8"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb391-9" data-line-number="9"><span class="co">#&gt; [1] &quot;1&quot;</span></a>
<a class="sourceLine" id="cb391-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb391-11" data-line-number="11"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb391-12" data-line-number="12"><span class="co">#&gt; [1] &quot;2&quot;</span></a></code></pre></div>
<div class="base">
<p>Base R has two apply functions that can return atomic vectors: <code>sapply()</code> and <code>vapply()</code>. I recommend that you avoid <code>sapply()</code> because it tries to simplify the result, so it can return a list, a vector, or a matrix. This makes it difficult to program with, and it should be avoided in non-interactive settings. <code>vapply()</code> is safer because it allows you to provide a template, <code>FUN.VALUE</code>, that describes the output shape. If you dont want to use purrr, I recommend you always use <code>vapply()</code> in your functions, not <code>sapply()</code>. The primary downside of <code>vapply()</code> is its verbosity: for example, the equivalent to <code>map_dbl(x, mean, na.rm = TRUE)</code> is <code>vapply(x, mean, na.rm = TRUE, FUN.VALUE = double(1))</code>.</p>
</div>
</div>
<div id="purrr-shortcuts" class="section level3">
<h3><span class="header-section-number">9.2.2</span> Anonymous functions and shortcuts</h3>
<p>
</p>
<p>Instead of using <code>map()</code> with an existing function, you can create an inline anonymous function (as mentioned in Section <a href="functions.html#first-class-functions">6.2.3</a>):</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb392-1" data-line-number="1"><span class="kw">map_dbl</span>(mtcars, <span class="cf">function</span>(x) <span class="kw">length</span>(<span class="kw">unique</span>(x)))</a>
<a class="sourceLine" id="cb392-2" data-line-number="2"><span class="co">#&gt;  mpg  cyl disp   hp drat   wt qsec   vs   am gear carb </span></a>
<a class="sourceLine" id="cb392-3" data-line-number="3"><span class="co">#&gt;   25    3   27   22   22   29   30    2    2    3    6</span></a></code></pre></div>
<p>Anonymous functions are very useful, but the syntax is verbose. So purrr supports a special shortcut:</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb393-1" data-line-number="1"><span class="kw">map_dbl</span>(mtcars, <span class="op">~</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(.x)))</a>
<a class="sourceLine" id="cb393-2" data-line-number="2"><span class="co">#&gt;  mpg  cyl disp   hp drat   wt qsec   vs   am gear carb </span></a>
<a class="sourceLine" id="cb393-3" data-line-number="3"><span class="co">#&gt;   25    3   27   22   22   29   30    2    2    3    6</span></a></code></pre></div>
<p>This works because all purrr functions translate formulas, created by <code>~</code> (pronounced twiddle), into functions. You can see whats happening behind the scenes by calling <code>as_mapper()</code>:</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb394-1" data-line-number="1"><span class="kw">as_mapper</span>(<span class="op">~</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(.x)))</a>
<a class="sourceLine" id="cb394-2" data-line-number="2"><span class="co">#&gt; &lt;lambda&gt;</span></a>
<a class="sourceLine" id="cb394-3" data-line-number="3"><span class="co">#&gt; function (..., .x = ..1, .y = ..2, . = ..1) </span></a>
<a class="sourceLine" id="cb394-4" data-line-number="4"><span class="co">#&gt; length(unique(.x))</span></a>
<a class="sourceLine" id="cb394-5" data-line-number="5"><span class="co">#&gt; attr(,&quot;class&quot;)</span></a>
<a class="sourceLine" id="cb394-6" data-line-number="6"><span class="co">#&gt; [1] &quot;rlang_lambda_function&quot; &quot;function&quot;</span></a></code></pre></div>
<p>The function arguments look a little quirky but allow you to refer to <code>.</code> for one argument functions, <code>.x</code> and <code>.y.</code> for two argument functions, and <code>..1</code>, <code>..2</code>, <code>..3</code>, etc, for functions with an arbitrary number of arguments. <code>.</code> remains for backward compatibility but I dont recommend using it because its easily confused with the <code>.</code> used by magrittrs pipe.</p>
<p>This shortcut is particularly useful for generating random data:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb395-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="op">~</span><span class="st"> </span><span class="kw">runif</span>(<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb395-2" data-line-number="2"><span class="kw">str</span>(x)</a>
<a class="sourceLine" id="cb395-3" data-line-number="3"><span class="co">#&gt; List of 3</span></a>
<a class="sourceLine" id="cb395-4" data-line-number="4"><span class="co">#&gt;  $ : num [1:2] 0.281 0.53</span></a>
<a class="sourceLine" id="cb395-5" data-line-number="5"><span class="co">#&gt;  $ : num [1:2] 0.433 0.917</span></a>
<a class="sourceLine" id="cb395-6" data-line-number="6"><span class="co">#&gt;  $ : num [1:2] 0.0275 0.8249</span></a></code></pre></div>
<p>Reserve this syntax for short and simple functions. A good rule of thumb is that if your function spans lines or uses <code>{}</code>, its time to give it a name.</p>

<p>The map functions also have shortcuts for extracting elements from a vector, powered by <code>purrr::pluck()</code>. You can use a character vector to select elements by name, an integer vector to select by position, or a list to select by both name and position. These are very useful for working with deeply nested lists, which often arise when working with JSON.</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb396-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb396-2" data-line-number="2">  <span class="kw">list</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">2</span>), <span class="dt">z =</span> <span class="st">&quot;a&quot;</span>),</a>
<a class="sourceLine" id="cb396-3" data-line-number="3">  <span class="kw">list</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dt">x =</span> <span class="dv">4</span>, <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">6</span>), <span class="dt">z =</span> <span class="st">&quot;b&quot;</span>),</a>
<a class="sourceLine" id="cb396-4" data-line-number="4">  <span class="kw">list</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dt">x =</span> <span class="dv">8</span>, <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>))</a>
<a class="sourceLine" id="cb396-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb396-6" data-line-number="6"></a>
<a class="sourceLine" id="cb396-7" data-line-number="7"><span class="co"># Select by name</span></a>
<a class="sourceLine" id="cb396-8" data-line-number="8"><span class="kw">map_dbl</span>(x, <span class="st">&quot;x&quot;</span>)</a>
<a class="sourceLine" id="cb396-9" data-line-number="9"><span class="co">#&gt; [1] 1 4 8</span></a>
<a class="sourceLine" id="cb396-10" data-line-number="10"></a>
<a class="sourceLine" id="cb396-11" data-line-number="11"><span class="co"># Or by position</span></a>
<a class="sourceLine" id="cb396-12" data-line-number="12"><span class="kw">map_dbl</span>(x, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb396-13" data-line-number="13"><span class="co">#&gt; [1] -1 -2 -3</span></a>
<a class="sourceLine" id="cb396-14" data-line-number="14"></a>
<a class="sourceLine" id="cb396-15" data-line-number="15"><span class="co"># Or by both</span></a>
<a class="sourceLine" id="cb396-16" data-line-number="16"><span class="kw">map_dbl</span>(x, <span class="kw">list</span>(<span class="st">&quot;y&quot;</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb396-17" data-line-number="17"><span class="co">#&gt; [1] 2 5 9</span></a>
<a class="sourceLine" id="cb396-18" data-line-number="18"></a>
<a class="sourceLine" id="cb396-19" data-line-number="19"><span class="co"># You&#39;ll get an error if a component doesn&#39;t exist:</span></a>
<a class="sourceLine" id="cb396-20" data-line-number="20"><span class="kw">map_chr</span>(x, <span class="st">&quot;z&quot;</span>)</a>
<a class="sourceLine" id="cb396-21" data-line-number="21"><span class="co">#&gt; Error: Result 3 must be a single string, not NULL of length 0</span></a>
<a class="sourceLine" id="cb396-22" data-line-number="22"></a>
<a class="sourceLine" id="cb396-23" data-line-number="23"><span class="co"># Unless you supply a .default value</span></a>
<a class="sourceLine" id="cb396-24" data-line-number="24"><span class="kw">map_chr</span>(x, <span class="st">&quot;z&quot;</span>, <span class="dt">.default =</span> <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb396-25" data-line-number="25"><span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot; NA</span></a></code></pre></div>
<div class="base">
<p>In base R functions, like <code>lapply()</code>, you can provide the name of the function as a string. This isnt tremendously useful as <code>lapply(x, &quot;f&quot;)</code> is almost always equivalent to <code>lapply(x, f)</code> and is more typing.</p>
</div>
</div>
<div id="passing-arguments" class="section level3">
<h3><span class="header-section-number">9.2.3</span> Passing arguments with <code>...</code></h3>

<p></p>
<p>Its often convenient to pass along additional arguments to the function that youre calling. For example, you might want to pass <code>na.rm = TRUE</code> along to <code>mean()</code>. One way to do that is with an anonymous function:</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb397-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="ot">NA</span>))</a>
<a class="sourceLine" id="cb397-2" data-line-number="2"><span class="kw">map_dbl</span>(x, <span class="op">~</span><span class="st"> </span><span class="kw">mean</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb397-3" data-line-number="3"><span class="co">#&gt; [1] 3.0 5.5</span></a></code></pre></div>
<p>But because the map functions pass <code>...</code> along, theres a simpler form available:</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb398-1" data-line-number="1"><span class="kw">map_dbl</span>(x, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb398-2" data-line-number="2"><span class="co">#&gt; [1] 3.0 5.5</span></a></code></pre></div>
<p>This is easiest to understand with a picture: any arguments that come after <code>f</code> in the call to <code>map()</code> are inserted <em>after</em> the data in individual calls to <code>f()</code>:</p>
<p><img src="diagrams/functionals/map-arg.png" style="display: block; margin: auto;" /></p>
<p>Its important to note that these arguments are not decomposed; or said another way, <code>map()</code> is only vectorised over its first argument. If an argument after <code>f</code> is a vector, it will be passed along as is:</p>
<p><img src="diagrams/functionals/map-arg-recycle.png" style="display: block; margin: auto;" /></p>
<p>(Youll learn about map variants that <em>are</em> vectorised over multiple arguments in Sections <a href="functionals.html#map2">9.4.2</a> and <a href="functionals.html#pmap">9.4.5</a>.)</p>
<p>Note theres a subtle difference between placing extra arguments inside an anonymous function compared with passing them to <code>map()</code>. Putting them in an anonymous function means that they will be evaluated every time <code>f()</code> is executed, not just once when you call <code>map()</code>. This is easiest to see if we make the additional argument random:</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb399-1" data-line-number="1">plus &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) x <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb399-2" data-line-number="2"></a>
<a class="sourceLine" id="cb399-3" data-line-number="3">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb399-4" data-line-number="4"><span class="kw">map_dbl</span>(x, plus, <span class="kw">runif</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb399-5" data-line-number="5"><span class="co">#&gt; [1] 0.0625 0.0625 0.0625 0.0625</span></a>
<a class="sourceLine" id="cb399-6" data-line-number="6"><span class="kw">map_dbl</span>(x, <span class="op">~</span><span class="st"> </span><span class="kw">plus</span>(.x, <span class="kw">runif</span>(<span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb399-7" data-line-number="7"><span class="co">#&gt; [1] 0.903 0.132 0.629 0.945</span></a></code></pre></div>
</div>
<div id="argument-names" class="section level3">
<h3><span class="header-section-number">9.2.4</span> Argument names</h3>
<p>In the diagrams, Ive omitted argument names to focus on the overall structure. But I recommend writing out the full names in your code, as it makes it easier to read. <code>map(x, mean, 0.1)</code> is perfectly valid code, but will call <code>mean(x[[1]], 0.1)</code> so it relies on the reader remembering that the second argument to <code>mean()</code> is <code>trim</code>. To avoid unnecessary burden on the brain of the reader<a href="#fn39" class="footnote-ref" id="fnref39"><sup>39</sup></a>, be kind and write <code>map(x, mean, trim = 0.1)</code>.</p>
<p>This is the reason why the arguments to <code>map()</code> are a little odd: instead of being <code>x</code> and <code>f</code>, they are <code>.x</code> and <code>.f</code>. Its easiest to see the problem that leads to these names using <code>simple_map()</code> defined above. <code>simple_map()</code> has arguments <code>x</code> and <code>f</code> so youll have problems whenever the function you are calling has arguments <code>x</code> or <code>f</code>:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb400-1" data-line-number="1">boostrap_summary &lt;-<span class="st"> </span><span class="cf">function</span>(x, f) {</a>
<a class="sourceLine" id="cb400-2" data-line-number="2">  <span class="kw">f</span>(<span class="kw">sample</span>(x, <span class="dt">replace =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb400-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb400-4" data-line-number="4"></a>
<a class="sourceLine" id="cb400-5" data-line-number="5"><span class="kw">simple_map</span>(mtcars, boostrap_summary, <span class="dt">f =</span> mean)</a>
<a class="sourceLine" id="cb400-6" data-line-number="6"><span class="co">#&gt; Error in mean.default(x[[i]], ...): &#39;trim&#39; must be numeric of length one</span></a></code></pre></div>
<!-- GVW: a diagram here showing how the various f's and x's are matched to one another in the example above would be very helpful -->
<p>The error is a little bewildering until you remember that the call to <code>simple_map()</code> is equivalent to <code>simple_map(x = mtcars, f = mean, bootstrap_summary)</code> because named matching beats positional matching.</p>
<p>purrr functions reduce the likelihood of such a clash by using <code>.f</code> and <code>.x</code> instead of the more common <code>f</code> and <code>x</code>. Of course this technique isnt perfect (because the function you are calling might still use <code>.f</code> and <code>.x</code>), but it avoids 99% of issues. The remaining 1% of the time, use an anonymous function.</p>
<div class="base">
<p>Base functions that pass along <code>...</code> use a variety of naming conventions to prevent undesired argument matching:</p>
<ul>
<li><p>The apply family mostly uses capital letters (e.g. <code>X</code> and <code>FUN</code>).</p></li>
<li><p><code>transform()</code> uses the more exotic prefix <code>_</code>: this makes the name non-syntactic
so it must always be surrounded in <code>`</code>, as described in
Section <a href="names-values.html#non-syntactic">2.2.1</a>. This makes undesired matches extremely
unlikely.</p></li>
<li>Other functionals like <code>uniroot()</code> and <code>optim()</code> make no effort to avoid
clashes but they tend to be used with specially created functions so
clashes are less likely.</li>
</ul>
</div>
</div>
<div id="change-argument" class="section level3">
<h3><span class="header-section-number">9.2.5</span> Varying another argument</h3>
<p>So far the first argument to <code>map()</code> has always become the first argument to the function. But what happens if the first argument should be constant, and you want to vary a different argument? How do you get the result in this picture?</p>
<p><img src="diagrams/functionals/map-arg-flipped.png" style="display: block; margin: auto;" /></p>
<p>It turns out that theres no way to do it directly, but there are two tricks you can use instead. To illustrate them, imagine I have a vector that contains a few unusual values, and I want to explore the effect of different amounts of trimming when computing the mean. In this case, the first argument to <code>mean()</code> will be constant, and I want to vary the second argument, <code>trim</code>.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb401-1" data-line-number="1">trims &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb401-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw">rcauchy</span>(<span class="dv">1000</span>)</a></code></pre></div>
<ul>
<li><p>The simplest technique is to use an anonymous function to rearrange the
argument order:</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb402-1" data-line-number="1"><span class="kw">map_dbl</span>(trims, <span class="op">~</span><span class="st"> </span><span class="kw">mean</span>(x, <span class="dt">trim =</span> .x))</a>
<a class="sourceLine" id="cb402-2" data-line-number="2"><span class="co">#&gt; [1] -0.3500  0.0434  0.0354  0.0502</span></a></code></pre></div>
<p>This is still a little confusing because Im using both <code>x</code> and <code>.x</code>.
You can make it a little clearer by abandoning the <code>~</code> helper:</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb403-1" data-line-number="1"><span class="kw">map_dbl</span>(trims, <span class="cf">function</span>(trim) <span class="kw">mean</span>(x, <span class="dt">trim =</span> trim))</a>
<a class="sourceLine" id="cb403-2" data-line-number="2"><span class="co">#&gt; [1] -0.3500  0.0434  0.0354  0.0502</span></a></code></pre></div></li>
<li><p>Sometimes, if you want to be (too) clever, you can take advantage of Rs
flexible argument matching rules (as described in Section
<a href="functions.html#prefix-form">6.8.2</a>). For example, in this example you can rewrite
<code>mean(x, trim = 0.1)</code> as <code>mean(0.1, x = x)</code>, so you could write the
call to <code>map_dbl()</code> as:</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb404-1" data-line-number="1"><span class="kw">map_dbl</span>(trims, mean, <span class="dt">x =</span> x)</a>
<a class="sourceLine" id="cb404-2" data-line-number="2"><span class="co">#&gt; [1] -0.3500  0.0434  0.0354  0.0502</span></a></code></pre></div>
<p>I dont recommend this technique as it relies on the readers familiarity with both the argument order to <code>.f</code>, and Rs
argument matching rules.</p></li>
</ul>
<p>Youll see one more alternative in Section <a href="functionals.html#pmap">9.4.5</a>.</p>
</div>
<div id="exercises" class="section level3">
<h3><span class="header-section-number">9.2.6</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Use <code>as_mapper()</code> to explore how purrr generates anonymous functions for
the integer, character, and list helpers. What helper allows you to
extract attributes? Read the documentation to find out.</p></li>
<li><p><code>map(1:3, ~ runif(2))</code> is a useful pattern for generating random
numbers, but <code>map(1:3, runif(2))</code> is not. Why not? Can you explain why
it returns the result that it does?</p></li>
<li><p>Use the appropriate <code>map()</code> function to:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Compute the standard deviation of every column in a numeric data frame.</p></li>
<li><p>Compute the standard deviation of every numeric column in a mixed data
frame. (Hint: youll need to do it in two steps.)</p></li>
<li><p>Compute the number of levels for every factor in a data frame.</p></li>
</ol></li>
<li><p>The following code simulates the performance of a t-test for non-normal
data. Extract the p-value from each test, then visualise.</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb405-1" data-line-number="1">trials &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="op">~</span><span class="st"> </span><span class="kw">t.test</span>(<span class="kw">rpois</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="kw">rpois</span>(<span class="dv">7</span>, <span class="dv">10</span>)))</a></code></pre></div></li>
<li><p>The following code uses a map nested inside another map to apply a
function to every element of a nested list. Why does it fail, and
what do you need to do to make it work?</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb406-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb406-2" data-line-number="2">  <span class="kw">list</span>(<span class="dv">1</span>, <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">9</span>)),</a>
<a class="sourceLine" id="cb406-3" data-line-number="3">  <span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">6</span>), <span class="dv">7</span>, <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">6</span>))</a>
<a class="sourceLine" id="cb406-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb406-5" data-line-number="5"></a>
<a class="sourceLine" id="cb406-6" data-line-number="6">triple &lt;-<span class="st"> </span><span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb406-7" data-line-number="7"><span class="kw">map</span>(x, map, <span class="dt">.f =</span> triple)</a>
<a class="sourceLine" id="cb406-8" data-line-number="8"><span class="co">#&gt; Error in .f(.x[[i]], ...): unused argument (map)</span></a></code></pre></div></li>
<li><p>Use <code>map()</code> to fit linear models to the <code>mtcars</code> dataset using the formulas
stored in this list:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb407-1" data-line-number="1">formulas &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb407-2" data-line-number="2">  mpg <span class="op">~</span><span class="st"> </span>disp,</a>
<a class="sourceLine" id="cb407-3" data-line-number="3">  mpg <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>disp),</a>
<a class="sourceLine" id="cb407-4" data-line-number="4">  mpg <span class="op">~</span><span class="st"> </span>disp <span class="op">+</span><span class="st"> </span>wt,</a>
<a class="sourceLine" id="cb407-5" data-line-number="5">  mpg <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>disp) <span class="op">+</span><span class="st"> </span>wt</a>
<a class="sourceLine" id="cb407-6" data-line-number="6">)</a></code></pre></div></li>
<li><p>Fit the model <code>mpg ~ disp</code> to each of the bootstrap replicates of <code>mtcars</code>
in the list below, then extract the <span class="math inline">\(R^2\)</span> of the model fit (Hint: you can
compute the <span class="math inline">\(R^2\)</span> with <code>summary()</code>.)</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb408-1" data-line-number="1">bootstrap &lt;-<span class="st"> </span><span class="cf">function</span>(df) {</a>
<a class="sourceLine" id="cb408-2" data-line-number="2">  df[<span class="kw">sample</span>(<span class="kw">nrow</span>(df), <span class="dt">replace =</span> <span class="ot">TRUE</span>), , drop =<span class="st"> </span><span class="ot">FALSE</span>]</a>
<a class="sourceLine" id="cb408-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb408-4" data-line-number="4"></a>
<a class="sourceLine" id="cb408-5" data-line-number="5">bootstraps &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="op">~</span><span class="st"> </span><span class="kw">bootstrap</span>(mtcars))</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="purrr-style" class="section level2">
<h2><span class="header-section-number">9.3</span> Purrr style</h2>

<p>Before we go on to explore more map variants, lets take a quick look at how you tend to use multiple purrr functions to solve a moderately realistic problem: fitting a model to each subgroup and extracting a coefficient of the model. For this toy example, Im going to break the <code>mtcars</code> data set down into groups defined by the number of cylinders, using the base <code>split</code> function:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb409-1" data-line-number="1">by_cyl &lt;-<span class="st"> </span><span class="kw">split</span>(mtcars, mtcars<span class="op">$</span>cyl)</a></code></pre></div>
<p>This creates a list of three data frames: the cars with 4, 6, and 8 cylinders respectively.</p>
<p>Now imagine we want to fit a linear model, then extract the second coefficient (i.e.the slope). The following code shows how you might do that with purrr:</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb410-1" data-line-number="1">by_cyl <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb410-2" data-line-number="2"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> .x)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb410-3" data-line-number="3"><span class="st">  </span><span class="kw">map</span>(coef) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb410-4" data-line-number="4"><span class="st">  </span><span class="kw">map_dbl</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb410-5" data-line-number="5"><span class="co">#&gt;     4     6     8 </span></a>
<a class="sourceLine" id="cb410-6" data-line-number="6"><span class="co">#&gt; -5.65 -2.78 -2.19</span></a></code></pre></div>
<p>(If you havent seen <code>%&gt;%</code>, the pipe, before, its described in Section <a href="functions.html#function-composition">6.3</a>.)</p>
<p>I think this code is easy to read because each line encapsulates a single step, you can easily distinguish the functional from what it does, and the purrr helpers allow us to very concisely describe what to do in each step.</p>
<p>How would you attack this problem with base R? You certainly <em>could</em> replace each purrr function with the equivalent base function:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb411-1" data-line-number="1">by_cyl <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb411-2" data-line-number="2"><span class="st">  </span><span class="kw">lapply</span>(<span class="cf">function</span>(data) <span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> data)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb411-3" data-line-number="3"><span class="st">  </span><span class="kw">lapply</span>(coef) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb411-4" data-line-number="4"><span class="st">  </span><span class="kw">vapply</span>(<span class="cf">function</span>(x) x[[<span class="dv">2</span>]], <span class="kw">double</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb411-5" data-line-number="5"><span class="co">#&gt;     4     6     8 </span></a>
<a class="sourceLine" id="cb411-6" data-line-number="6"><span class="co">#&gt; -5.65 -2.78 -2.19</span></a></code></pre></div>
<p>But this isnt really base R since were using the pipe. To tackle purely in base I think youd use an intermediate variable, and do more in each step:</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb412-1" data-line-number="1">models &lt;-<span class="st"> </span><span class="kw">lapply</span>(by_cyl, <span class="cf">function</span>(data) <span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> data))</a>
<a class="sourceLine" id="cb412-2" data-line-number="2"><span class="kw">vapply</span>(models, <span class="cf">function</span>(x) <span class="kw">coef</span>(x)[[<span class="dv">2</span>]], <span class="kw">double</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb412-3" data-line-number="3"><span class="co">#&gt;     4     6     8 </span></a>
<a class="sourceLine" id="cb412-4" data-line-number="4"><span class="co">#&gt; -5.65 -2.78 -2.19</span></a></code></pre></div>
<p>Or, of course, you could use a for loop:</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb413-1" data-line-number="1">intercepts &lt;-<span class="st"> </span><span class="kw">double</span>(<span class="kw">length</span>(by_cyl))</a>
<a class="sourceLine" id="cb413-2" data-line-number="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(by_cyl)) {</a>
<a class="sourceLine" id="cb413-3" data-line-number="3">  model &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> by_cyl[[i]])</a>
<a class="sourceLine" id="cb413-4" data-line-number="4">  intercepts[[i]] &lt;-<span class="st"> </span><span class="kw">coef</span>(model)[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb413-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb413-6" data-line-number="6">intercepts</a>
<a class="sourceLine" id="cb413-7" data-line-number="7"><span class="co">#&gt; [1] -5.65 -2.78 -2.19</span></a></code></pre></div>
<p>Its interesting to note that as you move from purrr to base apply functions to for loops you tend to do more and more in each iteration. In purrr we iterate 3 times (<code>map()</code>, <code>map()</code>, <code>map_dbl()</code>), with apply functions we iterate twice (<code>lapply()</code>, <code>vapply()</code>), and with a for loop we iterate once. I prefer more, but simpler, steps because I think it makes the code easier to understand and later modify.</p>
</div>
<div id="map-variants" class="section level2">
<h2><span class="header-section-number">9.4</span> Map variants</h2>
<p>There are 23 primary variants of <code>map()</code>. So far, youve learned about five (<code>map()</code>, <code>map_lgl()</code>, <code>map_int()</code>, <code>map_dbl()</code> and <code>map_chr()</code>). That means that youve got 18 (!!) more to learn. That sounds like a lot, but fortunately the design of purrr means that you only need to learn five new ideas:</p>
<ul>
<li>Output same type as input with <code>modify()</code></li>
<li>Iterate over two inputs with <code>map2()</code>.</li>
<li>Iterate with an index using <code>imap()</code></li>
<li>Return nothing with <code>walk()</code>.</li>
<li>Iterate over any number of inputs with <code>pmap()</code>.</li>
</ul>
<p>The map family of functions has orthogonal input and outputs, meaning that we can organise all the family into a matrix, with inputs in the rows and outputs in the columns. Once youve mastered the idea in a row, you can combine it with any column; once youve mastered the idea in a column, you can combine it with any row. That relationship is summarised in the following table:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>List</th>
<th>Atomic</th>
<th>Same type</th>
<th>Nothing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>One argument</td>
<td><code>map()</code></td>
<td><code>map_lgl()</code>, </td>
<td><code>modify()</code></td>
<td><code>walk()</code></td>
</tr>
<tr class="even">
<td>Two arguments</td>
<td><code>map2()</code></td>
<td><code>map2_lgl()</code>, </td>
<td><code>modify2()</code></td>
<td><code>walk2()</code></td>
</tr>
<tr class="odd">
<td>One argument + index</td>
<td><code>imap()</code></td>
<td><code>imap_lgl()</code>, </td>
<td><code>imodify()</code></td>
<td><code>iwalk()</code></td>
</tr>
<tr class="even">
<td>N arguments</td>
<td><code>pmap()</code></td>
<td><code>pmap_lgl()</code>, </td>
<td></td>
<td><code>pwalk()</code></td>
</tr>
</tbody>
</table>
<div id="modify" class="section level3">
<h3><span class="header-section-number">9.4.1</span> Same type of output as input: <code>modify()</code></h3>

<p>Imagine you wanted to double every column in a data frame. You might first try using <code>map()</code>, but <code>map()</code> always returns a list:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb414-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb414-2" data-line-number="2">  <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb414-3" data-line-number="3">  <span class="dt">y =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb414-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb414-5" data-line-number="5"></a>
<a class="sourceLine" id="cb414-6" data-line-number="6"><span class="kw">map</span>(df, <span class="op">~</span><span class="st"> </span>.x <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb414-7" data-line-number="7"><span class="co">#&gt; $x</span></a>
<a class="sourceLine" id="cb414-8" data-line-number="8"><span class="co">#&gt; [1] 2 4 6</span></a>
<a class="sourceLine" id="cb414-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb414-10" data-line-number="10"><span class="co">#&gt; $y</span></a>
<a class="sourceLine" id="cb414-11" data-line-number="11"><span class="co">#&gt; [1] 12 10  8</span></a></code></pre></div>
<p>If you want to keep the output as a data frame, you can use <code>modify()</code>, which always returns the same type of output as the input:</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb415-1" data-line-number="1"><span class="kw">modify</span>(df, <span class="op">~</span><span class="st"> </span>.x <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb415-2" data-line-number="2"><span class="co">#&gt;   x  y</span></a>
<a class="sourceLine" id="cb415-3" data-line-number="3"><span class="co">#&gt; 1 2 12</span></a>
<a class="sourceLine" id="cb415-4" data-line-number="4"><span class="co">#&gt; 2 4 10</span></a>
<a class="sourceLine" id="cb415-5" data-line-number="5"><span class="co">#&gt; 3 6  8</span></a></code></pre></div>
<p>Despite the name, <code>modify()</code> doesnt modify in place, it returns a modified copy, so if you wanted to permanently modify <code>df</code>, youd need to assign it:</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb416-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">modify</span>(df, <span class="op">~</span><span class="st"> </span>.x <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<p>As usual, the basic implementation of <code>modify()</code> is simple, and in fact its even simpler than <code>map()</code> because we dont need to create a new output vector; we can just progressively replace the input. (The real code is a little complex to handle edge cases more gracefully.)</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb417-1" data-line-number="1">simple_modify &lt;-<span class="st"> </span><span class="cf">function</span>(x, f, ...) {</a>
<a class="sourceLine" id="cb417-2" data-line-number="2">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {</a>
<a class="sourceLine" id="cb417-3" data-line-number="3">    x[[i]] &lt;-<span class="st"> </span><span class="kw">f</span>(x[[i]], ...)</a>
<a class="sourceLine" id="cb417-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb417-5" data-line-number="5">  x</a>
<a class="sourceLine" id="cb417-6" data-line-number="6">}</a></code></pre></div>
<p>In Section <a href="functionals.html#predicate-map">9.6.2</a> youll learn about a very useful variant of <code>modify()</code>, called <code>modify_if()</code>. This allows you to (e.g.) only double <em>numeric</em> columns of a data frame with <code>modify_if(df, is.numeric, ~ .x * 2)</code>.</p>
</div>
<div id="map2" class="section level3">
<h3><span class="header-section-number">9.4.2</span> Two inputs: <code>map2()</code> and friends</h3>

<p><code>map()</code> is vectorised over a single argument, <code>.x</code>. This means it only varies <code>.x</code> when calling <code>.f</code>, and all other arguments are passed along unchanged, thus making it poorly suited for some problems. For example, how would you find a weighted mean when you have a list of observations and a list of weights? Imagine we have the following data:</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb418-1" data-line-number="1">xs &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="op">~</span><span class="st"> </span><span class="kw">runif</span>(<span class="dv">10</span>))</a>
<a class="sourceLine" id="cb418-2" data-line-number="2">xs[[<span class="dv">1</span>]][[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb418-3" data-line-number="3">ws &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="op">~</span><span class="st"> </span><span class="kw">rpois</span>(<span class="dv">10</span>, <span class="dv">5</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<p>You can use <code>map_dbl()</code> to compute the unweighted means:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb419-1" data-line-number="1"><span class="kw">map_dbl</span>(xs, mean)</a>
<a class="sourceLine" id="cb419-2" data-line-number="2"><span class="co">#&gt; [1]    NA 0.463 0.551 0.453 0.564 0.501 0.371 0.443</span></a></code></pre></div>
<p>But passing <code>ws</code> as an additional argument doesnt work because arguments after <code>.f</code> are not transformed:</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb420-1" data-line-number="1"><span class="kw">map_dbl</span>(xs, weighted.mean, <span class="dt">w =</span> ws)</a>
<a class="sourceLine" id="cb420-2" data-line-number="2"><span class="co">#&gt; Error in weighted.mean.default(.x[[i]], ...): &#39;x&#39; and &#39;w&#39; must have the same</span></a>
<a class="sourceLine" id="cb420-3" data-line-number="3"><span class="co">#&gt; length</span></a></code></pre></div>
<p><img src="diagrams/functionals/map-arg-recycle.png" style="display: block; margin: auto;" /></p>
<p>We need a new tool: a <code>map2()</code>, which is vectorised over two arguments. This means both <code>.x</code> and <code>.y</code> are varied in each call to <code>.f</code>:</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb421-1" data-line-number="1"><span class="kw">map2_dbl</span>(xs, ws, weighted.mean)</a>
<a class="sourceLine" id="cb421-2" data-line-number="2"><span class="co">#&gt; [1]    NA 0.451 0.603 0.452 0.563 0.510 0.342 0.464</span></a></code></pre></div>
<p><img src="diagrams/functionals/map2.png" style="display: block; margin: auto;" /></p>
<p>The arguments to <code>map2()</code> are slightly different to the arguments to <code>map()</code> as two vectors come before the function, rather than one. Additional arguments still go afterwards:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb422-1" data-line-number="1"><span class="kw">map2_dbl</span>(xs, ws, weighted.mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb422-2" data-line-number="2"><span class="co">#&gt; [1] 0.504 0.451 0.603 0.452 0.563 0.510 0.342 0.464</span></a></code></pre></div>
<p><img src="diagrams/functionals/map2-arg.png" style="display: block; margin: auto;" /></p>
<p>The basic implementation of <code>map2()</code> is simple, and quite similar to that of <code>map()</code>. Instead of iterating over one vector, we iterate over two in parallel:</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb423-1" data-line-number="1">simple_map2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, f, ...) {</a>
<a class="sourceLine" id="cb423-2" data-line-number="2">  out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb423-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {</a>
<a class="sourceLine" id="cb423-4" data-line-number="4">    out[[i]] &lt;-<span class="st"> </span><span class="kw">f</span>(x[[i]], y[[i]], ...)</a>
<a class="sourceLine" id="cb423-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb423-6" data-line-number="6">  out</a>
<a class="sourceLine" id="cb423-7" data-line-number="7">}</a></code></pre></div>
<p>One of the big differences between <code>map2()</code> and the simple function above is that <code>map2()</code> recycles its inputs to make sure that theyre the same length:</p>
<p><img src="diagrams/functionals/map2-recycle.png" style="display: block; margin: auto;" /></p>
<p>In other words, <code>map2(x, y, f)</code> will automatically behave like <code>map(x, f, y)</code> when needed. This is helpful when writing functions; in scripts youd generally just use the simpler form directly.</p>
<div class="base">
<p>The closest base equivalent to <code>map2()</code> is <code>Map()</code>, which is discussed in Section <a href="functionals.html#pmap">9.4.5</a>.</p>
</div>
</div>
<div id="no-outputs-walk-and-friends" class="section level3">
<h3><span class="header-section-number">9.4.3</span> No outputs: <code>walk()</code> and friends</h3>

<p>Most functions are called for the value that they return, so it makes sense to capture and store the value with a <code>map()</code> function. But some functions are called primarily for their side-effects (e.g. <code>cat()</code>, <code>write.csv()</code>, or <code>ggsave()</code>) and it doesnt make sense to capture their results. Take this simple example that displays a welcome message using <code>cat()</code>. <code>cat()</code> returns <code>NULL</code>, so while <code>map()</code> works (in the sense that it generates the desired welcomes), it also returns <code>list(NULL, NULL)</code>.</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb424-1" data-line-number="1">welcome &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb424-2" data-line-number="2">  <span class="kw">cat</span>(<span class="st">&quot;Welcome &quot;</span>, x, <span class="st">&quot;!</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb424-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb424-4" data-line-number="4">names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Hadley&quot;</span>, <span class="st">&quot;Jenny&quot;</span>)</a>
<a class="sourceLine" id="cb424-5" data-line-number="5"></a>
<a class="sourceLine" id="cb424-6" data-line-number="6"><span class="co"># As well as generate the welcomes, it also shows </span></a>
<a class="sourceLine" id="cb424-7" data-line-number="7"><span class="co"># the return value of cat()</span></a>
<a class="sourceLine" id="cb424-8" data-line-number="8"><span class="kw">map</span>(names, welcome)</a>
<a class="sourceLine" id="cb424-9" data-line-number="9"><span class="co">#&gt; Welcome Hadley!</span></a>
<a class="sourceLine" id="cb424-10" data-line-number="10"><span class="co">#&gt; Welcome Jenny!</span></a>
<a class="sourceLine" id="cb424-11" data-line-number="11"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb424-12" data-line-number="12"><span class="co">#&gt; NULL</span></a>
<a class="sourceLine" id="cb424-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb424-14" data-line-number="14"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb424-15" data-line-number="15"><span class="co">#&gt; NULL</span></a></code></pre></div>
<p>You could avoid this problem by assigning the results of <code>map()</code> to a variable that you never use, but that would muddy the intent of the code. Instead, purrr provides the walk family of functions that ignore the return values of the <code>.f</code> and instead return <code>.x</code> invisibly<a href="#fn40" class="footnote-ref" id="fnref40"><sup>40</sup></a>.</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb425-1" data-line-number="1"><span class="kw">walk</span>(names, welcome)</a>
<a class="sourceLine" id="cb425-2" data-line-number="2"><span class="co">#&gt; Welcome Hadley!</span></a>
<a class="sourceLine" id="cb425-3" data-line-number="3"><span class="co">#&gt; Welcome Jenny!</span></a></code></pre></div>
<p>My visual depiction of walk attempts to capture the important difference from <code>map()</code>: the outputs are ephemeral, and the input is returned invisibly.</p>
<p><img src="diagrams/functionals/walk.png" style="display: block; margin: auto;" /></p>
<p>One of the most useful <code>walk()</code> variants is <code>walk2()</code> because a very common side-effect is saving something to disk, and when saving something to disk you always have a pair of values: the object and the path that you want to save it to.</p>
<p><img src="diagrams/functionals/walk2.png" style="display: block; margin: auto;" /></p>
<p>For example, imagine you have a list of data frames (which Ive created here using <code>split()</code>), and youd like to save each one to a separate CSV file. Thats easy with <code>walk2()</code>:</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb426-1" data-line-number="1">temp &lt;-<span class="st"> </span><span class="kw">tempfile</span>()</a>
<a class="sourceLine" id="cb426-2" data-line-number="2"><span class="kw">dir.create</span>(temp)</a>
<a class="sourceLine" id="cb426-3" data-line-number="3"></a>
<a class="sourceLine" id="cb426-4" data-line-number="4">cyls &lt;-<span class="st"> </span><span class="kw">split</span>(mtcars, mtcars<span class="op">$</span>cyl)</a>
<a class="sourceLine" id="cb426-5" data-line-number="5">paths &lt;-<span class="st"> </span><span class="kw">file.path</span>(temp, <span class="kw">paste0</span>(<span class="st">&quot;cyl-&quot;</span>, <span class="kw">names</span>(cyls), <span class="st">&quot;.csv&quot;</span>))</a>
<a class="sourceLine" id="cb426-6" data-line-number="6"><span class="kw">walk2</span>(cyls, paths, write.csv)</a>
<a class="sourceLine" id="cb426-7" data-line-number="7"></a>
<a class="sourceLine" id="cb426-8" data-line-number="8"><span class="kw">dir</span>(temp)</a>
<a class="sourceLine" id="cb426-9" data-line-number="9"><span class="co">#&gt; [1] &quot;cyl-4.csv&quot; &quot;cyl-6.csv&quot; &quot;cyl-8.csv&quot;</span></a></code></pre></div>
<p>Here the <code>walk2()</code> is equivalent to <code>write.csv(cyls[[1]], paths[[1]])</code>, <code>write.csv(cyls[[2]], paths[[2]])</code>, <code>write.csv(cyls[[3]], paths[[3]])</code>.</p>
<div class="base">
<p>There is no base equivalent to <code>walk()</code>; either wrap the result of <code>lapply()</code> in <code>invisible()</code> or save it to a variable that is never used.</p>
</div>
</div>
<div id="iterating-over-values-and-indices" class="section level3">
<h3><span class="header-section-number">9.4.4</span> Iterating over values and indices</h3>

<p></p>
<p>There are three basic ways to loop over a vector with a for loop:</p>
<ul>
<li>Loop over the elements: <code>for (x in xs)</code></li>
<li>Loop over the numeric indices: <code>for (i in seq_along(xs))</code></li>
<li>Loop over the names: <code>for (nm in names(xs))</code></li>
</ul>
<p>The first form is analogous to the <code>map()</code> family. The second and third forms are equivalent to the <code>imap()</code> family which allows you to iterate over the values and the indices of a vector in parallel.</p>
<p><code>imap()</code> is like <code>map2()</code> in the sense that your <code>.f</code> gets called with two arguments, but here both are derived from the vector. <code>imap(x, f)</code> is equivalent to <code>map2(x, names(x), f)</code> if x has names, and <code>map2(x, seq_along(x), f)</code> if it does not.</p>
<p><code>imap()</code> is often useful for constructing labels:</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb427-1" data-line-number="1"><span class="kw">imap_chr</span>(iris, <span class="op">~</span><span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;The first value of &quot;</span>, .y, <span class="st">&quot; is &quot;</span>, .x[[<span class="dv">1</span>]]))</a>
<a class="sourceLine" id="cb427-2" data-line-number="2"><span class="co">#&gt;                             Sepal.Length </span></a>
<a class="sourceLine" id="cb427-3" data-line-number="3"><span class="co">#&gt; &quot;The first value of Sepal.Length is 5.1&quot; </span></a>
<a class="sourceLine" id="cb427-4" data-line-number="4"><span class="co">#&gt;                              Sepal.Width </span></a>
<a class="sourceLine" id="cb427-5" data-line-number="5"><span class="co">#&gt;  &quot;The first value of Sepal.Width is 3.5&quot; </span></a>
<a class="sourceLine" id="cb427-6" data-line-number="6"><span class="co">#&gt;                             Petal.Length </span></a>
<a class="sourceLine" id="cb427-7" data-line-number="7"><span class="co">#&gt; &quot;The first value of Petal.Length is 1.4&quot; </span></a>
<a class="sourceLine" id="cb427-8" data-line-number="8"><span class="co">#&gt;                              Petal.Width </span></a>
<a class="sourceLine" id="cb427-9" data-line-number="9"><span class="co">#&gt;  &quot;The first value of Petal.Width is 0.2&quot; </span></a>
<a class="sourceLine" id="cb427-10" data-line-number="10"><span class="co">#&gt;                                  Species </span></a>
<a class="sourceLine" id="cb427-11" data-line-number="11"><span class="co">#&gt;   &quot;The first value of Species is setosa&quot;</span></a></code></pre></div>
<p>If the vector is unnamed, the second argument will be the index:</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb428-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="op">~</span><span class="st"> </span><span class="kw">sample</span>(<span class="dv">1000</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb428-2" data-line-number="2"><span class="kw">imap_chr</span>(x, <span class="op">~</span><span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;The highest value of &quot;</span>, .y, <span class="st">&quot; is &quot;</span>, <span class="kw">max</span>(.x)))</a>
<a class="sourceLine" id="cb428-3" data-line-number="3"><span class="co">#&gt; [1] &quot;The highest value of 1 is 975&quot; &quot;The highest value of 2 is 915&quot;</span></a>
<a class="sourceLine" id="cb428-4" data-line-number="4"><span class="co">#&gt; [3] &quot;The highest value of 3 is 982&quot; &quot;The highest value of 4 is 955&quot;</span></a>
<a class="sourceLine" id="cb428-5" data-line-number="5"><span class="co">#&gt; [5] &quot;The highest value of 5 is 971&quot; &quot;The highest value of 6 is 696&quot;</span></a></code></pre></div>
<p><code>imap()</code> is a useful helper if you want to work with the values in a vector along with their positions.</p>
</div>
<div id="pmap" class="section level3">
<h3><span class="header-section-number">9.4.5</span> Any number of inputs: <code>pmap()</code> and friends</h3>

<p>Since we have <code>map()</code> and <code>map2()</code>, you might expect <code>map3()</code>, <code>map4()</code>, <code>map5()</code>,  But where would you stop? Instead of generalising <code>map2()</code> to an arbitrary number of arguments, purrr takes a slightly different tack with <code>pmap()</code>: you supply it a single list, which contains any number of arguments. In most cases, that will be a list of equal-length vectors, i.e.something very similar to a data frame. In diagrams, Ill emphasise that relationship by drawing the input similar to a data frame.</p>
<p><img src="diagrams/functionals/pmap.png" style="display: block; margin: auto;" /></p>
<p>Theres a simple equivalence between <code>map2()</code> and <code>pmap()</code>: <code>map2(x, y, f)</code> is the same as <code>pmap(list(x, y), f)</code>. The <code>pmap()</code> equivalent to the <code>map2_dbl(xs, ws, weighted.mean)</code> used above is:</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb429-1" data-line-number="1"><span class="kw">pmap_dbl</span>(<span class="kw">list</span>(xs, ws), weighted.mean)</a>
<a class="sourceLine" id="cb429-2" data-line-number="2"><span class="co">#&gt; [1]    NA 0.451 0.603 0.452 0.563 0.510 0.342 0.464</span></a></code></pre></div>
<p>As before, the varying arguments come before <code>.f</code> (although now they must be wrapped in a list), and the constant arguments come afterwards.</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb430-1" data-line-number="1"><span class="kw">pmap_dbl</span>(<span class="kw">list</span>(xs, ws), weighted.mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb430-2" data-line-number="2"><span class="co">#&gt; [1] 0.504 0.451 0.603 0.452 0.563 0.510 0.342 0.464</span></a></code></pre></div>
<p><img src="diagrams/functionals/pmap-arg.png" style="display: block; margin: auto;" /></p>
<p>A big difference between <code>pmap()</code> and the other map functions is that <code>pmap()</code> gives you much finer control over argument matching because you can name the components of the list. Returning to our example from Section <a href="functionals.html#change-argument">9.2.5</a>, where we wanted to vary the <code>trim</code> argument to <code>x</code>, we could instead use <code>pmap()</code>:</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb431-1" data-line-number="1">trims &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb431-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw">rcauchy</span>(<span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb431-3" data-line-number="3"></a>
<a class="sourceLine" id="cb431-4" data-line-number="4"><span class="kw">pmap_dbl</span>(<span class="kw">list</span>(<span class="dt">trim =</span> trims), mean, <span class="dt">x =</span> x)</a>
<a class="sourceLine" id="cb431-5" data-line-number="5"><span class="co">#&gt; [1] -6.6740  0.0210  0.0235  0.0151</span></a></code></pre></div>
<p>I think its good practice to name the components of the list to make it very clear how the function will be called.</p>
<p>Its often convenient to call <code>pmap()</code> with a data frame. A handy way to create that data frame is with <code>tibble::tribble()</code>, which allows you to describe a data frame row-by-row (rather than column-by-column, as usual): thinking about the parameters to a function as a data frame is a very powerful pattern. The following example shows how you might draw random uniform numbers with varying parameters:</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb432-1" data-line-number="1">params &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb432-2" data-line-number="2">  <span class="op">~</span><span class="st"> </span>n, <span class="op">~</span><span class="st"> </span>min, <span class="op">~</span><span class="st"> </span>max,</a>
<a class="sourceLine" id="cb432-3" data-line-number="3">   1L,     <span class="dv">0</span>,     <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb432-4" data-line-number="4">   2L,    <span class="dv">10</span>,   <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb432-5" data-line-number="5">   3L,   <span class="dv">100</span>,  <span class="dv">1000</span></a>
<a class="sourceLine" id="cb432-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb432-7" data-line-number="7"></a>
<a class="sourceLine" id="cb432-8" data-line-number="8"><span class="kw">pmap</span>(params, runif)</a>
<a class="sourceLine" id="cb432-9" data-line-number="9"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb432-10" data-line-number="10"><span class="co">#&gt; [1] 0.332</span></a>
<a class="sourceLine" id="cb432-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb432-12" data-line-number="12"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb432-13" data-line-number="13"><span class="co">#&gt; [1] 53.5 47.6</span></a>
<a class="sourceLine" id="cb432-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb432-15" data-line-number="15"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb432-16" data-line-number="16"><span class="co">#&gt; [1] 231 715 515</span></a></code></pre></div>
<p><img src="diagrams/functionals/pmap-3.png" style="display: block; margin: auto;" />
Here, the column names are critical: Ive carefully chosen to match them to the arguments to <code>runif()</code>, so the <code>pmap(params, runif)</code> is equivalent to <code>runif(n = 1L, min = 0, max = 1)</code>, <code>runif(n = 2, min = 10, max = 100)</code>, <code>runif(n = 3L, min = 100, max = 1000)</code>. (If you have a data frame in hand, and the names dont match, use <code>dplyr::rename()</code> or similar.)</p>
<div class="base">
<p>There are two base equivalents to the <code>pmap()</code> family: <code>Map()</code> and <code>mapply()</code>. Both have significant drawbacks:</p>
<ul>
<li><p><code>Map()</code> vectorises over all arguments so you cannot supply arguments that
do not vary.</p></li>
<li><p><code>mapply()</code> is the multidimensional version of <code>sapply()</code>; conceptually it
takes the output of <code>Map()</code> and simplifies it if possible. This gives it
similar issues to <code>sapply()</code>. There is no multi-input equivalent of
<code>vapply()</code>.</p></li>
</ul>
</div>
</div>
<div id="exercises-1" class="section level3">
<h3><span class="header-section-number">9.4.6</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Explain the results of <code>modify(mtcars, 1)</code>.</p></li>
<li><p>Rewrite the following code to use <code>iwalk()</code> instead of <code>walk2()</code>. What
are the advantages and disadvantages?</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb433-1" data-line-number="1">cyls &lt;-<span class="st"> </span><span class="kw">split</span>(mtcars, mtcars<span class="op">$</span>cyl)</a>
<a class="sourceLine" id="cb433-2" data-line-number="2">paths &lt;-<span class="st"> </span><span class="kw">file.path</span>(temp, <span class="kw">paste0</span>(<span class="st">&quot;cyl-&quot;</span>, <span class="kw">names</span>(cyls), <span class="st">&quot;.csv&quot;</span>))</a>
<a class="sourceLine" id="cb433-3" data-line-number="3"><span class="kw">walk2</span>(cyls, paths, write.csv)</a></code></pre></div></li>
<li><p>Explain how the following code transforms a data frame using functions
stored in a list.</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb434-1" data-line-number="1">trans &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb434-2" data-line-number="2">  <span class="dt">disp =</span> <span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span><span class="fl">0.0163871</span>,</a>
<a class="sourceLine" id="cb434-3" data-line-number="3">  <span class="dt">am =</span> <span class="cf">function</span>(x) <span class="kw">factor</span>(x, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;auto&quot;</span>, <span class="st">&quot;manual&quot;</span>))</a>
<a class="sourceLine" id="cb434-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb434-5" data-line-number="5"></a>
<a class="sourceLine" id="cb434-6" data-line-number="6">nm &lt;-<span class="st"> </span><span class="kw">names</span>(trans)</a>
<a class="sourceLine" id="cb434-7" data-line-number="7">mtcars[nm] &lt;-<span class="st"> </span><span class="kw">map2</span>(trans, mtcars[nm], <span class="cf">function</span>(f, var) <span class="kw">f</span>(var))</a></code></pre></div>
<p>Compare and contrast the <code>map2()</code> approach to this <code>map()</code> approach:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb435-1" data-line-number="1">mtcars[vars] &lt;-<span class="st"> </span><span class="kw">map</span>(vars, <span class="op">~</span><span class="st"> </span>trans[[.x]](mtcars[[.x]]))</a></code></pre></div></li>
<li><p>What does <code>write.csv()</code> return? i.e.what happens if you use it with
<code>map2()</code> instead of <code>walk2()</code>?</p></li>
</ol>
</div>
</div>
<div id="reduce" class="section level2">
<h2><span class="header-section-number">9.5</span> Reduce family</h2>
<p>After the map family, the next most important family of functions is the reduce family. This family is much smaller, with only two main variants, and is used less commonly, but its a powerful idea, gives us the opportunity to discuss some useful algebra, and powers the map-reduce framework frequently used for processing very large datasets.</p>
<div id="basics" class="section level3">
<h3><span class="header-section-number">9.5.1</span> Basics</h3>

<p></p>
<p><code>reduce()</code> takes a vector of length <em>n</em> and produces a vector of length 1 by calling a function with a pair of values at a time: <code>reduce(1:4, f)</code> is equivalent to <code>f(f(f(1, 2), 3), 4)</code>.</p>
<p><img src="diagrams/functionals/reduce.png" style="display: block; margin: auto;" /></p>
<p><code>reduce()</code> is a useful way to generalise a function that works with two inputs (a <strong>binary</strong> function) to work with any number of inputs. Imagine you have a list of numeric vectors, and you want to find the values that occur in every element. First we generate some sample data:</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb436-1" data-line-number="1">l &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="op">~</span><span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">15</span>, <span class="dt">replace =</span> T))</a>
<a class="sourceLine" id="cb436-2" data-line-number="2"><span class="kw">str</span>(l)</a>
<a class="sourceLine" id="cb436-3" data-line-number="3"><span class="co">#&gt; List of 4</span></a>
<a class="sourceLine" id="cb436-4" data-line-number="4"><span class="co">#&gt;  $ : int [1:15] 7 1 8 8 3 8 2 4 7 10 ...</span></a>
<a class="sourceLine" id="cb436-5" data-line-number="5"><span class="co">#&gt;  $ : int [1:15] 3 1 10 2 5 2 9 8 5 4 ...</span></a>
<a class="sourceLine" id="cb436-6" data-line-number="6"><span class="co">#&gt;  $ : int [1:15] 6 10 9 5 6 7 8 6 10 8 ...</span></a>
<a class="sourceLine" id="cb436-7" data-line-number="7"><span class="co">#&gt;  $ : int [1:15] 9 8 6 4 4 5 2 9 9 6 ...</span></a></code></pre></div>
<p>To solve this challenge we need to use <code>intersect()</code> repeatedly:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb437-1" data-line-number="1">out &lt;-<span class="st"> </span>l[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb437-2" data-line-number="2">out &lt;-<span class="st"> </span><span class="kw">intersect</span>(out, l[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb437-3" data-line-number="3">out &lt;-<span class="st"> </span><span class="kw">intersect</span>(out, l[[<span class="dv">3</span>]])</a>
<a class="sourceLine" id="cb437-4" data-line-number="4">out &lt;-<span class="st"> </span><span class="kw">intersect</span>(out, l[[<span class="dv">4</span>]])</a>
<a class="sourceLine" id="cb437-5" data-line-number="5">out</a>
<a class="sourceLine" id="cb437-6" data-line-number="6"><span class="co">#&gt; [1] 8 4</span></a></code></pre></div>
<p><code>reduce()</code> automates this solution for us, so we can write:</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb438-1" data-line-number="1"><span class="kw">reduce</span>(l, intersect)</a>
<a class="sourceLine" id="cb438-2" data-line-number="2"><span class="co">#&gt; [1] 8 4</span></a></code></pre></div>
<p>We could apply the same idea if we wanted to list all the elements that appear in at least one entry. All we have to do is switch from <code>intersect()</code> to <code>union()</code>:</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb439-1" data-line-number="1"><span class="kw">reduce</span>(l, union)</a>
<a class="sourceLine" id="cb439-2" data-line-number="2"><span class="co">#&gt;  [1]  7  1  8  3  2  4 10  5  9  6</span></a></code></pre></div>
<p>Like the map family, you can also pass additional arguments. <code>intersect()</code> and <code>union()</code> dont take extra arguments so I cant demonstrate them here, but the principle is straightforward and I drew you a picture.</p>
<p><img src="diagrams/functionals/reduce-arg.png" style="display: block; margin: auto;" /></p>
<p>As usual, the essence of <code>reduce()</code> can be reduced to a simple wrapper around a for loop:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" data-line-number="1">simple_reduce &lt;-<span class="st"> </span><span class="cf">function</span>(x, f) {</a>
<a class="sourceLine" id="cb440-2" data-line-number="2">  out &lt;-<span class="st"> </span>x[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb440-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>, <span class="kw">length</span>(x))) {</a>
<a class="sourceLine" id="cb440-4" data-line-number="4">    out &lt;-<span class="st"> </span><span class="kw">f</span>(out, x[[i]])</a>
<a class="sourceLine" id="cb440-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb440-6" data-line-number="6">  out</a>
<a class="sourceLine" id="cb440-7" data-line-number="7">}</a></code></pre></div>
<div class="base">
<p>The base equivalent is <code>Reduce()</code>. Note that the argument order is different: the function comes first, followed by the vector, and there is no way to supply additional arguments.</p>
</div>
</div>
<div id="accumulate" class="section level3">
<h3><span class="header-section-number">9.5.2</span> Accumulate</h3>

<p>The first <code>reduce()</code> variant, <code>accumulate()</code>, is useful for understanding how reduce works, because instead of returning just the final result, it returns all the intermediate results as well:</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb441-1" data-line-number="1"><span class="kw">accumulate</span>(l, intersect)</a>
<a class="sourceLine" id="cb441-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb441-3" data-line-number="3"><span class="co">#&gt;  [1]  7  1  8  8  3  8  2  4  7 10 10  3  7 10 10</span></a>
<a class="sourceLine" id="cb441-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb441-5" data-line-number="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb441-6" data-line-number="6"><span class="co">#&gt; [1]  1  8  3  2  4 10</span></a>
<a class="sourceLine" id="cb441-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb441-8" data-line-number="8"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb441-9" data-line-number="9"><span class="co">#&gt; [1]  8  4 10</span></a>
<a class="sourceLine" id="cb441-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb441-11" data-line-number="11"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb441-12" data-line-number="12"><span class="co">#&gt; [1] 8 4</span></a></code></pre></div>
<p>Another useful way to understand reduce is to think about <code>sum()</code>: <code>sum(x)</code> is equivalent to <code>x[[1]] + x[[2]] + x[[3]] + ...</code>, i.e. <code>reduce(x, `+`)</code>. Then <code>accumulate(x, `+`)</code> is the cumulative sum:</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb442-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb442-2" data-line-number="2"><span class="kw">reduce</span>(x, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb442-3" data-line-number="3"><span class="co">#&gt; [1] 17</span></a>
<a class="sourceLine" id="cb442-4" data-line-number="4"></a>
<a class="sourceLine" id="cb442-5" data-line-number="5"><span class="kw">accumulate</span>(x, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb442-6" data-line-number="6"><span class="co">#&gt; [1]  4  7 17</span></a></code></pre></div>
</div>
<div id="output-types" class="section level3">
<h3><span class="header-section-number">9.5.3</span> Output types</h3>
<p>In the above example using <code>+</code>, what should <code>reduce()</code> return when <code>x</code> is short, i.e.length 1 or 0? Without additional arguments, <code>reduce()</code> just returns the input when <code>x</code> is length 1:</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb443-1" data-line-number="1"><span class="kw">reduce</span>(<span class="dv">1</span>, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb443-2" data-line-number="2"><span class="co">#&gt; [1] 1</span></a></code></pre></div>
<p>This means that <code>reduce()</code> has no way to check that the input is valid:</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb444-1" data-line-number="1"><span class="kw">reduce</span>(<span class="st">&quot;a&quot;</span>, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb444-2" data-line-number="2"><span class="co">#&gt; [1] &quot;a&quot;</span></a></code></pre></div>
<p>What if its length 0? We get an error that suggests we need to use the <code>.init</code> argument:</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb445-1" data-line-number="1"><span class="kw">reduce</span>(<span class="kw">integer</span>(), <span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb445-2" data-line-number="2"><span class="co">#&gt; Error: `.x` is empty, and no `.init` supplied</span></a></code></pre></div>
<p>What should <code>.init</code> be here? To figure that out, we need to see what happens when <code>.init</code> is supplied:</p>
<p><img src="diagrams/functionals/reduce-init.png" style="display: block; margin: auto;" /></p>
<p>So if we call <code>reduce(1, `+`, init)</code> the result will be <code>1 + init</code>. Now we know that the result should be just <code>1</code>, so that suggests that <code>.init</code> should be 0:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb446-1" data-line-number="1"><span class="kw">reduce</span>(<span class="kw">integer</span>(), <span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="dt">.init =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb446-2" data-line-number="2"><span class="co">#&gt; [1] 0</span></a></code></pre></div>
<p>This also ensures that <code>reduce()</code> checks that length 1 inputs are valid for the function that youre calling:</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb447-1" data-line-number="1"><span class="kw">reduce</span>(<span class="st">&quot;a&quot;</span>, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="dt">.init =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb447-2" data-line-number="2"><span class="co">#&gt; Error in .x + .y: non-numeric argument to binary operator</span></a></code></pre></div>
<p>If you want to get algebraic about it, 0 is called the <strong>identity</strong> of the real numbers under the operation of addition: if you add a 0 to any number, you get the same number back. R applies the same principle to determine what a summary function with a zero length input should return:</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb448-1" data-line-number="1"><span class="kw">sum</span>(<span class="kw">integer</span>())  <span class="co"># x + 0 = x</span></a>
<a class="sourceLine" id="cb448-2" data-line-number="2"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb448-3" data-line-number="3"><span class="kw">prod</span>(<span class="kw">integer</span>()) <span class="co"># x * 1 = x</span></a>
<a class="sourceLine" id="cb448-4" data-line-number="4"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb448-5" data-line-number="5"><span class="kw">min</span>(<span class="kw">integer</span>())  <span class="co"># min(x, Inf) = x</span></a>
<a class="sourceLine" id="cb448-6" data-line-number="6"><span class="co">#&gt; [1] Inf</span></a>
<a class="sourceLine" id="cb448-7" data-line-number="7"><span class="kw">max</span>(<span class="kw">integer</span>())  <span class="co"># max(x, -Inf) = x</span></a>
<a class="sourceLine" id="cb448-8" data-line-number="8"><span class="co">#&gt; [1] -Inf</span></a></code></pre></div>
<p>If youre using <code>reduce()</code> in a function, you should always supply <code>.init</code>. Think carefully about what your function should return when you pass a vector of length 0 or 1, and make sure to test your implementation.</p>
</div>
<div id="multiple-inputs" class="section level3">
<h3><span class="header-section-number">9.5.4</span> Multiple inputs</h3>

<p>Very occasionally you need to pass two arguments to the function that youre reducing. For example, you might have a list of data frames that you want to join together, and the variables you use to join will vary from element to element. This is a very specialised scenario, so I dont want to spend much time on it, but I do want you to know that <code>reduce2()</code> exists.</p>
<p>The length of the second argument varies based on whether or not <code>.init</code> is supplied: if you have four elements of <code>x</code>, <code>f</code> will only be called three times. If you supply init, <code>f</code> will be called four times.</p>
<p><img src="diagrams/functionals/reduce2.png" style="display: block; margin: auto;" />
<img src="diagrams/functionals/reduce2-init.png" style="display: block; margin: auto;" /></p>
</div>
<div id="map-reduce" class="section level3">
<h3><span class="header-section-number">9.5.5</span> Map-reduce</h3>
<p></p>
<p>You might have heard of map-reduce, the idea that powers technology like Hadoop. Now you can see how simple and powerful the underlying idea is: map-reduce is a map combined with a reduce. The difference for large data is that the data is spread over multiple computers. Each computer performs the map on the data that it has, then it sends the result to back to a coordinator which <em>reduces</em> the individual results back to a single result.</p>
<p>As a simple example, imagine computing the mean of a very large vector, so large that it has to be split over multiple computers. You could ask each computer to calculate the sum and the length, and then return those to the coordinator which computes the overall mean by dividing the total sum by the total length.</p>
</div>
</div>
<div id="predicate-functionals" class="section level2">
<h2><span class="header-section-number">9.6</span> Predicate functionals</h2>
<p>
</p>
<p>A <strong>predicate</strong> is a function that returns a single <code>TRUE</code> or <code>FALSE</code>, like <code>is.character()</code>, <code>is.null()</code>, or <code>all()</code>, and we say a predicate <strong>matches</strong> a vector if it returns <code>TRUE</code>.</p>
<div id="basics-1" class="section level3">
<h3><span class="header-section-number">9.6.1</span> Basics</h3>
<p>A <strong>predicate functional</strong> applies a predicate to each element of a vector. purrr provides six useful functions which come in three pairs:</p>
<ul>
<li><p><code>some(.x, .p)</code> returns <code>TRUE</code> if <em>any</em> element matches;
<code>every(.x, .p)</code> returns <code>TRUE</code> if <em>all</em> elements match.</p>
<p>These are similar to <code>any(map_lgl(.x, .p))</code> and <code>all(map_lgl(.x, .p))</code>
but they terminate early: <code>some()</code> returns <code>TRUE</code> when it sees the first
<code>TRUE</code>, and <code>every()</code> returns <code>FALSE</code> when it sees the first <code>FALSE</code>.</p></li>
<li><p><code>detect(.x, .p)</code> returns the <em>value</em> of the first match;
<code>detect_index(.x, .p)</code> returns the <em>location</em> of the first match.</p></li>
<li><p><code>keep(.x, .p)</code> <em>keeps</em> all matching elements;
<code>discard(.x, .p)</code> <em>drops</em> all matching elements.</p></li>
</ul>
<p>The following example shows how you might use these functionals with a data frame:</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb449-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">y =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>))</a>
<a class="sourceLine" id="cb449-2" data-line-number="2"><span class="kw">detect</span>(df, is.factor)</a>
<a class="sourceLine" id="cb449-3" data-line-number="3"><span class="co">#&gt; [1] a b c</span></a>
<a class="sourceLine" id="cb449-4" data-line-number="4"><span class="co">#&gt; Levels: a b c</span></a>
<a class="sourceLine" id="cb449-5" data-line-number="5"><span class="kw">detect_index</span>(df, is.factor)</a>
<a class="sourceLine" id="cb449-6" data-line-number="6"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb449-7" data-line-number="7"></a>
<a class="sourceLine" id="cb449-8" data-line-number="8"><span class="kw">str</span>(<span class="kw">keep</span>(df, is.factor))</a>
<a class="sourceLine" id="cb449-9" data-line-number="9"><span class="co">#&gt; &#39;data.frame&#39;:	3 obs. of  1 variable:</span></a>
<a class="sourceLine" id="cb449-10" data-line-number="10"><span class="co">#&gt;  $ y: Factor w/ 3 levels &quot;a&quot;,&quot;b&quot;,&quot;c&quot;: 1 2 3</span></a>
<a class="sourceLine" id="cb449-11" data-line-number="11"><span class="kw">str</span>(<span class="kw">discard</span>(df, is.factor))</a>
<a class="sourceLine" id="cb449-12" data-line-number="12"><span class="co">#&gt; &#39;data.frame&#39;:	3 obs. of  1 variable:</span></a>
<a class="sourceLine" id="cb449-13" data-line-number="13"><span class="co">#&gt;  $ x: int  1 2 3</span></a></code></pre></div>
</div>
<div id="predicate-map" class="section level3">
<h3><span class="header-section-number">9.6.2</span> Map variants</h3>
<p><code>map()</code> and <code>modify()</code> come in variants that also take predicate functions, transforming only the elements of <code>.x</code> where <code>.p</code> is <code>TRUE</code>.</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb450-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb450-2" data-line-number="2">  <span class="dt">num1 =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb450-3" data-line-number="3">  <span class="dt">num2 =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>),</a>
<a class="sourceLine" id="cb450-4" data-line-number="4">  <span class="dt">chr1 =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>),</a>
<a class="sourceLine" id="cb450-5" data-line-number="5">  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb450-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb450-7" data-line-number="7"></a>
<a class="sourceLine" id="cb450-8" data-line-number="8"><span class="kw">str</span>(<span class="kw">map_if</span>(df, is.numeric, mean))</a>
<a class="sourceLine" id="cb450-9" data-line-number="9"><span class="co">#&gt; List of 3</span></a>
<a class="sourceLine" id="cb450-10" data-line-number="10"><span class="co">#&gt;  $ num1: num 10</span></a>
<a class="sourceLine" id="cb450-11" data-line-number="11"><span class="co">#&gt;  $ num2: num 6</span></a>
<a class="sourceLine" id="cb450-12" data-line-number="12"><span class="co">#&gt;  $ chr1: chr [1:3] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></a>
<a class="sourceLine" id="cb450-13" data-line-number="13"><span class="kw">str</span>(<span class="kw">modify_if</span>(df, is.numeric, mean))</a>
<a class="sourceLine" id="cb450-14" data-line-number="14"><span class="co">#&gt; &#39;data.frame&#39;:	3 obs. of  3 variables:</span></a>
<a class="sourceLine" id="cb450-15" data-line-number="15"><span class="co">#&gt;  $ num1: num  10 10 10</span></a>
<a class="sourceLine" id="cb450-16" data-line-number="16"><span class="co">#&gt;  $ num2: num  6 6 6</span></a>
<a class="sourceLine" id="cb450-17" data-line-number="17"><span class="co">#&gt;  $ chr1: chr  &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></a>
<a class="sourceLine" id="cb450-18" data-line-number="18"><span class="kw">str</span>(<span class="kw">map</span>(<span class="kw">keep</span>(df, is.numeric), mean))</a>
<a class="sourceLine" id="cb450-19" data-line-number="19"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb450-20" data-line-number="20"><span class="co">#&gt;  $ num1: num 10</span></a>
<a class="sourceLine" id="cb450-21" data-line-number="21"><span class="co">#&gt;  $ num2: num 6</span></a></code></pre></div>
</div>
<div id="exercises-2" class="section level3">
<h3><span class="header-section-number">9.6.3</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Why isnt <code>is.na()</code> a predicate function? What base R function is closest
to being a predicate version of <code>is.na()</code>?</p></li>
<li><p><code>simple_reduce()</code> has a problem when <code>x</code> is length 0 or length 1. Describe
the source of the problem and how you might go about fixing it.</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb451-1" data-line-number="1">simple_reduce &lt;-<span class="st"> </span><span class="cf">function</span>(x, f) {</a>
<a class="sourceLine" id="cb451-2" data-line-number="2">  out &lt;-<span class="st"> </span>x[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb451-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>, <span class="kw">length</span>(x))) {</a>
<a class="sourceLine" id="cb451-4" data-line-number="4">    out &lt;-<span class="st"> </span><span class="kw">f</span>(out, x[[i]])</a>
<a class="sourceLine" id="cb451-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb451-6" data-line-number="6">  out</a>
<a class="sourceLine" id="cb451-7" data-line-number="7">}</a></code></pre></div></li>
<li><p>Implement the <code>span()</code> function from Haskell: given a list <code>x</code> and a
predicate function <code>f</code>, <code>span(x, f)</code> returns the location of the longest
sequential run of elements where the predicate is true. (Hint: you
might find <code>rle()</code> helpful.)</p></li>
<li><p>Implement <code>arg_max()</code>. It should take a function and a vector of inputs,
and return the elements of the input where the function returns the highest
value. For example, <code>arg_max(-10:5, function(x) x ^ 2)</code> should return -10.
<code>arg_max(-5:5, function(x) x ^ 2)</code> should return <code>c(-5, 5)</code>.
Also implement the matching <code>arg_min()</code> function.</p></li>
<li><p>The function below scales a vector so it falls in the range [0, 1]. How
would you apply it to every column of a data frame? How would you apply it
to every numeric column in a data frame?</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb452-1" data-line-number="1">scale01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb452-2" data-line-number="2">  rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb452-3" data-line-number="3">  (x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb452-4" data-line-number="4">}</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="base-functionals" class="section level2">
<h2><span class="header-section-number">9.7</span> Base functionals</h2>
<p>To finish up the chapter, here I provide a survey of important base functionals that are not members of the map, reduce, or predicate families, and hence have no equivalent in purrr. This is not to say that theyre not important, but they have more of a mathematical or statistical flavour, and they are generally less useful in data analysis.</p>
<div id="matrices-and-arrays" class="section level3">
<h3><span class="header-section-number">9.7.1</span> Matrices and arrays</h3>

<p><code>map()</code> and friends are specialised to work with one-dimensional vectors. <code>base::apply()</code> is specialised to work with two-dimensional and higher vectors, i.e.matrices and arrays. You can think of <code>apply()</code> as an operation that summarises a matrix or array by collapsing each row or column to a single value. It has four arguments:</p>
<ul>
<li><p><code>X</code>, the matrix or array to summarise.</p></li>
<li><p><code>MARGIN</code>, an integer vector giving the dimensions to summarise over,
1 = rows, 2 = columns, etc. (The argument name comes from thinking about
the margins of a joint distribution.)</p></li>
<li><p><code>FUN</code>, a summary function.</p></li>
<li><p><code>...</code> other arguments passed on to <code>FUN</code>.</p></li>
</ul>
<p>A typical example of <code>apply()</code> looks like this</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb453-1" data-line-number="1">a2d &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">nrow =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb453-2" data-line-number="2"><span class="kw">apply</span>(a2d, <span class="dv">1</span>, mean)</a>
<a class="sourceLine" id="cb453-3" data-line-number="3"><span class="co">#&gt; [1]  8.5  9.5 10.5 11.5 12.5</span></a>
<a class="sourceLine" id="cb453-4" data-line-number="4"><span class="kw">apply</span>(a2d, <span class="dv">2</span>, mean)</a>
<a class="sourceLine" id="cb453-5" data-line-number="5"><span class="co">#&gt; [1]  3  8 13 18</span></a></code></pre></div>
<!-- HW: recreate diagrams from plyr paper -->
<p>You can specify multiple dimensions to <code>MARGIN</code>, which is useful for high-dimensional arrays:</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb454-1" data-line-number="1">a3d &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">24</span>, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb454-2" data-line-number="2"><span class="kw">apply</span>(a3d, <span class="dv">1</span>, mean)</a>
<a class="sourceLine" id="cb454-3" data-line-number="3"><span class="co">#&gt; [1] 12 13</span></a>
<a class="sourceLine" id="cb454-4" data-line-number="4"><span class="kw">apply</span>(a3d, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), mean)</a>
<a class="sourceLine" id="cb454-5" data-line-number="5"><span class="co">#&gt;      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb454-6" data-line-number="6"><span class="co">#&gt; [1,]   10   12   14</span></a>
<a class="sourceLine" id="cb454-7" data-line-number="7"><span class="co">#&gt; [2,]   11   13   15</span></a></code></pre></div>
<p>There are two caveats to using <code>apply()</code>:</p>
<ul>
<li><p>Like <code>base::sapply()</code>, you have no control over the output type; it
will automatically be simplified to a list, matrix, or vector. However,
you usually use <code>apply()</code> with numeric arrays and a numeric summary
function so you are less likely to encounter a problem than with
<code>sapply()</code>.</p></li>
<li><p><code>apply()</code> is also not idempotent in the sense that if the summary
function is the identity operator, the output is not always the same as
the input.</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb455-1" data-line-number="1">a1 &lt;-<span class="st"> </span><span class="kw">apply</span>(a2d, <span class="dv">1</span>, identity)</a>
<a class="sourceLine" id="cb455-2" data-line-number="2"><span class="kw">identical</span>(a2d, a1)</a>
<a class="sourceLine" id="cb455-3" data-line-number="3"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb455-4" data-line-number="4"></a>
<a class="sourceLine" id="cb455-5" data-line-number="5">a2 &lt;-<span class="st"> </span><span class="kw">apply</span>(a2d, <span class="dv">2</span>, identity)</a>
<a class="sourceLine" id="cb455-6" data-line-number="6"><span class="kw">identical</span>(a2d, a2)</a>
<a class="sourceLine" id="cb455-7" data-line-number="7"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div></li>
<li><p>Never use <code>apply()</code> with a data frame. It always coerces it to a matrix,
which will lead to undesirable results if your data frame contains anything
other than numbers.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb456-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">y =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>))</a>
<a class="sourceLine" id="cb456-2" data-line-number="2"><span class="kw">apply</span>(df, <span class="dv">2</span>, mean)</a>
<a class="sourceLine" id="cb456-3" data-line-number="3"><span class="co">#&gt; Warning in mean.default(newX[, i], ...): argument is not numeric or logical:</span></a>
<a class="sourceLine" id="cb456-4" data-line-number="4"><span class="co">#&gt; returning NA</span></a>
<a class="sourceLine" id="cb456-5" data-line-number="5"></a>
<a class="sourceLine" id="cb456-6" data-line-number="6"><span class="co">#&gt; Warning in mean.default(newX[, i], ...): argument is not numeric or logical:</span></a>
<a class="sourceLine" id="cb456-7" data-line-number="7"><span class="co">#&gt; returning NA</span></a>
<a class="sourceLine" id="cb456-8" data-line-number="8"><span class="co">#&gt;  x  y </span></a>
<a class="sourceLine" id="cb456-9" data-line-number="9"><span class="co">#&gt; NA NA</span></a></code></pre></div></li>
</ul>
</div>
<div id="mathematical-concerns" class="section level3">
<h3><span class="header-section-number">9.7.2</span> Mathematical concerns</h3>
<p>Functionals are very common in mathematics. The limit, the maximum, the roots (the set of points where <code>f(x) = 0</code>), and the definite integral are all functionals: given a function, they return a single number (or vector of numbers). At first glance, these functions dont seem to fit in with the theme of eliminating loops, but if you dig deeper youll find out that they are all implemented using an algorithm that involves iteration.</p>
<p>Base R provides a useful set:</p>
<ul>
<li><code>integrate()</code> finds the area under the curve defined by <code>f()</code></li>
<li><code>uniroot()</code> finds where <code>f()</code> hits zero</li>
<li><code>optimise()</code> finds the location of the lowest (or highest) value of <code>f()</code></li>
</ul>
<p>The following example shows how functionals might be used with a simple function, <code>sin()</code>:</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb457-1" data-line-number="1"><span class="kw">integrate</span>(sin, <span class="dv">0</span>, pi)</a>
<a class="sourceLine" id="cb457-2" data-line-number="2"><span class="co">#&gt; 2 with absolute error &lt; 2.2e-14</span></a>
<a class="sourceLine" id="cb457-3" data-line-number="3"><span class="kw">str</span>(<span class="kw">uniroot</span>(sin, pi <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dv">3</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb457-4" data-line-number="4"><span class="co">#&gt; List of 5</span></a>
<a class="sourceLine" id="cb457-5" data-line-number="5"><span class="co">#&gt;  $ root      : num 3.14</span></a>
<a class="sourceLine" id="cb457-6" data-line-number="6"><span class="co">#&gt;  $ f.root    : num 1.22e-16</span></a>
<a class="sourceLine" id="cb457-7" data-line-number="7"><span class="co">#&gt;  $ iter      : int 2</span></a>
<a class="sourceLine" id="cb457-8" data-line-number="8"><span class="co">#&gt;  $ init.it   : int NA</span></a>
<a class="sourceLine" id="cb457-9" data-line-number="9"><span class="co">#&gt;  $ estim.prec: num 6.1e-05</span></a>
<a class="sourceLine" id="cb457-10" data-line-number="10"><span class="kw">str</span>(<span class="kw">optimise</span>(sin, <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi)))</a>
<a class="sourceLine" id="cb457-11" data-line-number="11"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb457-12" data-line-number="12"><span class="co">#&gt;  $ minimum  : num 4.71</span></a>
<a class="sourceLine" id="cb457-13" data-line-number="13"><span class="co">#&gt;  $ objective: num -1</span></a>
<a class="sourceLine" id="cb457-14" data-line-number="14"><span class="kw">str</span>(<span class="kw">optimise</span>(sin, <span class="kw">c</span>(<span class="dv">0</span>, pi), <span class="dt">maximum =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb457-15" data-line-number="15"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb457-16" data-line-number="16"><span class="co">#&gt;  $ maximum  : num 1.57</span></a>
<a class="sourceLine" id="cb457-17" data-line-number="17"><span class="co">#&gt;  $ objective: num 1</span></a></code></pre></div>
</div>
<div id="exercises-3" class="section level3">
<h3><span class="header-section-number">9.7.3</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>How does <code>apply()</code> arrange the output? Read the documentation and perform
some experiments.</p></li>
<li><p>What do <code>eapply()</code> and <code>rapply()</code> do? Does purrr have equivalents?</p></li>
<li><p>Challenge: read about the
<a href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-12.html#%25_idx_1096">fixed point algorithm</a>.
Complete the exercises using R.</p></li>
</ol>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-purrr">
<p>Henry, Lionel, and Hadley Wickham. 2018a. <em>Purrr: Functional Programming Tools</em>. <a href="https://purrr.tidyverse.org">https://purrr.tidyverse.org</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="37">
<li id="fn37"><p>Typically its not the for loop itself thats slow, but what youre doing inside of it. A common culprit of slow loops is modifying a data structure, where each modification generates a copy. See Sections <a href="names-values.html#single-binding">2.5.1</a> and <a href="perf-improve.html#avoid-copies">24.6</a> for more details.<a href="functionals.html#fnref37" class="footnote-back"></a></p></li>
<li id="fn38"><p>Not to be confused with <code>base::Map()</code>, which is considerably more complex. Ill discuss <code>Map()</code> in Section <a href="functionals.html#pmap">9.4.5</a>.<a href="functionals.html#fnref38" class="footnote-back"></a></p></li>
<li id="fn39"><p>Who is highly likely to be future you!<a href="functionals.html#fnref39" class="footnote-back"></a></p></li>
<li id="fn40"><p>In brief, invisible values are only printed if you explicitly request it. This makes them well suited for functions called primarily for their side-effects, as it allows their output to be ignored by default, while still giving an option to capture it. See Section <a href="functions.html#invisible">6.7.2</a> for more details.<a href="functionals.html#fnref40" class="footnote-back"></a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="fp.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="function-factories.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hadley/adv-r/edit/master/Functionals.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
